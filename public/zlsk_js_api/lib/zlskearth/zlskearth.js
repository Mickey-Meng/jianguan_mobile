!function(t,i){if("undefined"!=typeof module&&module.exports){var e=require("Cesium");module.exports=t(e,i)}else"function"==typeof define&&define.amd?define(["Cesium"],function(e){return t(e,i)}):(null==i.SFM&&(i.SFM={}),i.SFM||(i.SFM={}),i.SFM.cesiumlib||(i.SFM.cesiumlib={}),i.SFM.cesiumlib.sfmCEnum=t(i.Cesium,i))}(function(e,t){return{drawType:{POINT:"point",POLYLINE:"polyline",POLYGON:"polygon",CIRCLE:"circle"},layerType:{FOLDER:"sfmFolder",C3DTILES:"3dtiles",GEOJSON:"geojson",DATASOURCE:"datasource",ARCGIS_MAP_SERVER:"ArcgisMapServer",ARCGIS_SATELLITE:"ArcgisSatellite",ARCGIS_WORLD_STREET_MAP:"ArcgisWorldStreetMap",BAIDU:"baidu",BING_MAP_AERIAL:"BingMapAerial",BING_MAP_ROAD:"BingMapRoad",GOOGLE:"google",MAPQUEST_OPEN_STREET_MAPS:"OpenMapQuest",MAPQUEST_OSM:"OpenMapQuest",OPEN_MAPQUEST:"OpenMapQuest",OPEN_STREET_MAPS:"OpenStreetMaps",OSM:"OpenStreetMaps",SINGLEIMAGE:"SingleImage",TDT:"TianDiTuYx",TIAN_DI_TU:"TianDiTuYx",TDT_YX:"TianDiTuYx",TDT_YX_ZJ:"TianDiTuYxZj",TDT_SL:"TianDiTuYx",TDT_SL_ZJ:"TianDiTuYxZj",TDT_JJ:"TianDiTuJj",TMS:"tms",URL:"url",WMS:"wms",WMTS:"wmts",ELLIPSOID_TERRAIN:"EllipsoidTerrain",CESIUM_TERRAIN:"CesiumTerrain"},measureType:{HDISTANCE:"hdistance",VDISTANCE:"vdistance",DISTANCE:"distance",AREA:"area",HANGLE:"hangle"},version:"1.0.0"}},this),function(i,n){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum");module.exports=i(e,t,n)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum"],function(e,t){return i(e,t,n)});else{null==n.SFM&&(n.SFM={}),n.SFM||(n.SFM={});var r=n.SFM.cesiumlib||(n.SFM.cesiumlib={});n.SFM.cesiumlib.sfmCesiumUtil=i(n.Cesium,r.sfmCEnum,n)}}(function(d,e,t){function l(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}var r=d,p=d.Ellipsoid.WGS84.maximumRadius;return{fguid:function(){return"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".replace(/x/g,function(e){return(16*Math.random()|0).toString(16)})},toCartesian3:function(e,t,i){return"object"==typeof e&&(t=e.y,i=e.z,e=e.x),r.Cartesian3.fromDegrees(e,t,i)},toHeadingPitchRoll:function(e,t,i){return"object"==typeof e&&(t=e.pitch,i=e.roll||0,e=e.heading),null==t&&(t=-90),r.HeadingPitchRoll.fromDegrees(e||0,t,i||0)},toOrientation:function(e){return{heading:r.Math.toRadians(e.heading||0),pitch:r.Math.toRadians(null==e.pitch?-90:e.pitch),roll:r.Math.toRadians(e.roll||0)}},toRectangle:function(e,t,i,n){return new r.Rectangle(e,t,i,n)},toColor:function(e){var t=typeof e;return e instanceof r.Color?e:"number"==t?r.Color.fromRgba(e):"string"==t?r.Color.fromCssColorString(e):Array.isArray(e)?r.Color.fromBytes(e[0],e[1],e[2],r.defaultValue(e[3],255)):"object"==t?r.Color.fromBytes(e.r,e.g,e.b,r.defaultValue(e.a,255)):null},toEllipsoid:function(e){if(e instanceof r.Ellipsoid)return e;if(Array.isArray(e))return new r.Ellipsoid(e[0],e[1],e[2]);var t=typeof e;if("object"==t)return new r.Ellipsoid(e.x,e.y,e.z);if("string"!=t)return null;var i=e.split(",");return new r.Ellipsoid(Number(i[0]),Number(i[1]),Number(i[2]))},toViewPose:function(e){return e?{destination:this.toCartesian3(e),orientation:this.toOrientation(e),duration:!1===e.fly?void 0:e.duration||3,endTransform:r.Matrix4.IDENTITY}:null},cartographicToDegree:function(e){return[180*e.longitude/Math.PI,180*e.latitude/Math.PI,e.height]},cartesian3ToDegree:function(e){return this.cartographicToDegree(d.Cartographic.fromCartesian(e))},cartographicArrayToDegreeArray:function(e){for(var t=[],i=0;i<e.length;i++)t.push(this.cartographicToDegree(e[i]));return t},cartesianArray3ToDegreeArray:function(e){for(var t=[],i=0;i<e.length;i++)t.push(this.cartesian3ToDegree(e[i]));return t},getHeight:function(e,t,i){},getTerrainHeight:function(e,t,i){},computePolygonPosition:function(e,t){for(var i=[],n=0;n<e.length;n++)i.push(e[n].clone());null==t&&(t=1);var r,o,s,a=2*Math.asin(t/2/p),l=new d.PolygonGeometry.fromPositions({positions:i,vertexFormat:d.VertexFormat.POSITION_ONLY,granularity:a}),u=new d.PolygonGeometry.createGeometry(l),c=u.attributes.position.values;i=[];for(n=0;n<u.indices.length;n+=3){r=u.indices[n],o=u.indices[n+1],s=u.indices[n+2];var f=[];f.push(new d.Cartesian3(c[3*r],c[3*r+1],c[3*r+2])),f.push(new d.Cartesian3(c[3*o],c[3*o+1],c[3*o+2])),f.push(new d.Cartesian3(c[3*s],c[3*s+1],c[3*s+2])),i.push(f)}return i},computePolygonHeightRange:function(e,t,i){for(var n=[],r=0;r<t.length;r++)n.push(t[r].clone());null==i&&(i=1);var o=2*Math.asin(i/2/p),s=new d.PolygonGeometry.fromPositions({positions:n,vertexFormat:d.VertexFormat.POSITION_ONLY,granularity:o}),a=new d.PolygonGeometry.createGeometry(s).attributes.position.values,l=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,c=new d.Cartesian3,f=new d.Cartographic,h=null;for(r=0;r<a.length;r+=3)d.Cartesian3.fromElements(a[r],a[r+1],a[r+2],c),(h=e.scene.globe.getHeight(d.Cartographic.fromCartesian(c,void 0,f)))<l&&(l=h),u<h&&(u=h);return{min:l,max:u}},lerpSplinePosition:function(e){var t=l(e,"points",null);if(!t||t.length<2)return null;var i=l(e,"times",null);if(!i||i.length<2){i=[];for(var n=0;n<t.length;n++)i.push(1/(t.length-1)*n)}var r=new d.CatmullRomSpline({times:i,points:t}),o=l(e,"num",100),s=(i[i.length-1]-i[0])/(o-1),a=[];for(n=0;n<o;n++)a.push(r.evaluate(i[0]+n*s));return a},version:"1.0.0"}},this),function(n,r){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil");module.exports=n(e,t,i,r)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil"],function(e,t,i){return n(e,t,i,r)});else{null==r.SFM&&(r.SFM={}),r.SFM||(r.SFM={});var o=r.SFM.cesiumlib||(r.SFM.cesiumlib={});r.SFM.cesiumlib.sfmCShaderSource=n(r.Cesium,o.sfmCEnum,o.sfmCesiumUtil,r)}}(function(e,t,i,n){var r={lightStripe:function(){return{fs:{d:"uniform float u_zlskMaxHeight;uniform float u_zlskCycle1;uniform float u_zlskCycle2;",m:"float a1 = fract(czm_frameNumber / u_zlskCycle2) * 3.14159265 * 2.0;float a2 = v_zlskposition.z / u_zlskMaxHeight * 4.0 + 0.5 + sin(a1) * 0.3;gl_FragColor *= vec4(a2, a2, a2, 1.0);float a3 = fract(czm_frameNumber / u_zlskCycle1);float h = clamp(v_zlskposition.z / u_zlskMaxHeight, 0.0, 1.0);a3 = abs(a3 - 0.5) * 2.0;float t = 0.005;float d = 1.0;d = step(t, abs(h - a3));if(d == 1.0){float a[4];a[0] = 0.05;a[1] = 0.3;a[2] = 0.35;a[3] = 0.6;for(int i = 0;i < 4;i++){float ai = a[i];d = abs(h - ai);if(d < t){d = 0.0;break;}else if(d < t * 3.0){d /= t * 3.0;break;}else{d = 1.0;}}}gl_FragColor.rgb += gl_FragColor.rgb * (1.0 - d) * 2.0;"}}},lightStripeEx:function(){return{fs:{d:"uniform float u_zlskMaxHeight;uniform float u_zlskF1;uniform float u_zlskCycle1;uniform float u_zlskF2;uniform float u_zlskCycle2;uniform float u_zlskOffset;uniform float u_zlskIntensity1;uniform vec4 u_zlskSc;uniform vec4 u_zlskEc;uniform float u_zlskSp;uniform float u_zlskEp;uniform float u_zlskF3;uniform float u_zlskIntensity2;",m:"if(u_zlskF2 == 1.0){float a1 = fract(czm_frameNumber / u_zlskCycle2) * 3.14159265 * 2.0;float cs = smoothstep(u_zlskSp, u_zlskEp, v_zlskposition.z / u_zlskMaxHeight) + sin(a1) * u_zlskOffset;vec4 c = mix(u_zlskSc, u_zlskEc, cs);gl_FragColor *= vec4(c.rgb * u_zlskIntensity1, 1.0);}float d = 1.0;float t = 0.005;float h = clamp(v_zlskposition.z / u_zlskMaxHeight, 0.0, 1.0);if(u_zlskF1 == 1.0){float a3 = fract(czm_frameNumber / u_zlskCycle1);a3 = abs(a3 - 0.5) * 2.0;d = step(t, abs(h - a3));}if(d == 1.0 && u_zlskF3 == 1.0){float a[4];a[0] = 0.05;a[1] = 0.3;a[2] = 0.35;a[3] = 0.6;for(int i = 0;i < 4;i++){float ai = a[i];d = abs(h - ai);if(d < t){d = 0.0;break;}else if(d < t * 3.0){d /= t * 3.0;break;}else{d = 1.0;}}}gl_FragColor.rgb += gl_FragColor.rgb * (1.0 - d) * u_zlskIntensity2;"}}},gradient:function(){return{fs:{d:"uniform float u_zlskMaxHeight;uniform float u_zlskCycle;uniform float u_zlskOffset;uniform vec4 u_zlskLightColor;uniform float u_zlskIntensity;uniform vec4 u_zlskSc;uniform vec4 u_zlskEc;uniform float u_zlskSp;uniform float u_zlskEp;",m:"float a1 = fract(czm_frameNumber / u_zlskCycle) * 3.14159265 * 2.0;float a2 = sin(a1) * u_zlskOffset;float cs = smoothstep(u_zlskSp, u_zlskEp, v_zlskposition.z / u_zlskMaxHeight);cs += a2;vec4 c = mix(u_zlskSc, u_zlskEc, cs);gl_FragColor = c * u_zlskLightColor * u_zlskIntensity;"}}}};return{getSource:function(e,t){return function(e,t){var i=r[e];return i?i(t):null}(e,t)}}},this),function(n,r){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil");module.exports=n(e,t,i,r)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil"],function(e,t,i){return n(e,t,i,r)});else{null==r.SFM&&(r.SFM={}),r.SFM||(r.SFM={});var o=r.SFM.cesiumlib||(r.SFM.cesiumlib={});r.SFM.cesiumlib.ZlskCPopupManager=n(r.Cesium,o.sfmCEnum,o.sfmCesiumUtil,r)}}(function(h,e,t,i){function d(){return"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".replace(/x/g,function(e){return(16*Math.random()|0).toString(16)})}function p(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}function m(e){if(e.c)return e.c;var t=null;return t=e.cid?document.getElementById(e.cid):document.querySelector(".sfm-m-earth-popupc"),$(t).on("click",".sfm-m-popup-btn-close",function(){o(e,this.dataset.pid,!0)}),e.c=t}function n(e){!function(e,t){e.cid=t.el,e.viewer=t.viewer,e.id=d(),e._pops=[],e._rel=e.viewer.scene.postRender.addEventListener(function(){r(e,e._pops)})}(this,e)}var g=[0,0],u=new h.Cartesian2,r=function(e,t){for(var i=0;i<t.length;i++)v(e,t[i])},v=function(e,t){var i=t.position,n=h.SceneTransforms.wgs84ToWindowCoordinates(e.viewer.scene,i,u);if(n){var r=m(e);if(r){var o=(r=$(r).find("#"+t.id)).width(),s=r.height(),a=n.x-o/2+t.offset[0],l=n.y-s-10+t.offset[1];r.css({left:a+"px",top:l+"px"})}}},o=function(e,t,i){var n=m(e);if(n){var r=function(e,t,i){if(!e)return null;for(var n=[],r=0;r<e.length;r++)e[r][t]==i&&n.push(e.splice(r--,1)[0]);return n}(e._pops,"id",t);if($(n).find("#"+t).remove(),i)for(var o=0;o<r.length;o++){var s=r[o];s&&s.options&&"function"==typeof s.options.onClose&&s.options.onClose(s.id)}}},s=function(e,t){var i=m(e);if(i)for(;0<e._pops.length;){var n=e._pops.pop();$(i).find("#"+n.id).remove(),t&&n&&n.options&&"function"==typeof n.options.onClose&&n.options.onClose(n.id)}};return n.prototype.destroy=function(){!function(e){s(e),e._rel()}(this)},n.prototype.clear=function(e){s(this,e)},n.prototype.open=function(e){return function(e,t){var i=p(t,"position",null);if(!i)return null;if(!(i instanceof h.Cartesian3))if(i instanceof Array)i=h.Cartesian3.fromDegrees(i[0],i[1],i[2]);else{if(null==i.lon)return null;i=h.Cartesian3.fromDegrees(i.lon,i.lat,i.height)}var n=p(t,"content",""),r=p(t,"width",400),o=p(t,"height",240),s=p(t,"closable",!0),a=d(),l=p(t,"class",null),u='<div id="'+a+'" class="sfm-m-popup'+(l=l?" "+l:"")+'" '+(' style="width: '+r+"px;height: "+o+'px;"')+">"+(s?'<div class="sfm-m-popup-btn-close" data-pid="'+a+'">&times;</div>':"")+'<div id="'+a+'_bg" class="sfm-m-popup-bg"><div class="sfm-m-popup-content-wrapper"><div class="sfm-m-popup-content">'+n+'</div></div></div><div class="sfm-m-popup-anchor"></div></div>',c=m(e);c&&$(c).append(u);var f={id:a,width:r,height:o,offset:p(t,"offset",g),position:i,options:t};return e._pops.push(f),v(e,f),a}(this,e)},n.prototype.close=function(e,t){o(this,e,t)},n},this),function(t,i){if("undefined"!=typeof module&&module.exports){var e=require("Cesium");module.exports=t(e,i)}else"function"==typeof define&&define.amd?define(["Cesium"],function(e){return t(e,i)}):(null==i.SFM&&(i.SFM={}),i.SFM||(i.SFM={}),i.SFM.cesiumlib||(i.SFM.cesiumlib={}),i.SFM.cesiumlib.sfmCGoogleImageryProviderHelper=t(i.Cesium,i))}(function(e,t){var i=e;return{createImageryProvider:function(e){var t={url:"http://{s}.google.cn/maps/vt?lyrs=s,h&x={x}&y={y}&z={z}&hl=zh-CN&gl=cn",subdomains:["mt0","mt1","mt2","mt3"],minimumLevel:0,maximumLevel:20,rectangle:new i.Rectangle(-Math.PI,-1.4844222297453322,Math.PI,1.4844222297453322),tilingScheme:new i.WebMercatorTilingScheme};return new i.UrlTemplateImageryProvider(t)},version:"1.0.0"}},this),function(t,i){if("undefined"!=typeof module&&module.exports){var e=require("Cesium");module.exports=t(e,i)}else"function"==typeof define&&define.amd?define(["Cesium"],function(e){return t(e,i)}):(null==i.SFM&&(i.SFM={}),i.SFM||(i.SFM={}),i.SFM.cesiumlib||(i.SFM.cesiumlib={}),i.SFM.cesiumlib.sfmCTdtImageryProviderHelper=t(i.Cesium,i))}(function(e,t){var s=e,i={},a=["w","c"];i.getTileInfo_c=function(){var e={dpi:96,rows:256,cols:256,origin:{x:-180,y:90},spatialReference:{wkid:4490},lods:function(){for(var e=[],t=0;t<19;t++){var i=295829355.4545656/Math.pow(2,t),n=i/39.37/96/6378137/Math.PI*180;e.push({level:t+1,resolution:n,scale:i})}return e}()};return new TileInfo(e)},i.getInitExtent_c=function(){return r([-180,-90,180,90,{wkid:4490}])},i.getFullExtent_c=function(){return r([-180,-90,180,90,{wkid:4490}])};i.getTileInfo_w=function(){var e={dpi:96,rows:256,cols:256,origin:{x:-20037508.3427892,y:20037508.3427892},spatialReference:{wkid:900913},lods:function(){for(var e=[],t=0;t<19;t++){var i=295829355.4545656/Math.pow(2,t),n=i/39.37/96;e.push({level:t+1,resolution:n,scale:i})}return e}()};return new TileInfo(e)},i.getInitExtent_w=function(){return r([-20037508.3427892,-20037508.3427892,20037508.3427892,20037508.3427892,{wkid:900913}])},i.getFullExtent_w=function(){return r([-20037508.3427892,-20037508.3427892,20037508.3427892,20037508.3427892,{wkid:900913}])};function n(e){return"esri.SpatialReference"==e.declaredClass?e:new SpatialReference(e)}var r=function(e,t){return 4<e.length?new Extent(e[0],e[1],e[2],e[3],n(e[4])):new Extent(e[0],e[1],e[2],e[3],t&&t.spatialReference||n(4326))};return{createImageryProvider:function(e){var t=(e=e||{}).url,i=e.tileMatrixSet||"w";!function(e){for(var t=0;t<a.length;t++)if(a[t]==e)return!0;return!1}(i)&&(i="w");var n=e.layer||"img";if(!t||0!=t.indexOf("http://")&&0!=t.indexOf("https://")){var r=e.tk||"c1907a49e271bbfb92469c21d930fd3c";t=e.url="http://{s}.tianditu.gov.cn/DataServer?T="+n+"_"+i+"&x={TileCol}&y={TileRow}&l={TileMatrix}",t=e.url="http://{s}.tianditu.gov.cn/"+n+"_"+i+"/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER="+n+"&STYLE=default&TILEMATRIXSET={TileMatrixSet}&FORMAT=tiles&TILEMATRIX={TileMatrix}&TILEROW={TileRow}&TILECOL={TileCol}&tk="+r}var o={url:t,format:e.format||"tiles",layer:n,style:e.style||"default",tileMatrixSetID:i,tileMatrixLabels:["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18"],tilingScheme:new s.WebMercatorTilingScheme,rectangle:new s.Rectangle(-Math.PI,-1.4844222297453322,Math.PI,1.4844222297453322),minimumLevel:0,maximumLevel:18,subdomains:["t0","t1","t2","t3","t4","t5","t6","t7"]};return new s.WebMapTileServiceImageryProvider(o)},version:"1.0.0"}},this),function(t,i){if("undefined"!=typeof module&&module.exports){var e=require("Cesium");module.exports=t(e,i)}else"function"==typeof define&&define.amd?define(["Cesium"],function(e){return t(e,i)}):(null==i.SFM&&(i.SFM={}),i.SFM||(i.SFM={}),i.SFM.cesiumlib||(i.SFM.cesiumlib={}),i.SFM.cesiumlib.SfmCBaiduImageryProvider=t(i.Cesium,i))}(function(e,t){function i(e){this._url=function(e){var t=e&&e.layer||"vec",i=e.url;if(i)return i+"{z}/{x}/{y}.png";switch(t){case"img_d":i="http://shangetu{s}.map.bdimg.com/it/u=x={x};y={y};z={z};v=009;type=sate&fm=46";break;case"img_z":i="http://online{s}.map.bdimg.com/tile/?qt=tile&x={x}&y={y}&z={z}&styles="+(e.bigfont?"sh":"sl")+"&v=020";break;case"time":i="http://its.map.baidu.com:8002/traffic/TrafficTileService?x={x}&y={y}&level={z}&time={time}&label=web2D&v=017";break;case"offline":i=e.url+"{z}/{x}/{y}.png";break;case"vec":default:i="http://online{s}.map.bdimg.com/onlinelabel/?qt=tile&x={x}&y={y}&z={z}&styles="+(e.bigfont?"ph":"pl")+"&scaler = 1 & p = 1"}return i}(e),this._tileWidth=256,this._tileHeight=256,this._maximumLevel=18;var t=new n(-33554054,-33746824),i=new n(33554054,33746824);this._tilingScheme=new o({rectangleSouthwestInMeters:t,rectangleNortheastInMeters:i}),this._credit=void 0,this._rectangle=this._tilingScheme.rectangle,this._ready=!0}var n=e.Cartesian2,r=e.defineProperties,s=e.DeveloperError,o=e.WebMercatorTilingScheme,a=e.ImageryProvider;return r(i.prototype,{url:{get:function(){return this._url}},token:{get:function(){return this._token}},proxy:{get:function(){return this._proxy}},tileWidth:{get:function(){if(!this._ready)throw new s("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new s("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new s("maximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel}},minimumLevel:{get:function(){if(!this._ready)throw new s("minimumLevel must not be called before the imagery provider is ready.");return 0}},tilingScheme:{get:function(){if(!this._ready)throw new s("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},rectangle:{get:function(){if(!this._ready)throw new s("rectangle must not be called before the imagery provider  is ready.");return this._rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new s("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},credit:{get:function(){return this._credit}},usingPrecachedTiles:{get:function(){return this._useTiles}},hasAlphaChannel:{get:function(){return!0}},layers:{get:function(){return this._layers}}}),i.prototype.getTileCredits=function(e,t,i){},i.prototype.requestImage=function(e,t,i){if(!this._ready)throw new s("requestImage must not be called before the imagery provider is ready.");var n=this._tilingScheme.getNumberOfXTilesAtLevel(i),r=this._tilingScheme.getNumberOfYTilesAtLevel(i),o=this._url.replace("{x}",e-n/2).replace("{y}",r/2-t-1).replace("{z}",i).replace("{s}",Math.floor(10*Math.random())).replace("{time}",(new Date).getTime());return a.loadImage(this,o)},i},this),function(n,r){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil");module.exports=n(e,t,i,r)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil"],function(e,t,i){return n(e,t,i,r)});else{null==r.SFM&&(r.SFM={}),r.SFM||(r.SFM={});var o=r.SFM.cesiumlib||(r.SFM.cesiumlib={});r.SFM.cesiumlib.SfmCPick=n(r.Cesium,o.sfmCEnum,o.sfmCesiumUtil,r)}}(function(o,e,t,i){function n(e){!function(e,t){e.viewer=t.viewer}(this,e)}var s=function(e){e.handler&&(e.handler.removeInputAction(o.ScreenSpaceEventType.LEFT_CLICK),e.handler.removeInputAction(o.ScreenSpaceEventType.RIGHT_CLICK))};return n.prototype.destroy=function(){!function(e){s(e),e.handler&&e.handler.destroy(),delete e.handler}(this)},n.prototype.begin=function(e){!function(n,r){s(n),n.handler||(n.handler=new o.ScreenSpaceEventHandler(n.viewer.scene.canvas)),n.handler.setInputAction(function(e){var t=n.viewer.scene.pick(e.position);if(null!=t){var i={position:n.viewer.scene.pickPosition(e.position),screen:e.position};t instanceof o.Cesium3DTileFeature?"function"==typeof r&&r(t,i):t.id?t.id instanceof o.Entity&&"function"==typeof r&&r(t,i):t.primitive&&"function"==typeof r&&r(t,i)}},o.ScreenSpaceEventType.LEFT_CLICK),n.handler.setInputAction(function(e){s(n)},o.ScreenSpaceEventType.RIGHT_CLICK)}(this,e)},n.prototype.exit=function(){s(this)},n},this),function(n,r){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil");module.exports=n(e,t,i,r)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil"],function(e,t,i){return n(e,t,i,r)});else{null==r.SFM&&(r.SFM={}),r.SFM||(r.SFM={});var o=r.SFM.cesiumlib||(r.SFM.cesiumlib={});r.SFM.cesiumlib.SfmCEntityManager=n(r.Cesium,o.sfmCEnum,o.sfmCesiumUtil,r)}}(function(n,e,t,i){function r(e,t){e.viewer=t.viewer,e.name=t.name||"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".replace(/x/g,function(e){return(16*Math.random()|0).toString(16)});var i=e._ds=new n.CustomDataSource(e.name);e.viewer.dataSources.add(i)}function o(e){return e._ds.entities}function s(e){r(this,e)}var a=function(e){e._ds&&e._ds.entities.removeAll()};return Object.defineProperties(s.prototype,{dataSource:{get:function(){return this._ds}},entities:{get:function(){return this._ds.entities}}}),s.prototype.add=function(e){var t=this._ds.entities;if(e instanceof Array){var i=[];t.suspendEvents();for(var n=0;n<e.length;n++){var r=t.add(e[n]);i.push(r)}return t.resumeEvents(),i}return t.add(e)},s.prototype.destroy=function(){!function(e){a(e),e._ds&&e.viewer.dataSources.remove(e._ds,!0),delete e._ds,delete e.viewer}(this)},s.prototype.clear=function(){a(this)},s.prototype.removeAll=function(){a(this)},s.prototype.contains=function(e){return o(this).contains(e)},s.prototype.getById=function(e){return o(this).getById(e)},s.prototype.remove=function(e){return o(this).remove(e)},s.prototype.removeById=function(e){return o(this).removeById(e)},s.prototype.getOrCreateEntity=function(e){return o(this).getOrCreateEntity(e)},s.prototype.beginAdd=function(){this._ds.entities.suspendEvents()},s.prototype.endAdd=function(){this._ds.entities.resumeEvents()},s.prototype.show=function(){this._ds.show=!0},s.prototype.hide=function(){this._ds.show=!1},s},this),function(r,o){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil"),n=require("sfmCEntityManager");module.exports=r(e,t,i,n,o)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil","sfmCEntityManager"],function(e,t,i,n){return r(e,t,i,n,o)});else{null==o.SFM&&(o.SFM={}),o.SFM||(o.SFM={});var s=o.SFM.cesiumlib||(o.SFM.cesiumlib={});o.SFM.cesiumlib.SfmCMoveTool=r(o.Cesium,s.sfmCEnum,s.sfmCesiumUtil,s.SfmCEntityManager,o)}}(function(r,e,t,i,n){function o(e){!function(e,t){e.viewer=t.viewer,e._pts=[],e._cp=null,e._em=new i({viewer:e.viewer})}(this,e)}var s=function(e){e._he&&(e._he.removeInputAction(r.ScreenSpaceEventType.LEFT_DOWN),e._he.removeInputAction(r.ScreenSpaceEventType.MOUSE_MOVE),e._he.removeInputAction(r.ScreenSpaceEventType.LEFT_UP),e._he.removeInputAction(r.ScreenSpaceEventType.RIGHT_DOWN)),l(e),e._cp=null},a=function(e,t){for(var i=0;i<t.length;i++){var n=e._em.add({position:t[i],point:{pixelSize:6,color:r.Color.YELLOW,outlineWidth:2,outlineColor:r.Color.DARKRED,heightReference:r.HeightReference.CLAMP_TO_GROUND,disableDepthTestDistance:Number.POSITIVE_INFINITY},show:!0});n.data={index:i},e._pts.push(n)}},l=function(e){e._pts.splice(0,e._pts.length),e._em&&e._em.clear()},u=function(e,t){var i=e.camera.getPickRay(t);if(i)return e.scene.globe.pick(i,e.scene)};return o.prototype.destroy=function(){!function(e){s(e),e._he&&(e._he.destroy(),e._he=null),e._em.destroy(),delete e._em,delete e._cp,delete e._pts,delete em.viewer}(this)},o.prototype.begin=function(e,t){!function(i,e,n){var t=i._he||(i._he=new r.ScreenSpaceEventHandler(i.viewer.scene.canvas));s(i),a(i,e),t.setInputAction(function(e){var t=i.viewer.scene.pick(e.position);r.defined(t)&&t.id&&i._em.contains(t.id)&&(i._cp=t.id)},r.ScreenSpaceEventType.LEFT_DOWN),t.setInputAction(function(e){if(i._cp){var t=u(i.viewer,e.endPosition);t&&(i._cp.position.setValue(t),"function"==typeof n&&n(t,i._cp.data.index,i._pts))}},r.ScreenSpaceEventType.MOUSE_MOVE),t.setInputAction(function(e){i._cp=null},r.ScreenSpaceEventType.LEFT_UP),t.setInputAction(function(e){s(i)},r.ScreenSpaceEventType.RIGHT_DOWN)}(this,e,t)},o.prototype.exit=function(){s(this)},o},this),function(o,s){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil"),n=require("sfmCEntityManager"),r=require("ZlskCPopupManager");module.exports=o(e,t,i,n,r,s)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil","sfmCEntityManager","ZlskCPopupManager"],function(e,t,i,n,r){return o(e,t,i,n,r,s)});else{null==s.SFM&&(s.SFM={}),s.SFM||(s.SFM={});var a=s.SFM.cesiumlib||(s.SFM.cesiumlib={});s.SFM.cesiumlib.ZlskCMarkerManager=o(s.Cesium,a.sfmCEnum,a.sfmCesiumUtil,a.SfmCEntityManager,a.ZlskCPopupManager,s)}}(function(C,e,w,t,i,n){function _(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}function r(e,t,i){if(!e)return null;for(var n=0,r=e.length;n<r;n++)if(e[n][t]==i)return e[n];return null}function o(e){!function(i,e){i.viewer=e.viewer,i._em=new t({viewer:e.viewer}),i._ehCluster=i._em.dataSource.clustering.clusterEvent.addEventListener(function(e,t){"function"==typeof i._onClustering&&i._onClustering(e,t)}),i._ms=[]}(this,e)}var S=[0,Number.MAX_VALUE],b=Number.POSITIVE_INFINITY,x=[0,0,0,100],E=[255,255,0,255],M=[0,0,0,0],T=[7,5],P=[0,-20],F=[0,0],A=[255,255,255,255],I=[255,255,255,255],D=[0,0,0,255],R=[0,255,255,255],k=[255,255,255,0],O=new C.Cartographic,s=function(e){e._ms.splice(0,e._ms.length),e._em.removeAll(),c(e),d(e)},a=function(e){var t=_(e,"position",null);if(!t)return null;if(!(t instanceof C.Cartesian3))if(t instanceof Array)t=C.Cartesian3.fromDegrees(t[0],t[1],t[2]);else{if(null==t.lon)return null;t=C.Cartesian3.fromDegrees(t.lon,t.lat,t.height)}var i=_(e,"visibleRange",S),n=_(e,"depthTestDistance",b),r={position:t},o=_(e,"handleHeight",0);if(0<o){var s=C.Cartographic.fromCartesian(t,void 0,O),a=s.longitude,l=s.latitude,u=(s.height,s.height,[a,l,s.height,a,l,s.height+o]);C.Cartesian3.fromRadians(a,l,s.height+o,void 0,t);var c=_(e,"handleLineStyle","solid"),f=w.toColor(_(e,"handleLineColor",R)),h=w.toColor(_(e,"handleLineGapColor",k)),d=null;d="dash"==c?new C.PolylineDashMaterialProperty({color:f,gapColor:h}):f;var p=_(e,"handleVisibleRange",i);r.polyline={positions:C.Cartesian3.fromRadiansArrayHeights(u),width:_(e,"handleLineWidth",1),material:d,distanceDisplayCondition:new C.DistanceDisplayCondition(p[0],p[1])}}var m=_(e,"text",null);if(m){var g=_(e,"textPadding",T),v=_(e,"textOffset",P);p=_(e,"textVisibleRange",i);r.label={text:m,showBackground:_(e,"textBackground",!0),backgroundColor:w.toColor(_(e,"textBgColor",x)),backgroundPadding:new C.Cartesian2(g[0],g[1]),pixelOffset:new C.Cartesian2(v[0],v[1]),fillColor:w.toColor(_(e,"textColor",E)),outlineColor:w.toColor(_(e,"textLineColor",M)),outlineWidth:_(e,"textLineWidth",1),font:_(e,"textFont","14px sans-serif"),horizontalOrigin:_(e,"textHorizontalOrigin",C.HorizontalOrigin.CENTER),verticalOrigin:_(e,"textVerticalOrigin",C.VerticalOrigin.CENTER),distanceDisplayCondition:new C.DistanceDisplayCondition(p[0],p[1]),disableDepthTestDistance:_(e,"textDepthTestDistance",n),show:!0}}var y=_(e,"image",null);if(y){v=_(e,"imageOffset",F),p=_(e,"imageVisibleRange",i);r.billboard={image:y,width:_(e,"imageWidth",void 0),height:_(e,"imageHeight",void 0),pixelOffset:new C.Cartesian2(v[0],v[1]),color:w.toColor(_(e,"imageColor",A)),distanceDisplayCondition:new C.DistanceDisplayCondition(p[0],p[1]),disableDepthTestDistance:_(e,"imageDepthTestDistance",n),show:!0}}if(_(e,"point",null)){p=_(e,"pointVisibleRange",i);r.point={pixelSize:_(e,"pixelSize",1),color:w.toColor(_(e,"pointColor",I)),outlineWidth:_(e,"pointOutlineWidth",0),outlineColor:w.toColor(_(e,"pointOutlineColor",D)),heightReference:_(e,"heightReference",void 0),distanceDisplayCondition:new C.DistanceDisplayCondition(p[0],p[1]),disableDepthTestDistance:_(e,"pointDepthTestDistance",n),show:!0}}return r},l=function(e){c(e),e.handler&&e.handler.destroy(),delete e.handler},u=function(n){c(n),n.handler||(n.handler=new C.ScreenSpaceEventHandler(n.viewer.scene.canvas)),n.handler.setInputAction(function(e){var t=n.viewer.scene.pick(e.position);if(null!=t&&t.id&&t.id instanceof C.Entity&&n._em.contains(t.id)){var i=r(n._ms,"id",t.id.id);i&&"function"==typeof i.options.onClick&&i.options.onClick(i.id,i.options,t.id.position.getValue())}},C.ScreenSpaceEventType.LEFT_CLICK)},c=function(e){e.handler&&e.handler.removeInputAction(C.ScreenSpaceEventType.LEFT_CLICK)},f=function(e){d(e),e.dblhandler&&e.dblhandler.destroy(),delete e.dblhandler},h=function(n){d(n),n.dblhandler||(n.dblhandler=new C.ScreenSpaceEventHandler(n.viewer.scene.canvas)),n.dblhandler.setInputAction(function(e){var t=n.viewer.scene.pick(e.position);if(null!=t&&t.id&&t.id instanceof C.Entity&&n._em.contains(t.id)){var i=r(n._ms,"id",t.id.id);i&&"function"==typeof i.options.onDblClick&&i.options.onDblClick(i.id,i.options,t.id.position.getValue())}},C.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},d=function(e){e.dblhandler&&e.dblhandler.removeInputAction(C.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)};return Object.defineProperties(o.prototype,{clustering:{get:function(){return this._em.dataSource.clustering.enabled},set:function(e){this._em.dataSource.clustering.enabled=e}},onClustering:{set:function(e){this._onClustering=e}}}),o.prototype.destroy=function(){!function(e){l(e),f(e),e._ehCluster&&(e._ehCluster(),delete e._ehCluster),s(e),e._em.destroy(),delete e._em,delete e._ms,delete e.viewer}(this)},o.prototype.clear=function(){s(this)},o.prototype.add=function(e){return function(e,t){var i=a(t);if(!i)return null;var n=e._em.add(i);return e._ms.push({id:n.id,options:t}),1==e._ms.length&&(h(e),u(e)),n.id}(this,e)},o.prototype.remove=function(e){!function(e,t){e._em.removeById(t),function(e,t,i){if(!e)return;for(var n=[],r=0;r<e.length;r++)e[r][t]==i&&n.push(e.splice(r--,1)[0])}(e._ms,"id",t),0==e._ms.length&&(c(e),d(e))}(this,e)},o.prototype.show=function(){this._em.show()},o.prototype.hide=function(){this._em.hide()},o.prototype.beginAdd=function(){this._em.beginAdd()},o.prototype.endAdd=function(){this._em.endAdd()},o},this),function(n,r){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil");module.exports=n(e,t,i,r)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil"],function(e,t,i){return n(e,t,i,r)});else{null==r.SFM&&(r.SFM={}),r.SFM||(r.SFM={});var o=r.SFM.cesiumlib||(r.SFM.cesiumlib={});r.SFM.cesiumlib.SfmCFlowMaterial=n(r.Cesium,o.sfmCEnum,o.sfmCesiumUtil,r),delete o.SfmCFlowMaterial}}(function(i,e,t,n){var r="data:image/png;base64,UklGRgYBAABXRUJQVlA4WAoAAAAQAAAA/wEAHwAAQUxQSF0AAAABGYBIan/vFSL6nwq1AdA05P+7KbI5ETEBDNy2beTudcd3IBwAtc8rOHYlCfae+5IAtPuMEH6pd88gHn/QRPXuhV8SAElo9wLgvpTcY4JdKYHe//4y/zP/M/+zAAIAVlA4IIIAAAAQCACdASoAAiAAPpFGoUylo6MiIRgIALASCWlu4XSZcAyQDJAP0AABb6zbjMa85p7jUSrzW19OnTfkBCBlV9PcaiVea2vp06OAAP7Zduisn/6kgOThZlbFzsz//+o0/49bVKy/+tD/8jT/j1tUrL+53caJBXBDoE4hFE+WdcAAAAAA";i.Material.ZlskFlowMaterialType="ZlskFlowMaterial";function o(e){e=e||{},this._definitionChanged=new i.Event,this._color=void 0,this._colorSubscription=void 0,this._image=void 0,this._time=(new Date).getTime(),this._duration=void 0,this._repeat=void 0,this._blendMode=void 0,this._blendAmount=void 0,this.color=e.color,this.image=e.image,this.duration=e.duration,this.repeat=e.repeat,this.blendMode=i.defaultValue(e.blendMode,1),this.blendAmount=i.defaultValue(e.blendAmount,.5)}i.Material._materialCache.addMaterial(i.Material.ZlskFlowMaterialType,{fabric:{type:i.Material.ZlskFlowMaterialType,uniforms:{color:new i.Color(1,1,1,1),image:r,time:1,repeat:new i.Cartesian2(1,1),blendMode:1,blendAmount:.5},source:"czm_material czm_getMaterial(czm_materialInput materialInput)\n            {\n                czm_material material = czm_getDefaultMaterial(materialInput);\n                vec2 st = materialInput.st;\n                vec4 colorImage = texture2D(image, fract(repeat * st - repeat * time));\n                material.alpha = colorImage.a * color.a;\n                if(blendMode == 0.0){\n                    material.diffuse = vec3(colorImage.r * color.r, colorImage.g * color.g, colorImage.b * color.b);\n                }else if(blendMode == 1.0){\n                    material.diffuse = color.rgb;\n                }else if(blendMode == 2.0){\n                    float m_a2 = 1.0 - blendAmount;\n                    float m_c_r = colorImage.r * m_a2 + color.r * blendAmount;\n                    float m_c_g = colorImage.g * m_a2 + color.g * blendAmount;\n                    float m_c_b = colorImage.b * m_a2 + color.b * blendAmount;\n                    material.diffuse = vec3(m_c_r, m_c_g, m_c_b);\n                }else{\n                    material.diffuse = color.rgb;\n                }\n                return material;\n            }"},translucent:function(e){return!0}}),o.prototype.getType=function(e){return"ZlskFlowMaterial"},o.prototype.getValue=function(e,t){return i.defined(t)||(t={}),t.color=i.Property.getValueOrClonedDefault(this._color,e,i.Color.WHITE,t.color),t.image=i.Property.getValueOrDefault(this._image,e,r,t.image),t.duration=i.Property.getValueOrDefault(this._duration,e,3e3,t.duration),t.time=((new Date).getTime()-this._time)%t.duration/t.duration,t.repeat=i.Property.getValueOrClonedDefault(this._repeat,e,new i.Cartesian2(1,1),t.repeat),t.blendMode=i.Property.getValueOrDefault(this._blendMode,e,1,t.blendMode),t.blendAmount=i.Property.getValueOrDefault(this._blendAmount,e,.5,t.blendAmount),t},o.prototype.equals=function(e){return this===e||e instanceof o&&i.Property.equals(this._color,e._color)&&i.Property.equals(this._image,e._image)&&i.Property.equals(this._duration,e._duration)&&i.Property.equals(this._repeat,e._repeat)},i.defineProperties(o.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:i.createPropertyDescriptor("color"),image:i.createPropertyDescriptor("image"),duration:i.createPropertyDescriptor("duration"),repeat:i.createPropertyDescriptor("repeat"),blendMode:i.createPropertyDescriptor("blendMode"),blendAmount:i.createPropertyDescriptor("blendAmount")}),i.ZlskFlowMaterialProperty=o},this),function(n,r){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil");module.exports=n(e,t,i,r)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil"],function(e,t,i){return n(e,t,i,r)});else{null==r.SFM&&(r.SFM={}),r.SFM||(r.SFM={});var o=r.SFM.cesiumlib||(r.SFM.cesiumlib={});r.SFM.cesiumlib.SfmCLayerStyleManager=n(r.Cesium,o.sfmCEnum,o.sfmCesiumUtil,r)}}(function(r,e,t,i){function n(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}function s(e,t,i){if(e)for(var n=0;n<e.length;n++){var r=e[n];if(r[t]==i)return r}return null}function l(e,t,i){var n=[];if(e)for(var r=0;r<e.length;r++){e[r][t]==i&&n.push(e.splice(r--,1)[0])}return n}function u(e,t,i){if(e)for(var n=0;n<e.length;n++){if(e[n][t]==i)return e.splice(n--,1)[0]}return null}function a(e,t){if(!function(e){return"show"==e||"color"==e}(t))return null;var i=function(e){return e?e instanceof h.Expression?e.expression:e instanceof h.ConditionsExpression?e.conditionsExpression:null:null}(n(e,t,null));return p[t](i)}function o(e,t,i){var n=s(e.data.style,"layer",t);n||e.data.style.push(n={layer:t,style:{},ostyle:{}});var r=n.style;r[i]||(r[i]=a(t.style,i));var o=n.ostyle;return o[i]||(o[i]=d(r[i])),o[i]}function c(e,t,i){return t?(o(e,t,i),a(t.style,i)):null}function f(){!function(e){e.data={},e.data.style=[]}(this)}var h=r,d=(e.layerType,function(e){if(null==e)return e;if("string"==typeof e||"number"==typeof e||"boolean"==typeof e||"function"==typeof e)return e;if(e instanceof Array){for(var t=[],i=0;i<e.length;i++)t.push(d(e[i]));return t}var n={};for(var r in e){var o=e[r];n[r]=d(o)}return n}),p={show:function(e){return e?"true"==e||"false"==e||1==e||0==e||null==e?[["true",e]]:"string"==typeof e?[[e,!0]]:"object"==typeof e?e.conditions:void 0:[["true","true"]]},color:function(e){return e?"string"==typeof e?[["true",e]]:"object"==typeof e?e.conditions:void 0:[["true","rgba(255, 255, 255, 1)"]]}},m=function(e,t,i){g(e,t,{conditions:i})},g=function(e,t,i){if(e)if(e.style)e.style[t]=i,e.style=e.style;else{var n={};n[t]=i,e.style=new r.Cesium3DTileStyle(n)}};return f.prototype.addStyleItems=function(e,t,i,n){!function(e,t,i,n,r){var o=c(e,t,i);if(!o)return;null==r&&(r=0);var s=o.slice(0,r).concat(n).concat(o.slice(r));m(t,i,s)}(this,e,t,i,n)},f.prototype.removeStyleItems=function(e,t,i,n){!function(e,t,i,n,r){if(n&&0!=n.length){var o=c(e,t,i);if(o&&0!=o.length){for(var s=0;s<n.length;s++){var a=n[s];a instanceof Array&&(a=a[0]),r?l(o,0,a):u(o,0,a)}m(t,i,o)}}}(this,e,t,i,n)},f.prototype.getOriginStyleItems=function(e,t){return function(e,t,i){return t?o(e,t,i):null}(this,e,t)},f.prototype.getStyleItems=function(e,t){return c(this,e,t)},f.prototype.setStyleItems=function(e,t,i){!function(e,t,i,n){t.style[i]={conditions:n||[]}}(0,e,t,i)},f.prototype.restoreStye=function(e,t){!function(e,t,i){var n=s(e.data.style,"layer",t);n||e.data.style.push(n={layer:t,style:{}}),(n=n.style)[i]&&m(t,i,n[i])}(this,e,t)},f.prototype.setLayerStyleConditions=function(e,t,i){m(e,t,i)},f},this),function(r,o){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil"),n=require("sfmCLayerStyleManager");module.exports=r(e,t,i,n,o)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil","sfmCLayerStyleManager"],function(e,t,i,n){return r(e,t,i,n,o)});else{null==o.SFM&&(o.SFM={}),o.SFM||(o.SFM={});var s=o.SFM.cesiumlib||(o.SFM.cesiumlib={});o.SFM.cesiumlib.sfmCLayerStyleHelper=r(o.Cesium,s.sfmCEnum,s.sfmCesiumUtil,s.SfmCLayerStyleManager,o)}}(function(r,e,t,i,n){function d(e,t,i){if(e)for(var n=0;n<e.length;n++){var r=e[n];if(r[t]==i)return r}return null}function l(e,t){if(e)for(var i=0;i<e.length;i++){var n=e[i];if(n[0]==t[0]&&n[2]==t[2])return n}return null}function u(e,t){var i=[];if(e)for(var n=0;n<e.length;n++){var r=e[n];r[0]==t[0]&&r[2]==t[2]&&i.push(e.splice(n--,1)[0])}return i}function c(e,t){if(e)for(var i=0;i<e.length;i++){var n=e[i];if(n[0]==t[0]&&n[2]==t[2])return e.splice(i--,1)[0]}return null}function p(e,t){return o[e[2]]-o[t[2]]}function m(e,t,i){var n=d(f,"layer",e);if(!n){f.push(n={layer:e,style:{},ostyle:{}});for(var r=0;r<h.length;r++)for(var o=h[r],s=n.ostyle[o]=v(e,o),a=0;a<s.length;a++)"color"==o&&(s[a][1]=C(s[a][1])),s[a].push("origin")}var l=i?n.ostyle:n.style;return null==t?l:l[t]||(l[t]=[])}var g=new i,f=[],o={highlight:10,layeropacity:100,layerstyle:1e3,layervisible:10,origin:Number.POSITIVE_INFINITY},h=["show","color"],v=function(e,t){return g.getOriginStyleItems(e,t)},y=function(e){var t=m(e),i=m(e,null,!0),n=(t.show||[]).concat(i.show||[]).sort(p),r=[].concat(n);r.sort(p),r=r.map(function(e){return[e[0],e[1]]});for(var o=(t.color||[]).concat(i.color||[]).sort(p).map(function(e){return[e[0],e[1],e[2]]}),s=(t.alpha||[]).sort(p).map(function(e){return[e[0],e[1],e[2]]}),a=[].concat(o),l=0;l<s.length;l++){var u=s[l],c=d(a,0,u[0]);if(c)3==(h=c[1]).length?h.push(u[1]):h[3]=u[1];else a.push([u[0],[255,255,255,u[1]],u[2]])}a.sort(p);for(l=0;l<a.length;l++){var f=a[l],h=f[1];f[1]="rgba("+h[0]+", "+h[1]+", "+h[2]+", "+(3<h.length?h[3]:1)+")",f.pop()}g.setLayerStyleConditions(e,"show",r),g.setLayerStyleConditions(e,"color",a)},C=function(e){if(!e)return[255,255,255,1];for(var t=e.indexOf("("),i=e.indexOf(")"),n=e.slice(t+1,i).split(","),r=[],o=0;o<n.length;o++)r.push(Number(n[o]));return r};return{setLayerOpacity:function(e,t){if(t<0&&(t=0),1<t&&(t=1),e instanceof r.Cesium3DTileset){var i=-g.getOriginStyleItems(e,"color").length,n=[["true","rgba(255, 255, 255, "+t+")"]];g.addStyleItems(e,"color",n,i)}},addStyleItems:function(e,t,i,n){return function(e,t,i,n){if(i&&0!=i.length){for(var r=m(e,t),o=0;o<i.length;o++)r.push(i[o]);!1!==n&&y(e)}}(e,t,i)},removeStyleItems:function(e,t,i,n,r){return function(e,t,i,n,r){if(i&&0!=i.length){var o=m(e,t);if(0!=o.length){for(var s=0;s<i.length;s++){var a=i[s];n?u(o,a):c(o,a)}!1!==r&&y(e)}}}(e,t,i,n,r)},addOrUpdateStyleItems:function(e,t,i,n){return function(e,t,i,n){if(i&&0!=i.length){for(var r=m(e,t),o=0;o<i.length;o++){var s=i[o],a=l(r,s);a?a[1]=s[1]:r.push(s)}!1!==n&&y(e)}}(e,t,i,n)},getStyleItem:function(e,t,i){return function(e,t,i){if(!i)return null;var n=m(e,t),r=l(n,i);return r||(n=m(e,t,!0),(r=l(n,i))||null)}(e,t,i)},update:function(e){y(e)}}},this),function(l,u){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil"),n=require("sfmCShaderSource"),r=require("sfmCGoogleImageryProviderHelper"),o=require("sfmCTdtImageryProviderHelper"),s=require("sfmCBaiduImageryProvider"),a=require("sfmCLayerStyleHelper");module.exports=l(e,t,i,n,r,o,s,a,u)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil","sfmCShaderSource","sfmCGoogleImageryProviderHelper","sfmCTdtImageryProviderHelper","sfmCBaiduImageryProvider","sfmCLayerStyleHelper"],function(e,t,i,n,r,o,s,a){return l(e,t,i,n,r,o,s,a,u)});else{null==u.SFM&&(u.SFM={}),u.SFM||(u.SFM={});var c=u.SFM.cesiumlib||(u.SFM.cesiumlib={});u.SFM.cesiumlib.SfmCLayerManager=l(u.Cesium,c.sfmCEnum,c.sfmCesiumUtil,c.sfmCShaderSource,c.sfmCGoogleImageryProviderHelper,c.sfmCTdtImageryProviderHelper,c.SfmCBaiduImageryProvider,c.sfmCLayerStyleHelper,u),delete c.sfmCGoogleImageryProviderHelper,delete c.sfmCTdtImageryProviderHelper,delete c.SfmCBaiduImageryProvider}}(function(f,e,h,o,s,a,l,u,t){function d(){return"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".replace(/x/g,function(e){return(16*Math.random()|0).toString(16)})}function c(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}function r(e){if(!e)return null;var t=e.type,i=null;switch(t=E[t.toUpperCase()]){case E.ARCGIS_MAP_SERVER:if(!e.url)return null;i=new x.ArcGisMapServerImageryProvider(e);break;case E.ARCGIS_SATELLITE:i=new x.ArcGisMapServerImageryProvider({url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"});break;case E.ARCGIS_WORLD_STREET_MAP:i=new x.ArcGisMapServerImageryProvider({url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"});break;case E.BAIDU:i=new l(e);break;case E.BING_MAP_AERIAL:e.url||(e.url="https://dev.virtualearth.net"),e.key||(e.key="Ap_cv0-3QHFzKgGUenjAWOcyLvh3xbpEqEJl5mglfJBF_rPrqtiYIGlWxdpauan2"),e.mapStyle=x.BingMapsStyle.AERIAL,i=new x.BingMapsImageryProvider(e);break;case E.BING_MAP_ROAD:e.url||(e.url="https://dev.virtualearth.net"),e.key||(e.key="Ap_cv0-3QHFzKgGUenjAWOcyLvh3xbpEqEJl5mglfJBF_rPrqtiYIGlWxdpauan2"),e.mapStyle=x.BingMapsStyle.ROAD,i=new x.BingMapsImageryProvider(e);break;case E.GOOGLE:i=s.createImageryProvider();break;case E.OPEN_STREET_MAPS:i=x.createOpenStreetMapImageryProvider();break;case E.MAPQUEST_OPEN_STREET_MAPS:i=x.createOpenStreetMapImageryProvider({url:"https://otile1-s.mqcdn.com/tiles/1.0.0/osm/"});break;case E.SINGLEIMAGE:if((r=L(e)).rectangle&&!(r.rectangle instanceof x.Rectangle)){var n=e.rectangle;r.rectangle=new x.Rectangle.fromDegrees(n[0],n[1],n[2],n[3])}i=new x.SingleTileImageryProvider(r);break;case E.TDT_YX:i=a.createImageryProvider({layer:"img",tk:e.key});break;case E.TDT_YX_ZJ:i=a.createImageryProvider({layer:"cia",tk:e.key});break;case E.TDT_SL:i=a.createImageryProvider({layer:"vec",tk:e.key});break;case E.TDT_SL_ZJ:i=a.createImageryProvider({layer:"cva",tk:e.key});break;case E.TDT_JJ:i=a.createImageryProvider({layer:"ibo",tk:e.key});break;case E.WMS:i=new x.WebMapServiceImageryProvider(e);break;case E.WMTS:if(!e.url)return null;var r=L(e);if("WGS84"==e.tilingScheme&&(r.tilingScheme=new x.GeographicTilingScheme),e.rectangle&&!(e.rectangle instanceof x.Rectangle))"string"==typeof(n=e.rectangle)&&(n=n.split(",")),n instanceof Array&&(r.rectangle=new x.Rectangle.fromDegrees(n[0],n[1],n[2],n[3]));"string"==typeof r.tileMatrixLabels&&(r.tileMatrixLabels=r.tileMatrixLabels.split(",")),i=new x.WebMapTileServiceImageryProvider(r);break;case E.TMS:if(!e.url)return null;r=L(e);if("WGS84"==e.tilingScheme&&(r.tilingScheme=new x.GeographicTilingScheme),e.rectangle&&!(e.rectangle instanceof x.Rectangle)){n=e.rectangle;r.rectangle=new x.Rectangle.fromDegrees(n[0],n[1],n[2],n[3])}"function"==typeof x.createTileMapServiceImageryProvider?i=x.createTileMapServiceImageryProvider(r):x.TileMapServiceImageryProvider&&(i=new x.TileMapServiceImageryProvider(r));break;case E.URL:if(!e.url)return null;r=L(e);if("WGS84"==e.tilingScheme&&(r.tilingScheme=new x.GeographicTilingScheme),e.rectangle&&!(e.rectangle instanceof x.Rectangle)){n=e.rectangle;r.rectangle=new x.Rectangle.fromDegrees(n[0],n[1],n[2],n[3])}i=new x.UrlTemplateImageryProvider(r);break;default:return null}return i}function p(e){if(!e)return null;var t=e.type;t=E[t.toUpperCase()];var i=null,n={};for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);switch(x.defined(n.ellipsoid)&&(n.ellipsoid=h.toEllipsoid(n.ellipsoid)),t){case E.ELLIPSOID_TERRAIN:i=new x.EllipsoidTerrainProvider(n);break;case E.CESIUM_TERRAIN:i=new x.CesiumTerrainProvider(n);break;default:return null}return i}function m(e){if(!e)return null;var t=e.type;if(!t||!E[t=t.toUpperCase()])return null;var i=T(t);return 1==i?p(e):2==i?r(e):null}function i(r){return r=r||{},new x.ProviderViewModel({name:r.name,tooltip:r.tooltip||r.name,iconUrl:r.iconUrl,category:r.category,creationFunction:function(){if(Array.isArray(r)){for(var e=[],t=0,i=r.length;t<i;t++){var n=m(r[t]);n&&e.push(n)}return e}return m(r)}})}function g(e){var t=r(e);if(!t)return null;var i=e.layerOptions||{};i.show=!1!==e.visible;var n=new x.ImageryLayer(t,i);return{gid:d(),layer:n,type:e.type,options:e}}function v(e){if(!e||!e.url)return null;var t={url:e.url,show:!1!==e.visible};for(var i in e)"visible"!=i&&e.hasOwnProperty(i)&&(t[i]=e[i]);var n=new f.Cesium3DTileset(t);return t.effect&&D(n,t.effect),e.style&&(n.style=new x.Cesium3DTileStyle(e.style)),null!=t.colorBlendMode&&(n.colorBlendMode=t.colorBlendMode),null!=t.colorBlendAmount&&(n.colorBlendAmount=t.colorBlendAmount),{gid:d(),primitive:n,type:e.type,options:e}}function y(u,c){if(!u||!u.url&&!u.data)return null;var e=new f.GeoJsonDataSource(u.name);e.show=!1!==u.visible;var t={};for(var i in u)"visible"!=i&&u.hasOwnProperty(i)&&(t[i]=u[i]);return x.defined(t.markerColor)&&(t.markerColor=h.toColor(t.markerColor)),x.defined(t.stroke)&&(t.stroke=h.toColor(t.stroke)),x.defined(t.fill)&&(t.fill=h.toColor(t.fill)),e.load(u.data||u.url,t).then(function(e){for(var t=e.entities.values,i=null,n=null,r=null,o=0,s=t.length;o<s;o++){var a=t[o],l=a.properties;(i=a.polygon)&&(n=u.style&&u.style.polygon)&&(x.defined(n.height)&&(i.height=n.height),x.defined(n.heightProperty)&&x.defined(r=l[n.heightProperty])&&(i.height=Number(r)),x.defined(n.heightReference)&&(i.heightReference=Number(n.heightReference)),x.defined(n.extrudedHeight)&&(i.extrudedHeight=n.extrudedHeight),x.defined(n.extrudedHeightProperty)&&x.defined(r=l[n.extrudedHeightProperty])&&(i.extrudedHeight=Number(r)),x.defined(n.extrudedHeightReference)&&(i.extrudedHeightReference=Number(n.extrudedHeightReference)),x.defined(n.fill)&&(i.fill=n.fill),x.defined(n.fillProperty)&&x.defined(r=l[n.fillProperty])&&(i.fill=!!r),x.defined(n.fillColor)&&(i.material=h.toColor(n.fillColor)),x.defined(n.fillColorProperty)&&x.defined(r=l[n.fillColorProperty])&&(i.material=h.toColor(r)),x.defined(n.outline)&&(i.outline=n.outline),x.defined(n.outlineProperty)&&x.defined(r=l[n.outlineProperty])&&(i.outline=!!r),x.defined(n.outlineWidth)&&(i.outlineWidth=n.outlineWidth),x.defined(n.outlineWidthProperty)&&x.defined(r=l[n.outlineWidthProperty])&&(i.outlineWidth=Number(r)),x.defined(n.outlineColor)&&(i.outlineColor=h.toColor(n.outlineColor)),x.defined(n.outlineColorProperty)&&x.defined(r=l[n.outlineColorProperty])&&(i.outlineColor=h.toColor(r)),x.defined(n.classificationType)&&(i.classificationType=n.classificationType),x.defined(n.classificationTypeProperty)&&x.defined(r=l[n.classificationTypeProperty])&&(i.classificationType=Number(r)))}"function"==typeof c&&c(e)}),{gid:d(),datasource:e,type:u.type,options:u}}function C(e,t,i){var n=g(t);return n?(e.imageryLayers.add(n.layer,i),n):null}function w(e,t,i){var n=v(t);if(!n)return null;var r=e.scene.primitives.add(n.primitive);return t.pose&&r.readyPromise.then(function(e){!function(e,t){var i=e.boundingSphere.center;i=f.Matrix4.getTranslation(e._root.transform,new f.Cartesian3);var n=f.Cartographic.fromCartesian(i),r=null==t.lon?f.Math.toDegrees(n.longitude):t.lon,o=null==t.lat?f.Math.toDegrees(n.latitude):t.lat,s=null==t.height?n.height:t.height,a=f.Cartesian3.fromDegrees(r,o,s),l=f.Transforms.eastNorthUpToFixedFrame(a),u=null;t.rx&&(u=f.Matrix3.fromRotationX(f.Math.toRadians(t.rx)),u=f.Matrix4.fromRotationTranslation(u),f.Matrix4.multiply(l,u,l)),t.ry&&(u=f.Matrix3.fromRotationY(f.Math.toRadians(t.ry)),u=f.Matrix4.fromRotationTranslation(u),f.Matrix4.multiply(l,u,l)),t.rz&&(u=f.Matrix3.fromRotationZ(f.Math.toRadians(t.rz)),u=f.Matrix4.fromRotationTranslation(u),f.Matrix4.multiply(l,u,l)),t.scale&&f.Matrix4.multiplyByUniformScale(l,t.scale,l),e._root.transform=l}(e,t.pose),"function"==typeof i&&i(e)}).otherwise(function(e){}),n}function S(e,t,i){var n=y(t,i);return n?(e.dataSources.add(n.datasource),n):null}var n="layeropacity",b="layerstyle",x=f,E=e.layerType,M=new f.EllipsoidTerrainProvider,T=function(e){return e?0<=e.indexOf("FOLDER")?0:0<=e.indexOf("TERRAIN")?1:0<=e.indexOf("3DTILES")?3:0<=e.indexOf("GEOJSON")?3:E[e]?2:-1:-1},P=function(e,t){if(e)for(;0<e.length;){var i=e.pop();i.layer&&t.imageryLayers.remove(i.layer,!0),i.primitive&&(t.scene.primitives.remove(i.primitive),i.primitive.destroy()),i.datasource&&t.dataSources.remove(i.datasource,!0),i.terrain&&(t.terrainProvider=visible?i.terrain:M)}},F=function(e){return!e||!e.type||E[e.type.toUpperCase()]==E.FOLDER},A=function(e,t){t<0&&(t=0),1<t&&(t=1);var i=[["true",t,n]];u.addOrUpdateStyleItems(e,"alpha",i)},I=function(e){var t=u.getStyleItem(e,"alpha",["true",null,n]);return t?t[1]:(t=u.getStyleItem(e,"color",["true",null,"origin"]))?null==t[3]?1:t[3]:1},D=function(e,t){if(t){var i=t.data||{},n=c(i,"color",c(t,"color",null));n&&u.addOrUpdateStyleItems(e,"color",[["true",n,b]]);var r=c(t,"type","");"ls"==r||"lightStripe"==r?(e._zlskSs=o.getSource("lightStripe"),e._zlskUniforms={u_zlskCycle1:c(i,"cycle1",180),u_zlskCycle2:c(i,"cycle2",120),u_zlskMaxHeight:c(i,"maxHeight",120)}):"lsex"==r||"lightStripeEx"==r?(e._zlskSs=o.getSource("lightStripeEx"),e._zlskUniforms={u_zlskMaxHeight:c(i,"maxHeight",120),u_zlskF1:c(i,"fScanning",1),u_zlskCycle1:c(i,"cycle1",180),u_zlskF2:c(i,"fGradient",1),u_zlskCycle2:c(i,"cycle2",120),u_zlskOffset:c(i,"offset",.1),u_zlskIntensity1:c(i,"intensity1",2),u_zlskSc:h.toColor(c(i,"sc",[51,51,51,1])),u_zlskEc:h.toColor(c(i,"ec",[230,230,230,1])),u_zlskSp:c(i,"sp",0),u_zlskEp:c(i,"ep",1),u_zlskF3:c(i,"fStripe",1),u_zlskIntensity2:c(i,"intensity2",2)}):"gradient"==r?(e._zlskSs=o.getSource("gradient"),e._zlskUniforms={u_zlskCycle:c(i,"cycle",120),u_zlskOffset:c(i,"offset",0),u_zlskLightColor:h.toColor(c(i,"lc",[255,255,255,1])),u_zlskIntensity:c(i,"intensity",1),u_zlskSc:h.toColor(c(i,"sc",[230,230,230,1])),u_zlskEc:h.toColor(c(i,"ec",[77,77,77,1])),u_zlskSp:c(i,"sp",0),u_zlskEp:c(i,"ep",1),u_zlskMaxHeight:c(i,"maxHeight",120)}):(delete e._zlskSs,delete e._zlskUniforms)}else!function(e){u.removeStyleItems(e,"color",[["true",null,b]],!0),delete e._zlskSs}(e)},R=function(e,t,i){if(e){e.options.visible=t;var n=k(e,i);e.layer&&e.layer.show!=n&&(e.layer.show=n),e.primitive&&e.primitive.show!=n&&(e.primitive.show=n),e.datasource&&e.datasource.show!=n&&(e.datasource.show=n),e.terrain&&(i.terrainProvider=t?e.terrain:M)}},k=function(e,t){if(!e)return!1;if(!1===e.options.visible)return!1;if(e.options.visibleRange){var i=t.camera.positionCartographic.height,n=e.options.visibleRange.min||0,r=e.options.visibleRange.max||100;if(i<n||r<=i)return!1}return!0},O=function(e){var t;if(e)for(var i=0;i<e.length;i++){var n=e[i];F(n.layerInfo)?O(n.children):n.checked=null!=(t=n.layerInfo)&&!1!==t.visible}},L=function(e,t){for(var i in t=t||{},e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t};return t.SFM.Base.extend({constructor:function(e){var t=this;t.data={};var i=t.data.cv=e.viewer;t.data.allLayers=[],t.data.layers=[],t.data.baseLayers=[],t.data.layerTree=[],t.data.baseStGroup=[];i.camera.changed.addEventListener(function(){(function(){for(var e=0;e<this.data.allLayers.length;e++){var t=this.data.allLayers[e],i=k(t,this.data.cv);t.layer&&t.layer.show!=i&&(t.layer.show=i),t.primitive&&t.primitive.show!=i&&(t.primitive.show=i)}}).apply(this)},t)},isFolder:F,createImageryProvider:r,createTerrainProvider:p,createProviderViewModel:i,createImageryLayer:g,create3dTileset:v,addImageryLayer:C,add3dTileset:w,loadGeoJson:function(e,t,i){return y(t,i)},addGeoJson:S,addOneLayer:function(e,t){var i=this,n=null,r=e.type.toUpperCase();if("C3DTILES"==r)n=w(i.data.cv,e,c(e.handler,"onLoad",null));else if("GEOJSON"==r)n=S(i.data.cv,e,c(e.handler,"onLoad",null));else if("DATASOURCE"==r)n={gid:d(),datasource:e.datasource,type:e.type,options:e},delete e.datasource;else if(1==T(r)){var o=p(e);o&&(i.data.cv.terrainProvider=o),n={gid:d(),terrain:o,type:e.type,options:e}}else n=C(i.data.cv,e,e.layerIndex);if(n)if(i.data.allLayers.push(n),void 0===t?!!e.isBaseLayer:!!t){i.data.baseLayers.push(n);var s=e.stGroup,a=e.stGroupLabel||s;s&&i.addToBaseGroup({name:s,label:a,tip:e.tip||a,thumbnail:e.thumbnail||""})}else i.data.layers.push(n);return n},addLayer:function(e,t){if(!e)return null;var i={id:d(),name:e.name,checked:!1!==e.visible,layerInfo:e};if(F(e)){if(e.children){i.children=[];for(var n=0,r=e.children.length;n<r;n++){var o=this.addLayer(e.children[n],t);o&&i.children.push(o)}}}else{var s=this.addOneLayer(e,t);s&&(i.layerId=s.gid)}return!1!==e.showOnTree?i:null},addLayerFromConfig:function(e){if(e){if(e.baseLayers)for(var t=0,i=e.baseLayers.length;t<i;t++)this.addLayer(e.baseLayers[t]);if(e.layers)for(t=0,i=e.layers.length;t<i;t++){var n=this.addLayer(e.layers[t],!1);n&&this.data.layerTree.push(n)}return this}},removeLayers:function(){P(this.data.layers,this.data.cv)},getLayerTree:function(){return O(this.data.layerTree),this.data.layerTree},getLayerById:function(t){return _.find(this.data.allLayers,function(e){return e.gid==t})},getLayerByName:function(t){return _.find(this.data.layers,function(e){return e.options.name==t})},findLayers:function(e,t){return _.filter(this.data[t?"allLayers":"layers"],e)},getLayerInfo:function(t){return _.find(this.data.allLayers,function(e){return e.primitive==t||e.datasource==t||e.layer==t})},setLayerVisibleById:function(t,e){var i=_.find(this.data.allLayers,function(e){return e.gid==t});i&&R(i,e,this.data.cv)},setLayerVisibleByName:function(t,e){var i=_.find(this.data.layers,function(e){return e.options.name==t});i&&R(i,e,this.data.cv)},setLayerVisibleByGroup:function(e,t){for(var i=0;i<this.data.allLayers.length;i++){var n=this.data.allLayers[i];n.options.stGroup==e&&R(n,t,this.data.cv)}return this},setLayerStyleByGroup:function(e,t){for(var i=t?new x.Cesium3DTileStyle(t):void 0,n=0;n<this.data.allLayers.length;n++){var r=this.data.allLayers[n];r.options.stGroup==e&&r.primitive&&(r.primitive.style=i)}return this},set3dtilesOpacityById:function(t,e){var i=_.find(this.data.allLayers,function(e){return e.gid==t});i&&i.primitive&&A(i.primitive,e)},set3dtilesOpacityByName:function(t,e){var i=_.find(this.data.layers,function(e){return e.options.name==t});i&&i.primitive&&A(i.primitive,e)},set3dtilesOpacityByGroup:function(e,t){for(var i=0;i<this.data.allLayers.length;i++){var n=this.data.allLayers[i];n.options.stGroup==group&&n.primitive&&A(lo.primitive,t)}},get3dtilesOpacityById:function(t){var e=_.find(this.data.allLayers,function(e){return e.gid==t});return e&&e.primitive?I(e.primitive):1},set3dtilesEffectById:function(t,e){var i=_.find(this.data.allLayers,function(e){return e.gid==t});i&&i.primitive&&D(i.primitive,e)},set3dtilesEffectByName:function(t,e){var i=_.find(this.data.layers,function(e){return e.options.name==t});i&&i.primitive&&D(i.primitive,e)},set3dtilesEffectByGroup:function(e,t){for(var i=0;i<this.data.allLayers.length;i++){var n=this.data.allLayers[i];n.options.stGroup==group&&n.primitive&&D(lo.primitive,t)}},viewLayerById:function(e,t){var i,n=this.getLayerById(e);if(!n)return this;if(n&&(i=h.toViewPose(function(e){return e&&e.options&&e.options.viewPose||null}(n))),!i){var r=n.layer||n.primitive||n.datasource;return r&&this.data.cv.flyTo(r),this}var o=void 0===t?!1!==i.fly:!!t;return this.data.cv.camera[o?"flyTo":"setView"](i),this},__className__:"SfmCLayerManager",version:"1.0.0"},{createImageryProvider:r,createTerrainProvider:p,createProviderViewModel:i})},this),function(r,o){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil"),n=require("sfmCLayerStyleHelper");module.exports=r(e,t,i,n,o)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil","sfmCLayerStyleHelper"],function(e,t,i,n){return r(e,t,i,n,o)});else{null==o.SFM&&(o.SFM={}),o.SFM||(o.SFM={});var s=o.SFM.cesiumlib||(o.SFM.cesiumlib={});o.SFM.cesiumlib.SfmCHighlightManager=r(o.Cesium,s.sfmCEnum,s.sfmCesiumUtil,s.sfmCLayerStyleHelper,o)}}(function(e,t,i,n,r){function d(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}function p(e,t){if(!t)return null;var i=function(e,t,i){if(e)for(var n=0;n<e.length;n++){var r=e[n];if(r[t]==i)return r}return null}(e.data.hlks,"l",t);return i||e.data.hlks.push(i={l:t,s:[]}),i=i.s}function m(e,t){for(var i=0;i<t.length;i++)t[i].length<3&&t[i].push(s);a.addStyleItems(e,"color",t)}function g(e,t,i){a.removeStyleItems(e,"color",[[t,null,s]],i)}function v(e,t,i,n){var r=p(e,t);if(r)for(var o=0;o<i.length;o++)for(var s=i[o],a=0;a<r.length;a++){var l=r[a];if(l.c==s&&(l.t&&(clearInterval(l.t),delete l.t),g(t,s),r.splice(a--,1),!n))return}}function l(n,r,e,o){var s=p(n,r);if(s){var a=d(o,"color",y);if(d(o,"flash",!1))for(var t=d(o,"flashCount",5),l=d(o,"flashInterval",1e3),u=0,c=2*t,i=0;i<e.length;i++){!function(e){var t=[[e,a]];m(r,t);var i=setInterval(function(){++u>=c?d(o,"highlight",!1)?(m(r,t),clearInterval(i)):v(n,r,[e],!0):u%2==0?m(r,t):g(r,e,!0)},l/2);s.unshift({c:e,t:i,color:a,o:o})}(h=e[i])}else{var f=[];for(i=0;i<e.length;i++){var h=e[i];f.push([h,a]),s.unshift({c:h,color:a,o:o})}m(r,f)}}}function o(e){!function(e){e.data={},e.data.hlks=[]}(this)}var s="highlight",y=[255,0,0,1],a=(t.layerType,n),u=function(e,t){var i=p(e,t);if(i)for(;0<i.length;){var n=i.shift();n.t&&(clearInterval(n.t),delete n.t),g(t,n.c)}};return o.prototype.showHighlight=function(e,t,i){l(this,e,t,i)},o.prototype.showHighlightByKey=function(e,t,i,n,r){r=r||"id",t instanceof Array||(t=[t]);for(var o=[],s=0;s<t.length;s++){var a=!1!==i?"${"+r+'} === "'+t[s]+'"':"${"+r+'} =~ regExp("'+t[s]+'", "g")';o.push(a)}l(this,e,o,n)},o.prototype.stopHighlight=function(e,t,i){v(this,e,t,i)},o.prototype.stopHighlightByKey=function(e,t,i,n,r){r=r||"id",t instanceof Array||(t=[t]);for(var o=[],s=0;s<t.length;s++){var a=!1!==i?"${"+r+'} === "'+t[s]+'"':"${"+r+'} =~ regExp("'+t[s]+'", "g")';o.push(a)}v(this,e,o,n)},o.prototype.clearHighlight=function(e){u(this,e)},o.prototype.clearAllHighlight=function(){!function(e){for(var t=0;t<e.data.hlks.length;t++){var i=e.data.hlks[t];u(e,i.l)}}(this)},o},this),function(t,i){if("undefined"!=typeof module&&module.exports){var e=require("Cesium");module.exports=t(e,i)}else if("function"==typeof define&&define.amd)define(["Cesium"],function(e){return t(e,i)});else{null==i.SFM&&(i.SFM={}),i.SFM||(i.SFM={});i.SFM.cesiumlib||(i.SFM.cesiumlib={});i.SFM.cesiumlib.SfmCViewShed=t(i.Cesium,i)}}(function(F,e){function t(e){var t=(e=F.defaultValue(e,F.defaultValue.EMPTY_OBJECT)).scene;if(!F.defined(t))throw new F.DeveloperError("scene is required.");var i=F.defaultValue(e.cameraOptions,F.defaultValue.EMPTY_OBJECT);this._enabled=F.defaultValue(e.enabled,!0),this._scene=t,this._viewerPosition=F.defaultValue(i.viewerPosition,new F.Cartesian3.fromDegrees(0,0,0)),this._direction=F.defaultValue(i.direction,0),this._pitch=F.defaultValue(i.pitch,0),this._horizontalFov=F.defaultValue(i.horizontalFov,60),this._verticalFov=F.defaultValue(i.verticalFov,60),this._distance=F.defaultValue(i.distance,100),this._visibleAreaColor=F.Cartesian4.fromColor(F.defaultValue(i.visibleAreaColor,new F.Color(0,1,0,.5))),this._hiddenAreaColor=F.Cartesian4.fromColor(F.defaultValue(i.hiddenAreaColor,new F.Color(1,0,0,.5))),this._size=F.defaultValue(e.size,2048),this._softShadows=F.defaultValue(e.softShadows,!1),this._bugDistance=this._distance+1e-6*this._horizontalFov-1e-6*this._verticalFov,this._outlineColor=F.defaultValue(e.outlineColor,F.Color.YELLOW),this._lightCameraPrimitive=void 0,this._lightCamera=new F.Camera(t),this._updateCamera(),this._lightCameraDirty=!1,this._shadowMap=new F.ShadowMap({context:this._scene.context,lightCamera:this._lightCamera,enabled:this._enabled,isPointLight:!1,pointLightRadius:100,cascadesEnabled:!1,size:this._size,softShadows:this._softShadows,normalOffset:!1,fromLightSource:!1}),this._stage=void 0,this._stageDirty=!0,this._bias=this._shadowMap._primitiveBias}function o(){}return F.defineProperties(t.prototype,{enabled:{get:function(){return this._enabled},set:function(e){this.dirty=this._enabled!==e,this._enabled=e,this._shadowMap.enabled=e}},softShadows:{get:function(){return this._shadowMap.softShadows},set:function(e){this._shadowMap.softShadows=e}},size:{get:function(){return this._shadowMap.size},set:function(e){this._shadowMap.size=e}},visibleAreaColor:{get:function(){return F.Color.fromCartesian4(this._visibleAreaColor)},set:function(e){this._visibleAreaColor=F.Cartesian4.fromColor(e),this._scene.requestRender()}},hiddenAreaColor:{get:function(){return F.Color.fromCartesian4(this._hiddenAreaColor)},set:function(e){this._hiddenAreaColor=F.Cartesian4.fromColor(e),this._scene.requestRender()}},viewerPosition:{get:function(){return this._viewerPosition},set:function(e){this._viewerPosition=e,this._lightCameraDirty=!0,this._scene.requestRender()}},direction:{get:function(){return this._direction},set:function(e){this._direction=e,this._lightCameraDirty=!0,this._scene.requestRender()}},pitch:{get:function(){return this._pitch},set:function(e){this._pitch=e,this._lightCameraDirty=!0,this._scene.requestRender()}},horizontalFov:{get:function(){return this._horizontalFov},set:function(e){this._horizontalFov=e,this._bugDistance=this._distance+1e-6*this._horizontalFov-1e-6*this._verticalFov,this._lightCameraDirty=!0,this._scene.requestRender()}},verticalFov:{get:function(){return this._verticalFov},set:function(e){this._verticalFov=e,this._bugDistance=this._distance+1e-6*this._horizontalFov-1e-6*this._verticalFov,this._lightCameraDirty=!0,this._scene.requestRender()}},distance:{get:function(){return this._distance},set:function(e){this._distance=e,this._bugDistance=this._distance+1e-6*this._horizontalFov-1e-6*this._verticalFov,this._lightCameraDirty=!0,this._scene.requestRender()}}}),t.prototype._updateCamera=function(){this._lightCamera.frustum.near=.001*this._bugDistance,this._lightCamera.frustum.far=this._bugDistance,this._lightCamera.frustum.fov=F.Math.toRadians(this._verticalFov);var e=F.Math.toRadians(this._horizontalFov),t=F.Math.toRadians(this._verticalFov);this._lightCamera.frustum.aspectRatio=this._bugDistance*Math.tan(.5*e)*2/(this._bugDistance*Math.tan(.5*t)*2),this._horizontalFov>this._verticalFov&&(this._lightCamera.frustum.fov=F.Math.toRadians(this._horizontalFov));this._lightCamera.frustum.projectionMatrix;this._lightCamera.setView({destination:this._viewerPosition,orientation:{heading:F.Math.toRadians(this._direction),pitch:F.Math.toRadians(this._pitch)}}),this._lightCameraPrimitive&&(this._lightCameraPrimitive.destroy(),this._lightCameraPrimitive=void 0);var i=this.createOutLineGeometry();this._lightCameraPrimitive=new F.Primitive({geometryInstances:new F.GeometryInstance({geometry:i,attributes:{color:F.ColorGeometryInstanceAttribute.fromColor(this._outlineColor)}}),appearance:new F.PerInstanceColorAppearance({translucent:!1,flat:!0}),modelMatrix:this._lightCamera.inverseViewMatrix,asynchronous:!1}),this._lightCameraDirty=!1},t.prototype.updateStage=function(){if(this._stageDirty){this._stageDirty=!1,F.defined(this._stage)&&(this._scene.postProcessStages.remove(this._stage),this._stage=void 0);var t=new F.Cartesian2,i=this._bias,n=this._shadowMap,e=this,r={shadowMap_texture:function(){return n._shadowMapTexture},shadowMap_matrix:function(){return n._shadowMapMatrix},viewShed_frontColor:function(){return e._visibleAreaColor},viewShed_backColor:function(){return e._hiddenAreaColor},viewShed_Far:function(){return n._lightCamera.frustum.far},shadowMap_lightDirectionEC:function(){return n._lightDirectionEC},shadowMap_lightPositionEC:function(){return n._lightPositionEC},shadowMap_texelSizeDepthBiasAndNormalShadingSmooth:function(){var e=t;return e.x=1/n._textureSize.x,e.y=1/n._textureSize.y,F.Cartesian4.fromElements(e.x,e.y,i.depthBias,i.normalShadingSmooth,this.combinedUniforms1)},shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness:function(){return F.Cartesian4.fromElements(i.normalOffsetScale,n._distance,n.maximumDistance,n._darkness,this.combinedUniforms2)},combinedUniforms1:new F.Cartesian4,combinedUniforms2:new F.Cartesian4};this._stage=new F.PostProcessStage({fragmentShader:o.getPostStageFragmentShader(n,!1),uniforms:r}),this._scene.postProcessStages.add(this._stage)}},t.prototype.createOutLineGeometry=function(){var e,t=new Float32Array(633),i=t,n=F.Math.toRadians(this._horizontalFov),r=F.Math.toRadians(this._verticalFov),o=Math.tan(.5*n),s=Math.tan(.5*r);x=-(M=this._distance*o),T=-(e=this._distance*s);var a,l,u=0;i[u++]=0,i[u++]=0,i[u++]=0;for(var c=Math.PI-.5*n,f=n/4,h=0;h<5;++h){a=c+h*f;for(var d=e/(this._distance/Math.cos(a)),p=-(y=Math.atan(d)),m=y/10,g=0;g<21;++g)l=p+g*m,i[u++]=this._distance*Math.cos(l)*Math.sin(a),i[u++]=this._distance*Math.sin(l),i[u++]=this._distance*Math.cos(l)*Math.cos(a)}f=n/20;for(var v=0;v<21;++v){a=c+v*f;d=e/(this._distance/Math.cos(a)),p=-(y=Math.atan(d)),m=y/2;for(var y,C=0;C<5;++C)l=p+C*m,i[u++]=this._distance*Math.cos(l)*Math.sin(a),i[u++]=this._distance*Math.sin(l),i[u++]=this._distance*Math.cos(l)*Math.cos(a)}var w=new F.GeometryAttributes({position:new F.GeometryAttribute({componentDatatype:F.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:t})}),_=new Uint16Array(408),S=_,b=0;S[b++]=0,S[b++]=1,S[b++]=0,S[b++]=21,S[b++]=0,S[b++]=85,S[b++]=0,S[b++]=105;for(var x=0,E=0;E<5;++E){x++;for(var M=0;M<20;++M)S[b++]=x++,S[b++]=x}x++;for(var T=0;T<20;++T)for(var P=0;P<5;++P)S[b++]=x,S[b++]=5+x++;return new F.Geometry({attributes:w,indices:_,primitiveType:F.PrimitiveType.LINES,boundingSphere:F.BoundingSphere.fromVertices(t)})},t.prototype.update=function(e){this._lightCameraDirty&&this._updateCamera(),this.updateStage(),e.shadowMaps.push(this._shadowMap),this._lightCameraPrimitive&&this._lightCameraPrimitive.update(e)},t.prototype.isDestroyed=function(){return!1},t.prototype.destroy=function(){if(F.defined(this._stage)){this._scene.postProcessStages.remove(this._stage),this._stage=void 0;this._scene.postProcessStages.length}return this._shadowMap=this._shadowMap.destroy(),this._lightCameraPrimitive&&(this._lightCameraPrimitive.destroy(),this._lightCameraPrimitive=void 0),F.destroyObject(this)},o.getPostStageFragmentShader=function(e,t){var i=e._usesDepthTexture,n=e._polygonOffsetSupported,r=e._isPointLight,o=e._isSpotLight,s=1<e._numberOfCascades,a=e.debugCascadeColors,l="";r?l+="#define USE_CUBE_MAP_SHADOW\n":i&&(l+="#define USE_SHADOW_DEPTH_TEXTURE\n"),e.softShadows&&!r&&(l+="#define USE_SOFT_SHADOWS\n");return l+="uniform sampler2D colorTexture;\nuniform sampler2D depthTexture;\n",l+=r?"uniform samplerCube shadowMap_textureCube; \n":"uniform sampler2D shadowMap_texture; \n",l+="uniform mat4 shadowMap_matrix; \nuniform vec3 shadowMap_lightDirectionEC; \nuniform vec4 shadowMap_lightPositionEC; \nuniform vec4 shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness; \nuniform vec4 shadowMap_texelSizeDepthBiasAndNormalShadingSmooth; \nuniform vec4 viewShed_frontColor; \nuniform vec4 viewShed_backColor; \nuniform float viewShed_Fov; \nuniform float viewShed_Far;\n\nvarying vec2 v_textureCoordinates;\n\nstruct sg_shadowParameters\n{\n#ifdef USE_CUBE_MAP_SHADOW\n    vec3 texCoords;\n#else\n    vec2 texCoords;\n#endif\n\n    float depthBias;\n    float depth;\n    float nDotL;\n    vec2 texelStepSize;\n    float normalShadingSmooth;\n    float darkness;\n};\n#ifdef USE_CUBE_MAP_SHADOW\nfloat sg_sampleShadowMap(samplerCube shadowMap, vec3 d)\n{\n    return czm_unpackDepth(textureCube(shadowMap, d));\n}\nfloat sg_shadowDepthCompare(samplerCube shadowMap, vec3 uv, float depth)\n{\n    return step(depth, sg_sampleShadowMap(shadowMap, uv));\n}\nfloat sg_shadowVisibility(samplerCube shadowMap, sg_shadowParameters shadowParameters)\n{\n    float depthBias = shadowParameters.depthBias;\n    float depth = shadowParameters.depth;\n    float nDotL = shadowParameters.nDotL;\n    float normalShadingSmooth = shadowParameters.normalShadingSmooth;\n    float darkness = shadowParameters.darkness;\n    vec3 uvw = shadowParameters.texCoords;\n\n    depth -= depthBias;\n    float visibility = sg_shadowDepthCompare(shadowMap, uvw, depth);\n    return visibility;\n}\n#else\nfloat sg_sampleShadowMap(sampler2D shadowMap, vec2 uv)\n{\n#ifdef USE_SHADOW_DEPTH_TEXTURE\n    return texture2D(shadowMap, uv).r;\n#else\n    return czm_unpackDepth(texture2D(shadowMap, uv));\n#endif\n}\nfloat sg_shadowDepthCompare(sampler2D shadowMap, vec2 uv, float depth)\n{\n    return step(depth, sg_sampleShadowMap(shadowMap, uv));\n}\nfloat sg_shadowVisibility(sampler2D shadowMap, sg_shadowParameters shadowParameters)\n{\n    float depthBias = shadowParameters.depthBias;\n    float depth = shadowParameters.depth;\n    float nDotL = shadowParameters.nDotL;\n    float normalShadingSmooth = shadowParameters.normalShadingSmooth;\n    float darkness = shadowParameters.darkness;\n    vec2 uv = shadowParameters.texCoords;\n\n    depth -= depthBias;\n#ifdef USE_SOFT_SHADOWS\n    vec2 texelStepSize = shadowParameters.texelStepSize;\n    float radius = 1.0;\n    float dx0 = -texelStepSize.x * radius;\n    float dy0 = -texelStepSize.y * radius;\n    float dx1 = texelStepSize.x * radius;\n    float dy1 = texelStepSize.y * radius;\n    float visibility = (\n        sg_shadowDepthCompare(shadowMap, uv, depth) +\n        sg_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy0), depth) +\n        sg_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy0), depth) +\n        sg_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy0), depth) +\n        sg_shadowDepthCompare(shadowMap, uv + vec2(dx0, 0.0), depth) +\n        sg_shadowDepthCompare(shadowMap, uv + vec2(dx1, 0.0), depth) +\n        sg_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy1), depth) +\n        sg_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy1), depth) +\n        sg_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy1), depth)\n    ) * (1.0 / 9.0);\n#else\n    float visibility = sg_shadowDepthCompare(shadowMap, uv, depth);\n#endif\n\n    return visibility;\n}\n#endif\nvec4 getPositionEC(float depth) \n{ \n    vec2 xy = vec2((v_textureCoordinates.x * 2.0 - 1.0), (v_textureCoordinates.y * 2.0 - 1.0));\n    float z = (depth - czm_viewportTransformation[3][2]) / czm_viewportTransformation[2][2];\n    vec4 posInCamera = czm_inverseProjection * vec4(xy, z, 1.0);\n    posInCamera = posInCamera / posInCamera.w;\n    return posInCamera;\n} \nvec3 getNormalEC() \n{ \n    return vec3(1.0); \n} \n\n",l+="void main() \n{ \n    float depth = czm_readDepth(depthTexture, v_textureCoordinates);\n    if(depth > 0.999999)\n    {\n        gl_FragColor = texture2D(colorTexture, v_textureCoordinates);\n        return;\n    }\n    vec4 positionEC = getPositionEC(depth); \n    vec3 normalEC = getNormalEC(); \n    float z = -positionEC.z; \n",l+="    sg_shadowParameters shadowParameters; \n    shadowParameters.texelStepSize = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.xy; \n    shadowParameters.depthBias = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.z; \n    shadowParameters.normalShadingSmooth = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.w; \n    shadowParameters.darkness = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.w; \n",t?l+="    shadowParameters.depthBias *= max(z * 0.01, 1.0); \n":n||(l+="    shadowParameters.depthBias *= mix(1.0, 100.0, z * 0.0015); \n"),l+=r?"    vec3 directionEC = positionEC.xyz - shadowMap_lightPositionEC.xyz; \n    float distance = length(directionEC); \n    directionEC = normalize(directionEC); \n    float radius = shadowMap_lightPositionEC.w; \n    // Stop early if the fragment is beyond the point light radius \n    if (distance > radius) \n    { \n        gl_FragColor = texture2D(colorTexture, v_textureCoordinates);\n        return; \n    } \n    vec3 directionWC  = czm_inverseViewRotation * directionEC; \n    shadowParameters.depth = distance / radius; \n    shadowParameters.texCoords = directionWC; \n    float visibility = sg_shadowVisibility(shadowMap_textureCube, shadowParameters); \n":o?"    vec3 directionEC = positionEC.xyz - shadowMap_lightPositionEC.xyz; \n    float distance = length(directionEC); \n    if(distance > viewShed_Far)\n    {\n        gl_FragColor = texture2D(colorTexture, v_textureCoordinates);\n        return;\n    }\n    vec4 shadowPosition = shadowMap_matrix * positionEC; \n    // Spot light uses a perspective projection, so perform the perspective divide \n    shadowPosition /= shadowPosition.w; \n    // Stop early if the fragment is not in the shadow bounds \n    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \n    { \n        gl_FragColor = texture2D(colorTexture, v_textureCoordinates);\n        return; \n    } \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    float visibility = sg_shadowVisibility(shadowMap_texture, shadowParameters); \n":s?"    float maxDepth = shadowMap_cascadeSplits[1].w; \n    // Stop early if the eye depth exceeds the last cascade \n    if (z > maxDepth) \n    { \n        gl_FragColor = texture2D(colorTexture, v_textureCoordinates);\n        return; \n    } \n    // Get the cascade based on the eye-space z \n    vec4 weights = czm_cascadeWeights(z); \n    // Transform position into the cascade \n    vec4 shadowPosition = czm_cascadeMatrix(weights) * positionEC; \n    // Get visibility \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    float visibility = sg_shadowVisibility(shadowMap_texture, shadowParameters); \n    // Fade out shadows that are far away \n    float shadowMapMaximumDistance = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.z; \n    float fade = max((z - shadowMapMaximumDistance * 0.8) / (shadowMapMaximumDistance * 0.2), 0.0); \n    visibility = mix(visibility, 1.0, fade); \n":"    vec4 shadowPosition = shadowMap_matrix * positionEC; \n    // Stop early if the fragment is not in the shadow bounds \n    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \n    { \n        gl_FragColor = texture2D(colorTexture, v_textureCoordinates);\n        return; \n    } \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    float visibility = sg_shadowVisibility(shadowMap_texture, shadowParameters); \n",l+="    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n"+(s&&a?"    color *= czm_cascadeColor(weights); \n":"")+"    if(visibility > 0.0) \n        gl_FragColor = vec4(color.rgb * (1.0 - viewShed_frontColor.a) + viewShed_frontColor.rgb * viewShed_frontColor.a, color.a); \n    else \n        gl_FragColor = vec4(color.rgb * (1.0 - viewShed_backColor.a) + viewShed_backColor.rgb * viewShed_backColor.a, color.a); \n} \n"},t},this),function(t,i){if("undefined"!=typeof module&&module.exports){var e=require("Cesium");module.exports=t(e,i)}else if("function"==typeof define&&define.amd)define(["Cesium"],function(e){return t(e,i)});else{null==i.SFM&&(i.SFM={}),i.SFM||(i.SFM={});i.SFM.cesiumlib||(i.SFM.cesiumlib={});i.SFM.cesiumlib.SfmCHeatMapGL=t(i.Cesium,i)}}(function(h,e){function d(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}var r,p,a,m,g,v,y,t,C,w=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};function i(e,t){var i,n;this.gl=e,n=t.vertex,i=t.fragment,this.program=this.gl.createProgram(),this.vs=this.gl.createShader(this.gl.VERTEX_SHADER),this.fs=this.gl.createShader(this.gl.FRAGMENT_SHADER),this.gl.attachShader(this.program,this.vs),this.gl.attachShader(this.program,this.fs),this.compileShader(this.vs,n),this.compileShader(this.fs,i),this.link(),this.value_cache={},this.uniform_cache={},this.attribCache={}}function n(e){this.gl=e,this.buffer=this.gl.createFramebuffer()}function o(e,t){var i,n;switch(this.gl=e,null==t&&(t={}),this.channels=this.gl[(null!=(i=t.channels)?i:"rgba").toUpperCase()],"number"==typeof t.type?this.type=t.type:this.type=this.gl[(null!=(n=t.type)?n:"unsigned_byte").toUpperCase()],this.channels){case this.gl.RGBA:this.chancount=4;break;case this.gl.RGB:this.chancount=3;break;case this.gl.LUMINANCE_ALPHA:this.chancount=2;break;default:this.chancount=1}this.target=this.gl.TEXTURE_2D,this.handle=this.gl.createTexture()}function s(e,t,i){var n;this.gl=e,this.width=t,this.height=i,n=this.gl.getFloatExtension({require:["renderable"]}),this.texture=new g(this.gl,{type:n.type}).bind(0).setSize(this.width,this.height).nearest().clampToEdge(),this.fbo=new r(this.gl).bind().color(this.texture).unbind()}function l(e,t,i,n){var r,o,s;for(this.heatmap=e,this.gl=t,this.width=i,this.height=n,this.shader=new m(this.gl,{vertex:"attribute vec4 position, intensity;\nvarying vec2 off, dim;\nvarying float vIntensity;\nuniform vec2 viewport;\n\nvoid main(){\n    dim = abs(position.zw);\n    off = position.zw;\n    vec2 pos = position.xy + position.zw;\n    vIntensity = intensity.x;\n    gl_Position = vec4((pos/viewport)*2.0-1.0, 0.0, 1.0);\n}",fragment:"#ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp int;\n    precision highp float;\n#else\n    precision mediump int;\n    precision mediump float;\n#endif\nvarying vec2 off, dim;\nvarying float vIntensity;\nvoid main(){\n    float falloff = (1.0 - smoothstep(0.0, 1.0, length(off/dim)));\n    float intensity = falloff*vIntensity;\n    gl_FragColor = vec4(intensity);\n}"}),this.clampShader=new m(this.gl,{vertex:C,fragment:y+"uniform float low, high;\nvoid main(){\n    gl_FragColor = vec4(clamp(texture2D(source, texcoord).rgb, low, high), 1.0);\n}"}),this.multiplyShader=new m(this.gl,{vertex:C,fragment:y+"uniform float value;\nvoid main(){\n    gl_FragColor = vec4(texture2D(source, texcoord).rgb*value, 1.0);\n}"}),this.blurShader=new m(this.gl,{vertex:C,fragment:y+"uniform vec2 viewport;\nvoid main(){\n    vec4 result = vec4(0.0);\n    for(int x=-1; x<=1; x++){\n        for(int y=-1; y<=1; y++){\n            vec2 off = vec2(x,y)/viewport;\n            //float factor = 1.0 - smoothstep(0.0, 1.5, length(off));\n            float factor = 1.0;\n            result += vec4(texture2D(source, texcoord+off).rgb*factor, factor);\n        }\n    }\n    gl_FragColor = vec4(result.rgb/result.w, 1.0);\n}"}),this.nodeBack=new a(this.gl,this.width,this.height),this.nodeFront=new a(this.gl,this.width,this.height),this.vertexBuffer=this.gl.createBuffer(),this.vertexSize=8,this.maxPointCount=10240,this.vertexBufferData=new Float32Array(this.maxPointCount*this.vertexSize*6),this.vertexBufferViews=[],r=o=0,s=this.maxPointCount;0<=s?o<s:s<o;r=0<=s?++o:--o)this.vertexBufferViews.push(new Float32Array(this.vertexBufferData.buffer,0,r*this.vertexSize*6));this.bufferIndex=0,this.pointCount=0}function u(e){var t,i,n,r,o,s,a,l,u,c,f,h;f=null!=e?e:{},this.canvas=f.canvas,this.width=f.width,this.height=f.height,a=f.intensityToAlpha,o=f.gradientTexture,i=f.alphaRange,this.canvas||(this.canvas=document.createElement("canvas"));try{if(this.gl=this.canvas.getContext("experimental-webgl",{depth:!1,antialias:!1}),null===this.gl&&(this.gl=this.canvas.getContext("webgl",{depth:!1,antialias:!1}),null===this.gl))throw"WebGL not supported"}catch(e){throw e,"WebGL not supported"}null!=window.WebGLDebugUtils&&(console.log("debugging mode"),this.gl=WebGLDebugUtils.makeDebugContext(this.gl,function(e,t,i){throw WebGLDebugUtils.glEnumToString(e)+" was caused by call to: "+t})),this.gl.enableVertexAttribArray(0),this.gl.blendFunc(this.gl.ONE,this.gl.ONE),r=o?(c=this.gradientTexture=new g(this.gl,{channels:"rgba"}).bind(0).setSize(2,2).nearest().clampToEdge(),"string"==typeof o?((s=new Image).onload=function(){return c.bind().upload(s)},s.src=o):0<o.width&&0<o.height?c.upload(o):o.onload=function(){return c.upload(o)},"uniform sampler2D gradientTexture;\nvec3 getColor(float intensity){\n    return texture2D(gradientTexture, vec2(intensity, 0.0)).rgb;\n}"):(c=null,"vec3 getColor(float intensity){\n    vec3 blue = vec3(0.0, 0.0, 1.0);\n    vec3 cyan = vec3(0.0, 1.0, 1.0);\n    vec3 green = vec3(0.0, 1.0, 0.0);\n    vec3 yellow = vec3(1.0, 1.0, 0.0);\n    vec3 red = vec3(1.0, 0.0, 0.0);\n\n    vec3 color = (\n        fade(-0.25, 0.25, intensity)*blue +\n        fade(0.0, 0.5, intensity)*cyan +\n        fade(0.25, 0.75, intensity)*green +\n        fade(0.5, 1.0, intensity)*yellow +\n        smoothstep(0.75, 1.0, intensity)*red\n    );\n    return color;\n}"),null==a&&(a=!0),l=a?(n=(h=null!=i?i:[0,1])[0],t=h[1],"vec4 alphaFun(vec3 color, float intensity){\n    float alpha = smoothstep("+n.toFixed(8)+", "+t.toFixed(8)+", intensity);\n    return vec4(color*alpha, alpha);\n}"):"vec4 alphaFun(vec3 color, float intensity){\n    return vec4(color, 1.0);\n}",this.shader=new m(this.gl,{vertex:C,fragment:y+"float linstep(float low, float high, float value){\n    return clamp((value-low)/(high-low), 0.0, 1.0);\n}\n\nfloat fade(float low, float high, float value){\n    float mid = (low+high)*0.5;\n    float range = (high-low)*0.5;\n    float x = 1.0 - clamp(abs(mid-value)/range, 0.0, 1.0);\n    return smoothstep(0.0, 1.0, x);\n}\n\n"+r+"\n"+l+"\n\nvoid main(){\n    float intensity = smoothstep(0.0, 1.0, texture2D(source, texcoord).r);\n    vec3 color = getColor(intensity);\n    gl_FragColor = alphaFun(color, intensity);\n}"}),null==this.width&&(this.width=this.canvas.offsetWidth||2),null==this.height&&(this.height=this.canvas.offsetHeight||2),this.canvas.width=this.width,this.canvas.height=this.height,this.gl.viewport(0,0,this.width,this.height),this.quad=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.quad),u=new Float32Array([-1,-1,0,1,1,-1,0,1,-1,1,0,1,-1,1,0,1,1,-1,0,1,1,1,0,1]),this.gl.bufferData(this.gl.ARRAY_BUFFER,u,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.heights=new p(this,this.gl,this.width,this.height)}t=function(){var o,s,e,a,g,i,l,M,u,c,f,h,t,n;if((g=function(){var e,t,i;return(e=document.createElement("canvas")).width=2,e.height=2,(i=(t=e.getContext("2d")).getImageData(0,0,2,2)).data.set(new Uint8ClampedArray([0,0,0,0,255,255,255,255,0,0,0,0,255,255,255,255])),t.putImageData(i,0,0),e})(),s=function(e,t){var i,n,r,o,s,a,l,u,c,f,h,d,p,m;if(a=e.createProgram(),p=e.createShader(e.VERTEX_SHADER),e.attachShader(a,p),e.shaderSource(p,"attribute vec2 position;\nvoid main(){\n    gl_Position = vec4(position, 0.0, 1.0);\n}"),e.compileShader(p),!e.getShaderParameter(p,e.COMPILE_STATUS))throw e.getShaderInfoLog(p);if(r=e.createShader(e.FRAGMENT_SHADER),e.attachShader(a,r),e.shaderSource(r,"uniform sampler2D source;\nvoid main(){\n    gl_FragColor = texture2D(source, vec2(1.0, 1.0));\n}"),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw e.getShaderInfoLog(r);if(e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))throw e.getProgramInfoLog(a);return e.useProgram(a),n=function(){return e.deleteShader(r),e.deleteShader(p),e.deleteProgram(a),e.deleteBuffer(i),e.deleteTexture(c),e.deleteTexture(d),e.deleteFramebuffer(o),e.bindBuffer(e.ARRAY_BUFFER,null),e.useProgram(null),e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null)},d=e.createTexture(),e.bindTexture(e.TEXTURE_2D,d),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,2,2,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),o=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,d,0),f=g(),c=e.createTexture(),e.bindTexture(e.TEXTURE_2D,c),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,t,f),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),m=new Float32Array([1,1,-1,1,-1,-1,1,1,-1,-1,1,-1]),i=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,m,e.STATIC_DRAW),s=e.getAttribLocation(a,"position"),h=e.getUniformLocation(a,"source"),e.enableVertexAttribArray(s),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0),e.uniform1i(h,0),e.drawArrays(e.TRIANGLES,0,6),l=new Uint8Array(16),e.readPixels(0,0,2,2,e.RGBA,e.UNSIGNED_BYTE,l),u=Math.abs(l[0]-127)<10,n(),u},a=function(e,t){var i;return i=e.createTexture(),e.bindTexture(e.TEXTURE_2D,i),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,2,2,0,e.RGBA,t,null),0===e.getError()?(e.deleteTexture(i),!0):(e.deleteTexture(i),!1)},o=function(e,t){var i,n,r;return r=e.createTexture(),e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,2,2,0,e.RGBA,t,null),n=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0),i=e.checkFramebufferStatus(e.FRAMEBUFFER),e.deleteTexture(r),e.deleteFramebuffer(n),e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),i===e.FRAMEBUFFER_COMPLETE},u=[],c={},f=[],e=function(){var e,t,i,n,r;e=document.createElement("canvas"),t=null;try{null===(t=e.getContext("experimental-webgl"))&&(t=e.getContext("webgl"))}catch(e){}if(null!=t&&(null===t.getExtension("OES_texture_float")?a(t,t.FLOAT)?(r=!0,u.push("OES_texture_float"),c.OES_texture_float={shim:!0}):(r=!1,f.push("OES_texture_float")):a(t,t.FLOAT)?(r=!0,u.push("OES_texture_float")):(r=!1,f.push("OES_texture_float")),r&&(null===t.getExtension("WEBGL_color_buffer_float")?o(t,t.FLOAT)?(u.push("WEBGL_color_buffer_float"),c.WEBGL_color_buffer_float={shim:!0,RGBA32F_EXT:34836,RGB32F_EXT:34837,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863}):f.push("WEBGL_color_buffer_float"):o(t,t.FLOAT)?u.push("WEBGL_color_buffer_float"):f.push("WEBGL_color_buffer_float"),null===t.getExtension("OES_texture_float_linear")?s(t,t.FLOAT)?(u.push("OES_texture_float_linear"),c.OES_texture_float_linear={shim:!0}):f.push("OES_texture_float_linear"):s(t,t.FLOAT)?u.push("OES_texture_float_linear"):f.push("OES_texture_float_linear")),null===(i=t.getExtension("OES_texture_half_float"))?a(t,36193)?(n=!0,u.push("OES_texture_half_float"),i=c.OES_texture_half_float={HALF_FLOAT_OES:36193,shim:!0}):(n=!1,f.push("OES_texture_half_float")):a(t,i.HALF_FLOAT_OES)?(n=!0,u.push("OES_texture_half_float")):(n=!1,f.push("OES_texture_half_float")),n))return null===t.getExtension("EXT_color_buffer_half_float")?o(t,i.HALF_FLOAT_OES)?(u.push("EXT_color_buffer_half_float"),c.EXT_color_buffer_half_float={shim:!0,RGBA16F_EXT:34842,RGB16F_EXT:34843,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863}):f.push("EXT_color_buffer_half_float"):o(t,i.HALF_FLOAT_OES)?u.push("EXT_color_buffer_half_float"):f.push("EXT_color_buffer_half_float"),null===t.getExtension("OES_texture_half_float_linear")?s(t,i.HALF_FLOAT_OES)?(u.push("OES_texture_half_float_linear"),c.OES_texture_half_float_linear={shim:!0}):f.push("OES_texture_half_float_linear"):s(t,i.HALF_FLOAT_OES)?u.push("OES_texture_half_float_linear"):f.push("OES_texture_half_float_linear")},null!=window.WebGLRenderingContext){for(e(),h={},t=0,n=f.length;t<n;t++)M=f[t],h[M]=!0;return i=WebGLRenderingContext.prototype.getExtension,WebGLRenderingContext.prototype.getExtension=function(e){var t;return void 0===(t=c[e])?h[e]?null:i.call(this,e):t},l=WebGLRenderingContext.prototype.getSupportedExtensions,WebGLRenderingContext.prototype.getSupportedExtensions=function(){var e,t,i,n,r,o,s;for(t=[],n=0,o=(i=l.call(this)).length;n<o;n++)e=i[n],void 0===h[e]&&t.push(e);for(r=0,s=u.length;r<s;r++)e=u[r],w.call(t,e)<0&&t.push(e);return t},WebGLRenderingContext.prototype.getFloatExtension=function(e){var t,i,n,r,o,s,a,l,u,c,f,h,d,p,m,g,v,y,C,w,_,S,b,x,E;for(null==e.prefer&&(e.prefer=["half"]),null==e.require&&(e.require=[]),null==e.throws&&(e.throws=!0),d=this.getExtension("OES_texture_float"),o=this.getExtension("OES_texture_half_float"),f=this.getExtension("WEBGL_color_buffer_float"),r=this.getExtension("EXT_color_buffer_half_float"),h=this.getExtension("OES_texture_float_linear"),n={texture:null!==o,filterable:null!==this.getExtension("OES_texture_half_float_linear"),renderable:null!==r,score:0,precision:"half",half:!0,single:!(c={texture:null!==d,filterable:null!==h,renderable:null!==f,score:0,precision:"single",half:!1,single:!0,type:this.FLOAT}),type:null!=(b=null!=o?o.HALF_FLOAT_OES:void 0)?b:null},i=[],c.texture&&i.push(c),n.texture&&i.push(n),u=[],m=0,y=i.length;m<y;m++){for(t=i[m],p=!0,g=0,C=(x=e.require).length;g<C;g++)!1===t[M=x[g]]&&(p=!1);p&&u.push(t)}for(v=0,w=u.length;v<w;v++)for(t=u[v],s=S=0,_=(E=e.prefer).length;S<_;s=++S)l=E[s],a=Math.pow(2,e.prefer.length-s-1),t[l]&&(t.score+=a);if(u.sort(function(e,t){return e.score===t.score?0:e.score<t.score?1:e.score>t.score?-1:void 0}),0!==u.length)return{filterable:(u=u[0]).filterable,renderable:u.renderable,type:u.type,precision:u.precision};if(e.throws)throw"No floating point texture support that is "+e.require.join(", ");return null}}},function(){var s,a,l,u;if(null!=window.WebGLRenderingContext)u=["WEBKIT","MOZ","MS","O"],l=/^WEBKIT_(.*)|MOZ_(.*)|MS_(.*)|O_(.*)/,s=WebGLRenderingContext.prototype.getExtension,WebGLRenderingContext.prototype.getExtension=function(e){var t,i,n,r,o;if(null!==(i=e.match(l))&&(e=i[1]),null!==(t=s.call(this,e)))return t;for(r=0,o=u.length;r<o;r++)if(n=u[r],null!==(t=s.call(this,n+"_"+e)))return t;return null},a=WebGLRenderingContext.prototype.getSupportedExtensions,WebGLRenderingContext.prototype.getSupportedExtensions=function(){var e,t,i,n,r,o;for(i=[],r=0,o=(n=a.call(this)).length;r<o;r++)null!==(t=(e=n[r]).match(l))&&(e=t[1]),w.call(i,e)<0&&i.push(e);return i}}(),t(),i.prototype.attribLocation=function(e){var t;return void 0===(t=this.attribCache[e])&&(t=this.attribCache[e]=this.gl.getAttribLocation(this.program,e)),t},i.prototype.compileShader=function(e,t){if(this.gl.shaderSource(e,t),this.gl.compileShader(e),!this.gl.getShaderParameter(e,this.gl.COMPILE_STATUS))throw"Shader Compile Error: "+this.gl.getShaderInfoLog(e)},i.prototype.link=function(){if(this.gl.linkProgram(this.program),!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS))throw"Shader Link Error: "+this.gl.getProgramInfoLog(this.program)},i.prototype.use=function(){return this.gl.useProgram(this.program),this},i.prototype.uniformLoc=function(e){var t;return void 0===(t=this.uniform_cache[e])&&(t=this.uniform_cache[e]=this.gl.getUniformLocation(this.program,e)),t},i.prototype.int=function(e,t){var i;return this.value_cache[e]!==t&&(this.value_cache[e]=t,(i=this.uniformLoc(e))&&this.gl.uniform1i(i,t)),this},i.prototype.vec2=function(e,t,i){var n;return(n=this.uniformLoc(e))&&this.gl.uniform2f(n,t,i),this},i.prototype.float=function(e,t){var i;return this.value_cache[e]!==t&&(this.value_cache[e]=t,(i=this.uniformLoc(e))&&this.gl.uniform1f(i,t)),this},m=i,n.prototype.destroy=function(){return this.gl.deleteFRamebuffer(this.buffer)},n.prototype.bind=function(){return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.buffer),this},n.prototype.unbind=function(){return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this},n.prototype.check=function(){switch(this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER)){case this.gl.FRAMEBUFFER_UNSUPPORTED:throw"Framebuffer is unsupported";case this.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw"Framebuffer incomplete attachment";case this.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw"Framebuffer incomplete dimensions";case this.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw"Framebuffer incomplete missing attachment"}return this},n.prototype.color=function(e){return this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,e.target,e.handle,0),this.check(),this},n.prototype.depth=function(e){return this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,e.id),this.check(),this},n.prototype.destroy=function(){return this.gl.deleteFramebuffer(this.buffer)},r=n,o.prototype.destroy=function(){return this.gl.deleteTexture(this.handle)},o.prototype.bind=function(e){if(null==e&&(e=0),15<e)throw"Texture unit too large: "+e;return this.gl.activeTexture(this.gl.TEXTURE0+e),this.gl.bindTexture(this.target,this.handle),this},o.prototype.setSize=function(e,t){return this.width=e,this.height=t,this.gl.texImage2D(this.target,0,this.channels,this.width,this.height,0,this.channels,this.type,null),this},o.prototype.upload=function(e){return this.width=e.width,this.height=e.height,this.gl.texImage2D(this.target,0,this.channels,this.channels,this.type,e),this},o.prototype.linear=function(){return this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this},o.prototype.nearest=function(){return this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this},o.prototype.clampToEdge=function(){return this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this},o.prototype.repeat=function(){return this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT),this},g=o,s.prototype.use=function(){return this.fbo.bind()},s.prototype.bind=function(e){return this.texture.bind(e)},s.prototype.end=function(){return this.fbo.unbind()},s.prototype.resize=function(e,t){return this.width=e,this.height=t,this.texture.bind(0).setSize(this.width,this.height)},a=s,C="attribute vec4 position;\nvarying vec2 texcoord;\nvoid main(){\n    texcoord = position.xy*0.5+0.5;\n    gl_Position = position;\n}",y="#ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp int;\n    precision highp float;\n#else\n    precision mediump int;\n    precision mediump float;\n#endif\nuniform sampler2D source;\nvarying vec2 texcoord;",l.prototype.resize=function(e,t){return this.width=e,this.height=t,this.nodeBack.resize(this.width,this.height),this.nodeFront.resize(this.width,this.height)},l.prototype.update=function(){var e,t;if(0<this.pointCount)return this.gl.enable(this.gl.BLEND),this.nodeFront.use(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexBufferViews[this.pointCount],this.gl.STREAM_DRAW),t=this.shader.attribLocation("position"),e=this.shader.attribLocation("intensity"),this.gl.enableVertexAttribArray(1),this.gl.vertexAttribPointer(t,4,this.gl.FLOAT,!1,32,0),this.gl.vertexAttribPointer(e,4,this.gl.FLOAT,!1,32,16),this.shader.use().vec2("viewport",this.width,this.height),this.gl.drawArrays(this.gl.TRIANGLES,0,6*this.pointCount),this.gl.disableVertexAttribArray(1),this.pointCount=0,this.bufferIndex=0,this.nodeFront.end(),this.gl.disable(this.gl.BLEND)},l.prototype.clear=function(){return this.nodeFront.use(),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.nodeFront.end()},l.prototype.clamp=function(e,t){return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.heatmap.quad),this.gl.vertexAttribPointer(0,4,this.gl.FLOAT,!1,0,0),this.nodeFront.bind(0),this.nodeBack.use(),this.clampShader.use().int("source",0).float("low",e).float("high",t),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.nodeBack.end(),this.swap()},l.prototype.multiply=function(e){return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.heatmap.quad),this.gl.vertexAttribPointer(0,4,this.gl.FLOAT,!1,0,0),this.nodeFront.bind(0),this.nodeBack.use(),this.multiplyShader.use().int("source",0).float("value",e),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.nodeBack.end(),this.swap()},l.prototype.blur=function(){return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.heatmap.quad),this.gl.vertexAttribPointer(0,4,this.gl.FLOAT,!1,0,0),this.nodeFront.bind(0),this.nodeBack.use(),this.blurShader.use().int("source",0).vec2("viewport",this.width,this.height),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.nodeBack.end(),this.swap()},l.prototype.swap=function(){var e;return e=this.nodeFront,this.nodeFront=this.nodeBack,this.nodeBack=e},l.prototype.addVertex=function(e,t,i,n,r){return this.vertexBufferData[this.bufferIndex++]=e,this.vertexBufferData[this.bufferIndex++]=t,this.vertexBufferData[this.bufferIndex++]=i,this.vertexBufferData[this.bufferIndex++]=n,this.vertexBufferData[this.bufferIndex++]=r,this.vertexBufferData[this.bufferIndex++]=r,this.vertexBufferData[this.bufferIndex++]=r,this.vertexBufferData[this.bufferIndex++]=r},l.prototype.addPoint=function(e,t,i,n){var r;return null==i&&(i=50),null==n&&(n=.2),this.pointCount>=this.maxPointCount-1&&this.update(),t=this.height-t,r=i/2,this.addVertex(e,t,-r,-r,n),this.addVertex(e,t,+r,-r,n),this.addVertex(e,t,-r,+r,n),this.addVertex(e,t,-r,+r,n),this.addVertex(e,t,+r,-r,n),this.addVertex(e,t,+r,+r,n),this.pointCount+=1},p=l,u.prototype.adjustSize=function(){var e,t;if(t=this.canvas.offsetWidth||2,e=this.canvas.offsetHeight||2,this.width!==t||this.height!==e)return this.gl.viewport(0,0,t,e),this.canvas.width=t,this.canvas.height=e,this.width=t,this.height=e,this.heights.resize(this.width,this.height)},u.prototype.display=function(){return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.quad),this.gl.vertexAttribPointer(0,4,this.gl.FLOAT,!1,0,0),this.heights.nodeFront.bind(0),this.gradientTexture&&this.gradientTexture.bind(1),this.shader.use().int("source",0).int("gradientTexture",1),this.gl.drawArrays(this.gl.TRIANGLES,0,6)},u.prototype.update=function(){return this.heights.update()},u.prototype.clear=function(){return this.heights.clear()},u.prototype.clamp=function(e,t){return null==e&&(e=0),null==t&&(t=1),this.heights.clamp(e,t)},u.prototype.multiply=function(e){return null==e&&(e=.95),this.heights.multiply(e)},u.prototype.blur=function(){return this.heights.blur()},u.prototype.addPoint=function(e,t,i,n){return this.heights.addPoint(e,t,i,n)},u.prototype.addPoints=function(e){var t,i,n,r;for(r=[],i=0,n=e.length;i<n;i++)t=e[i],r.push(this.addPoint(t.x,t.y,t.size,t.intensity));return r},v=u;function c(e,t,i){this._viewer=e,t&&this.loadGeojson(t,i)}function f(e){var t=new Image;return t.src=e.toDataURL("image/png"),t}return c.prototype.loadGeojson=function(e,f){!function(e,t){var i=new XMLHttpRequest;i.responseType="json",i.open("get",e,!0),i.onload=function(){if(!(200<=i.status&&i.status<300))throw new Error(i.statusText);t(i.response)},i.send()}(e,function(e){var n=1e3,r=-1e3,o=1e3,s=-1e3;e.features.forEach(function(e){var t=e.geometry.coordinates[0],i=e.geometry.coordinates[1];n=t<n?t:n,o=i<o?i:o,r=r<t?t:r,s=s<i?i:s});var t=r-n,i=s-o,a={xMin:n-t/10,yMin:o-i/10,xMax:r+t/10,yMax:s+i/10},l=document.createElement("canvas");document.body.appendChild(l),l.width=1e3,l.height=parseInt(1e3/(a.xMax-a.xMin)*(a.yMax-a.yMin));try{var u=this._heatmap=function(e){return new v(e)}({canvas:l,intensityToAlpha:!0})}catch(e){console.error(e)}e.features.forEach(function(e){var t=(e.geometry.coordinates[0]-a.xMin)/(a.xMax-a.xMin)*l.clientWidth,i=(-(e.geometry.coordinates[1]-a.yMin)/(a.yMax-a.yMin)+1)*l.clientHeight,n=d(f,"featureParam",null),r=20,o=.05;if("function"==typeof n){var s=n(e);r=d(s,"size",r),o=d(s,"intensity",o)}u.addPoint(t,i,r,o)}),u.adjustSize(),u.update(),u.display(),this.drawHeatmapRect(l,a);var c=d(f,"onLoad",null);"function"==typeof c&&c(),d(f,"flyto",!0)&&this._viewer.camera.flyTo({destination:h.Rectangle.fromDegrees(a.xMin,a.yMin,a.xMax,a.yMax)})}.bind(this))},c.prototype.drawHeatmapRect=function(e,t){var i=f(e);this._worldRectangle=this._viewer.scene.primitives.add(new h.GroundPrimitive({geometryInstances:new h.GeometryInstance({geometry:new h.RectangleGeometry({rectangle:this.extent=h.Rectangle.fromDegrees(t.xMin,t.yMin,t.xMax,t.yMax),vertexFormat:h.EllipsoidSurfaceAppearance.VERTEX_FORMAT})}),appearance:new h.EllipsoidSurfaceAppearance({aboveGround:!1}),show:!0})),this._worldRectangle.appearance.material=new h.Material({fabric:{type:"Image",uniforms:{image:i.src}}})},c.prototype.updateHeatmap=function(){this._heatmap.adjustSize(),this._heatmap.update(),this._heatmap.display();var e=f(this._heatmap.canvas);this._worldRectangle.appearance.material.uniforms.image=e.src},c.prototype.multiply=function(e){this._heatmap.multiply(e),this.updateHeatmap()},c.prototype.clamp=function(e,t){this._heatmap.clamp(e,t),this.updateHeatmap()},c.prototype.blur=function(){this._heatmap.blur(),this.updateHeatmap()},c.prototype.remove=function(e){this._viewer.scene.primitives.remove(this._worldRectangle),e&&this._worldRectangle.destroy()},c.prototype.show=function(){this._worldRectangle&&(this._worldRectangle.show=!0)},c.prototype.hide=function(){this._worldRectangle&&(this._worldRectangle.show=!1)},c},this),function(n,r){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil");module.exports=n(e,t,i,r)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil"],function(e,t,i){return n(e,t,i,r)});else{null==r.SFM&&(r.SFM={}),r.SFM||(r.SFM={});var o=r.SFM.cesiumlib||(r.SFM.cesiumlib={});r.SFM.cesiumlib.SfmCMouseTip=n(r.Cesium,o.sfmCEnum,o.sfmCesiumUtil,r)}}(function(e,t,i,n){function r(e,t){e.cid=t.el,e.viewer=t.viewer,e.id="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".replace(/x/g,function(e){return(16*Math.random()|0).toString(16)})}function o(e){var t=document.getElementById(e.id);if(!t){var i=function(e){return e.cid?e.c||(e.c=document.getElementById(e.cid)):e.c||(e.c=document.querySelector(".sfm-m-earth-mtc"))}(e);if(!i)return null;(t=document.createElement("div")).id=e.id,t.className="sfm-t-mousetip",t.style.display="none",t.style.pointerEvents="none",i.appendChild(t)}return t}function s(e){r(this,e)}var a=e;return s.prototype.show=function(e){var t=this;t.fs=!0;var i=o(t);i&&(i.innerHTML='<div class="sfm-t-mousetip-inner">'+e+"</div>",t.handler||(t.handler=new a.ScreenSpaceEventHandler(t.viewer.scene.canvas),t.handler.setInputAction(function(e){t.fs&&(null==t.viewer.scene.pickPosition(e.endPosition)?i.style.display="none":(i.style.position="absolute",i.style.left=e.endPosition.x+20+"px",i.style.top=e.endPosition.y+"px",i.style.display="block"))},a.ScreenSpaceEventType.MOUSE_MOVE)))},s.prototype.hide=function(){delete this.fs;var e=o(this);e&&(e.innerHTML=""),this.c&&this.c.removeChild(e),this.handler&&this.handler.destroy(),delete this.handler},s},this),function(n,r){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil");module.exports=n(e,t,i,r)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil"],function(e,t,i){return n(e,t,i,r)});else{null==r.SFM&&(r.SFM={}),r.SFM||(r.SFM={});var o=r.SFM.cesiumlib||(r.SFM.cesiumlib={});r.SFM.cesiumlib.SfmCPoint=n(r.Cesium,o.sfmCEnum,o.sfmCesiumUtil,r)}}(function(r,e,o,t){function s(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}function i(e){!function(e,t){e.id=t.id||c(),e.data={},e.style={point:s(t.style,"point",void 0)},e.position=s(t,"position",new r.Cartesian3);var i=e.entities=[],n=f(e.position,e.style);i.push(n)}(this,e)}var a=r,l=[0,255,255,255],u=[0,255,255,255],c=o.fguid,f=function(e,t,i){var n=t.point,r=a.HeightReference.NONE;return t.clampToGround,"function"==typeof n&&(n=n(i)),new a.Entity({position:e,point:{pixelSize:s(n,"size",5),heightReference:r,color:o.toColor(s(n,"color",u)),outlineColor:o.toColor(s(n,"lineColor",l)),outlineWidth:s(n,"lineWidth",0),disableDepthTestDistance:Number.POSITIVE_INFINITY,show:s(n,"visible",!1)}})};return i.prototype.destroy=function(){this.remove(),delete this.entities,delete this.position,delete this.data},i.prototype.getEntity=function(){return this.entities[0]},i.prototype.getPosition=function(){return this.position},i.prototype.setPosition=function(e){this.position=e,function(e,t){var i=e.entities;0<i.length&&i[0].position.setValue(t)}(this,this.position)},i.prototype.add=function(e){if(e){this.ec=e;for(var t=0;t<this.entities.length;t++)this.ec.add(this.entities[t])}},i.prototype.remove=function(){if(this.ec){for(var e=this.entities.length-1;0<=e;e--)this.ec.remove(this.entities[e]);delete this.ec}},i},this),function(n,r){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil");module.exports=n(e,t,i,r)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil"],function(e,t,i){return n(e,t,i,r)});else{null==r.SFM&&(r.SFM={}),r.SFM||(r.SFM={});var o=r.SFM.cesiumlib||(r.SFM.cesiumlib={});r.SFM.cesiumlib.SfmCPolyline=n(r.Cesium,o.sfmCEnum,o.sfmCesiumUtil,r)}}(function(e,t,h,i){function d(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}function n(e){!function(e,t){e.id=t.id||c(),e.data={},e.style={point:d(t.style,"point",void 0),polyline:d(t.style,"polyline",void 0),clampToGround:d(t.style,"clampToGround",!1)},e.positions=[];var i=e.entities=[],n=h.toColor(d(e.style.polyline,"color",l)),r=n;if(d(e.style.polyline,"glow",!1)){var o=d(e.style.polyline,"glowPower",.25),s=d(e.style.polyline,"taperPower",1);r=new p.PolylineGlowMaterialProperty({color:n,glowPower:o,taperPower:s})}else d(e.style.polyline,"dash",!1)&&(r=new p.PolylineDashMaterialProperty({color:n,gapColor:h.toColor(d(e.style.polyline,"gapColor",u)),dashLength:d(e.style.polyline,"dashLength",16),dashPattern:d(e.style.polyline,"dashPattern",parseInt("11111111",2))}));var a=e.data.polyline=new p.Entity({polyline:{positions:new p.CallbackProperty(function(){return d(e.style.polyline,"close",!1)?e.positions.concat(e.positions[0]):e.positions},!1),width:d(e.style.polyline,"width",1),material:r,clampToGround:d(e.style,"clampToGround",!1),show:d(t,"visible",!0)}});i.push(a),e.setPositions(e.positions)}(this,e)}var p=e,m=[0,255,255,255],g=[0,255,255,255],l=[0,255,255,255],u=[0,0,0,0],c=h.fguid;return n.prototype.destroy=function(){this.remove(),delete this.entities,delete this.positions,delete this.data},n.prototype.getEntity=function(){return this.entities[0]},n.prototype.getPositions=function(){return this.positions},n.prototype.setPositions=function(e){this.positions=e,function(e,t,i){var n,r,o,s,a,l=0,u=e.entities;for(l=0;l<t.length;l++){var c=p.Cartesian3.clone(t[l]);if(l+1<u.length)u[l+1].position.setValue(c);else{var f=(n=c,r=i,o={index:l,count:t.length},s=void 0,s=r.point,a=p.HeightReference.NONE,r.clampToGround,"function"==typeof s&&(s=s(o)),new p.Entity({position:n,point:{pixelSize:d(s,"size",5),heightReference:a,color:h.toColor(d(s,"color",g)),outlineColor:h.toColor(d(s,"lineColor",m)),outlineWidth:d(s,"lineWidth",0),disableDepthTestDistance:Number.POSITIVE_INFINITY,show:d(s,"visible",!1)}}));u.push(f),e.ec&&e.ec.add(f)}}for(;l+1<u.length;l++){f=u.splice(1+l--,1)[0];e.ec&&e.ec.remove(f)}}(this,this.positions,this.style)},n.prototype.add=function(e){if(e){this.ec=e;for(var t=0;t<this.entities.length;t++)this.ec.add(this.entities[t])}},n.prototype.remove=function(){if(this.ec){for(var e=this.entities.length-1;0<=e;e--)this.ec.remove(this.entities[e]);delete this.ec}},n},this),function(r,o){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil"),n=require("sfmCPolyline");module.exports=r(e,t,i,n,o)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil","sfmCPolyline"],function(e,t,i,n){return r(e,t,i,n,o)});else{null==o.SFM&&(o.SFM={}),o.SFM||(o.SFM={});var s=o.SFM.cesiumlib||(o.SFM.cesiumlib={});o.SFM.cesiumlib.SfmCPolygon=r(o.Cesium,s.sfmCEnum,s.sfmCesiumUtil,s.SfmCPolyline,o)}}(function(e,t,o,s,i){function a(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}function n(e){!function(e,t){e.id=t.id||c(),e.data={},e.style={point:a(t.style,"point",void 0),polyline:a(t.style,"polyline",void 0),polygon:a(t.polygon,"polygon",void 0),clampToGround:a(t.style,"clampToGround",!1)},e.positions=[];var i=e.entities=[],n=o.toColor(a(e.style.polygon,"color",u)),r=e.data.polygon=new l.Entity({polygon:{hierarchy:new l.CallbackProperty(function(){return{positions:e.positions}},!1),material:n,height:0,heightReference:l.HeightReference.NONE,perPositionHeight:!e.style.clampToGround,fill:a(e.style.polygon,"fill",!0),show:a(t,"visible",!0)}});i.push(r),e.style.polyline||(e.style.polyline={}),e.style.polyline.close=!0,e.style.polyline.visible=!1;e._elOutline=new s({style:{point:e.style.point,polyline:e.style.polyline,clampToGround:e.style.clampToGround}});e.setPositions(e.positions)}(this,e)}var l=e,u=[0,255,255,50],c=o.fguid;return n.prototype.destroy=function(){this.remove(),delete this.entities,delete this.positions,delete this.data},n.prototype.getEntity=function(){return this.entities[0]},n.prototype.getPositions=function(){return this.positions},n.prototype.setPositions=function(e){var t=this;t.positions=e;var i=t.entities[0];t.positions.length<3?i.polyline||(t.ec&&t.ec.remove(t.entities[0]),i=t.entities[0]=new l.Entity({polyline:{positions:new l.CallbackProperty(function(){return t.positions},!1),material:o.toColor(a(t.style.polygon,"color",u)),clampToGround:!1,show:!0}}),t.ec&&t.ec.add(t.entities[0])):i.polygon||(t.ec&&t.ec.remove(t.entities[0]),i=t.entities[0]=new l.Entity({polygon:{hierarchy:new l.CallbackProperty(function(){return{positions:t.positions}},!1),material:o.toColor(a(t.style.polygon,"color",u)),height:.1,heightReference:l.HeightReference.RELATIVE_TO_GROUND,perPositionHeight:!t.style.clampToGround,fill:a(t.style.polygon,"fill",!0),show:!0}}),t.ec&&t.ec.add(t.entities[0])),t._elOutline.setPositions(function(e){for(var t=[],i=0;i<e.length;i++)t.push(l.Cartesian3.clone(e[i]));return t}(t.positions))},n.prototype.add=function(e){e&&(this.ec=e,this.ec.add(this.entities[0]),this._elOutline.add(this.ec))},n.prototype.remove=function(){this.ec&&(this._elOutline.remove(),this.ec.remove(this.entities[0]),delete this.ec)},n},this),function(n,r){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil");module.exports=n(e,t,i,r)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil"],function(e,t,i){return n(e,t,i,r)});else{null==r.SFM&&(r.SFM={}),r.SFM||(r.SFM={});var o=r.SFM.cesiumlib||(r.SFM.cesiumlib={});r.SFM.cesiumlib.SfmCCircle=n(r.Cesium,o.sfmCEnum,o.sfmCesiumUtil,r)}}(function(c,e,f,t){function h(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}function i(e){!function(e,t){e.id=t.id||b(),e.data={},e.style={point:h(t.style,"point",void 0),line:h(t.style,"line",void 0),circle:h(t.style,"circle",void 0),label:h(t.style,"label",void 0),clampToGround:h(t.style,"clampToGround",!0)},e.center=new c.Cartesian3(0,0,0),e.point=new c.Cartesian3(0,0,0),e.cp=e.center.clone(),e.line=[e.center.clone(),e.point],e.radius=0;var i=e.entities=[],n=f.toColor(h(e.style.circle,"color",S)),r=e.data.circle=new d.Entity({position:new d.CallbackProperty(function(){return e.center},!1),ellipse:{semiMinorAxis:new c.CallbackProperty(function(){return e.radius},!1),semiMajorAxis:new c.CallbackProperty(function(){return e.radius},!1),material:n,outline:h(e.style.line,"visible",!0),outlineColor:f.toColor(h(e.style.line,"color",g)),outlineWidth:h(e.style.line,"width",1),fill:h(e.style.circle,"fill",!0),height:.2,heightReference:d.HeightReference.RELATIVE_TO_GROUND,show:h(t,"visible",!0)}});i.push(r);var o=new d.Entity({polyline:{positions:new d.CallbackProperty(function(){return e.line},!1),width:h(e.style.line,"width",1),material:f.toColor(h(e.style.line,"color",g)),depthFailMaterial:f.toColor(h(e.style.line,"color",g)),clampToGround:!1,show:h(e.style.line,"visible",!0)}});i.push(o);var s=new d.Entity({position:new d.CallbackProperty(function(){return e.cp},!1),point:{pixelSize:h(e.style.point,"size",5),heightReference:d.HeightReference.NONE,color:f.toColor(h(e.style.point,"color",m)),outlineColor:f.toColor(h(e.style.point,"lineColor",p)),outlineWidth:h(e.style.point,"lineWidth",0),disableDepthTestDistance:Number.POSITIVE_INFINITY,show:h(e.style.point,"visible",!1)}});i.push(s);var a=h(e.style.label,"backgroundPadding",w),l=h(e.style.label,"pixelOffset",_),u=new d.Entity({position:new d.CallbackProperty(function(){return e.midp},!1),label:{showBackground:h(e.style.label,"showBackground",!1),backgroundColor:f.toColor(h(e.style.label,"backgroundColor",v)),backgroundPadding:new c.Cartesian2(a[0],a[1]),pixelOffset:new c.Cartesian2(l[0],l[1]),fillColor:f.toColor(h(e.style.label,"fillColor",y)),outlineColor:f.toColor(h(e.style.label,"lineColor",C)),outlineWidth:h(e.style.point,"lineWidth",1),font:h(e.style.label,"font","14px sans-serif"),horizontalOrigin:c.HorizontalOrigin.CENTER,text:"",disableDepthTestDistance:Number.POSITIVE_INFINITY,show:h(e.style.label,"visible",!0)}});i.push(u),e.setPositions({center:e.center,point:e.point})}(this,e)}var d=c,p=[0,255,255,255],m=[0,255,255,255],g=[0,255,255,255],v=[0,0,0,100],y=[255,255,255,255],C=[0,0,0,0],w=[7,5],_=[0,0],S=[0,255,255,50],a=new c.EllipsoidGeodesic,b=f.fguid;return i.prototype.destroy=function(){this.remove(),delete this.entities,delete this.positions,delete this.data},i.prototype.getEntity=function(){return this.entities[0]},i.prototype.getPositions=function(){return{center:this.center,point:this.point,radius:this.radius}},i.prototype.setPositions=function(e){c.Cartesian3.clone(e.center,this.center),c.Cartesian3.clone(e.point,this.point),this.midp=function(e,t,i){null==i&&(i=.5);var n=c.Cartographic.fromCartesian(e),r=c.Cartographic.fromCartesian(t);if(!n||!r)return new c.Cartesian3;var o=(n.height+r.height)/2;a.setEndPoints(n,r);var s=a.interpolateUsingFraction(i,new c.Cartographic);return c.Cartesian3.fromRadians(s.longitude,s.latitude,o)}(this.center,this.point),this.radius=function(e,t){var i=c.Cartographic.fromCartesian(e),n=c.Cartographic.fromCartesian(t);return i&&n?(a.setEndPoints(i,n),a.surfaceDistance):0}(this.center,this.point),this.cp.x=this.line[0].x=this.center.x,this.cp.y=this.line[0].y=this.center.y,this.cp.z=this.line[0].z=this.center.z;var t=1e3<=this.radius?Number((this.radius/1e3).toFixed(3))+"km":Number(this.radius.toFixed(3))+"m";this.entities[3]&&(this.entities[3].label.text=t)},i.prototype.add=function(e){if(e){this.ec=e;for(var t=0;t<this.entities.length;t++)this.ec.add(this.entities[t])}},i.prototype.remove=function(){if(this.ec){for(var e=this.entities.length-1;0<=e;e--)this.ec.remove(this.entities[e]);delete this.ec}},i},this),function(n,r){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil");module.exports=n(e,t,i,r)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil"],function(e,t,i){return n(e,t,i,r)});else{null==r.SFM&&(r.SFM={}),r.SFM||(r.SFM={});var o=r.SFM.cesiumlib||(r.SFM.cesiumlib={});r.SFM.cesiumlib.ZlskCCicleRipple=n(r.Cesium,o.sfmCEnum,o.sfmCesiumUtil,r)}}(function(l,e,u,t){function c(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}function i(e){!function(e,t){e._options=t,e._els=[],n(e,t)}(this,e)}var f=null,n=function(e,t){var i=c(t,"num",1),n=c(t,"circle",[]),r=(c(n[0],"rmax",100)-c(n[0],"rmin",0))/i,o=0;for(o=0;o<i;o++){var s=n[o];s||((s=m(n[0])||{}).rinit=c(s,"rinit",c(s,"rmin",0))+r*o);var a=null;o<e._els.length?(a=e._els[o],d(a,s)):(a=h(s),e._els.push(a))}for(;o<e._els.length;o++){a=e._els.splice(o--,1)[0];e._ec&&e._ec.remove(a)}},h=function(e){f=f||p();var t=c(e,"rmin",0),i=c(e,"rmax",100),n=c(e,"rstep",1),r=c(e,"rinit",t),o=u.toColor(c(e,"color",[255,0,0])),s={position:c(e,"position",void 0)};"billboard"==c(e,"circleType","ellipse")?s.billboard={width:new l.CallbackProperty(function(){return a.edata.cr>a.edata.rmax&&(a.edata.cr=a.edata.rmin),2*a.edata.cr},!1),height:new l.CallbackProperty(function(){return a.edata.cr+=a.edata.rs,a.edata.cr>a.edata.rmax&&(a.edata.cr=a.edata.rmin),2*a.edata.cr},!1),image:f,color:new l.CallbackProperty(function(e,t){var i=1-a.edata.cr/a.edata.rmax;return a.edata.color.withAlpha(i,t)},!1),disableDepthTestDistance:Number.POSITIVE_INFINITY,show:new l.CallbackProperty(function(){return a.edata.cr>=a.edata.rmin&&a.edata.cr<=a.edata.rmax},!1)}:s.ellipse={semiMinorAxis:new l.CallbackProperty(function(){return a.edata.cr>a.edata.rmax&&(a.edata.cr=a.edata.rmin),a.edata.cr},!1),semiMajorAxis:new l.CallbackProperty(function(){return a.edata.cr+=a.edata.rs,a.edata.cr>a.edata.rmax&&(a.edata.cr=a.edata.rmin),a.edata.cr},!1),material:new l.ImageMaterialProperty({image:f,color:new l.CallbackProperty(function(e,t){var i=1-a.edata.cr/a.edata.rmax;return a.edata.color.withAlpha(i,t)},!1),transparent:!0}),show:new l.CallbackProperty(function(){return a.edata.cr>=a.edata.rmin&&a.edata.cr<=a.edata.rmax},!1)};var a=new l.Entity(s);return a.edata={rmin:t,rmax:i,rs:n,cr:r,color:o},a},d=function(e,t){if(t&&e&&e.edata)for(var i in e.edata)void 0!==t[i]&&(e.edata[i]=t[i])},p=function(e){e=e||64;var t=document.createElement("canvas");t.width=2*e,t.height=2*e;var i=t.getContext("2d");i.beginPath(),i.arc(e,e,e,0,2*Math.PI,!0),i.closePath();var n=i.createRadialGradient(e,e,e,e,e,0);return n.addColorStop(0,"rgba(255, 255, 255, 0.7)"),n.addColorStop(.4,"rgba(255, 255, 255, 0.1)"),n.addColorStop(1,"rgba(255, 255, 255, 0)"),i.fillStyle=n,i.fill(),t},m=function(e){if(e){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[i]="position"==i?l.Cartesian3.clone(e[i]):e[i]);return t}};return i.prototype.destroy=function(){!function(e){e.remove(),delete e._els,delete e._options}(this)},i.prototype.add=function(e){if(e){this._ec=e;for(var t=0;t<this._els.length;t++)this._ec.add(this._els[t])}},i.prototype.remove=function(){if(this._ec){for(var e=this._els.length-1;0<=e;e--)this._ec.remove(this._els[e]);delete this._ec}},i},this),function(o,s){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil"),n=require("sfmCEntityManager"),r=require("zlskCCicleRipple");module.exports=o(e,t,i,n,r,s)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil","sfmCEntityManager","ZlskCCicleRipple"],function(e,t,i,n,r){return o(e,t,i,n,r,s)});else{null==s.SFM&&(s.SFM={}),s.SFM||(s.SFM={});var a=s.SFM.cesiumlib||(s.SFM.cesiumlib={});s.SFM.cesiumlib.ZlskCMigrationMap=o(s.Cesium,a.sfmCEnum,a.sfmCesiumUtil,a.SfmCEntityManager,a.ZlskCCicleRipple,s)}}(function(g,e,v,i,d,t){function y(){return"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".replace(/x/g,function(e){return(16*Math.random()|0).toString(16)})}function C(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}function o(e,t){var i=S(t);if(!i)return null;var n={id:y(),type:"point",els:[]},r=C(t,"radius",0),o=C(t,"color",[255,255,255,255]),s=C(t,"labelOffset",[20,-20]),a={position:i,label:{font:C(t,"labelFont","20px sans-serif"),pixelOffset:new g.Cartesian2(s[0],s[1]),fillColor:v.toColor(o),horizontalOrigin:C(t,"labelHAlign",g.HorizontalOrigin.CENTER),verticalOrigin:C(t,"labelVAlign",g.VerticalOrigin.CENTER),disableDepthTestDistance:Number.POSITIVE_INFINITY,text:C(t,"text","")}};if(0<r){a.billboard={width:r,height:r,image:p(r),color:v.toColor(o),disableDepthTestDistance:Number.POSITIVE_INFINITY,show:!0};var l=e._em.add(a);n.els.push(l)}var u=C(t,"num",3),c=C(t,"maxRadius",50),f={num:u,circle:[{circleType:"billboard",position:i,rmin:r,rmax:c,rstep:C(t,"step",(c-r)/120),color:o}]},h=new d(f);return h.add(e._em.entities),n.els.push(h),e._els.push(n),n.id}function s(e,t){if(!t)return null;var i=C(t,"points",null);if(!i||i.length<2)return null;var n=i;if(2==i.length){var r=S(i[0]),o=S(i[1]);if(!r||!o)return null;var s=g.Cartesian3.midpoint(r,o,new g.Cartesian3),a=(f=g.Cartesian3.distance(r,o))*w,l=g.Cartographic.fromCartesian(s,void 0,_);g.Cartesian3.fromRadians(l.longitude,l.latitude,a,void 0,s),n=v.lerpSplinePosition({num:C(t,"num",parseInt(f/1e3)),points:[r,s,o]})}else{n=[];for(var u=0;u<i.length;u++){var c=S(i[u]);c&&n.push(c)}}var f,h=C(t,"duration",3e3);!isNaN(t.speed)&&0<t.speed&&(h=(f=g.Cartesian3.distance(n[0],n[n.length-1]))/t.speed);var d={polyline:{positions:n,width:C(t,"width",3),material:new g.ZlskFlowMaterialProperty({duration:h,color:v.toColor(C(t,"color",[255,255,255,255]))})}},p=e._em.add(d),m={id:y(),type:"line",els:[]};return m.els.push(p),e._els.push(m),m.id}function n(e){!function(e,t){e._options=t,e._viewer=t.viewer,e._em=new i({viewer:e._viewer}),e._els=[]}(this,e)}var w=1-Math.sqrt(3)/2,_=(new g.Cartesian3,new g.Cartographic),r=function(e){e._em.clear(),e._els.splice(0,e._els.length)},S=function(e){var t=C(e,"position",null);if(!t){var i=C(e,"coordinate",null);i&&(t=g.Cartesian3.fromDegrees(i[0],i[1],i[2]))}return t},p=function(e){var t=a[e];return t=t||(a[e]=a(e))},a=function(e){e=e||64;var t=document.createElement("canvas");t.width=2*e,t.height=2*e;var i=t.getContext("2d");return i.beginPath(),i.arc(e,e,e,0,2*Math.PI,!0),i.closePath(),i.fillStyle="rgba(255, 255, 255, 255)",i.fill(),t};return n.prototype.destroy=function(){!function(e){r(e),e._em.destroy(),delete e._em,delete e._viewer,delete e._options}(this)},n.prototype.clear=function(){r(this)},n.prototype.remove=function(e){!function(e,t){for(var i=function(e,t,i){if(!e)return null;for(var n=[],r=0;r<e.length;r++)e[r][t]==i&&n.push(e.splice(r--,1)[0]);return n}(e._els,"id",t),n=0;n<i.length;n++){var r=i[n].els;for(n=0;n<r.length;n++){var o=r[n];o instanceof g.Entity?e._em.remove(o):o instanceof d&&o.destroy()}}}(this,e)},n.prototype.addPoint=function(e){return o(this,e)},n.prototype.addPoints=function(e){return function(e,t){var i=[];e._em.beginAdd();for(var n=0;n<t.length;n++){var r=o(e,t[n]);r&&i.push(r)}return e._em.endAdd(),i}(this,e)},n.prototype.addLine=function(e){return s(this,e)},n.prototype.addLines=function(e){return function(e,t){var i=[];e._em.beginAdd();for(var n=0;n<t.length;n++){var r=s(e,t[n]);r&&i.push(r)}return e._em.endAdd(),i}(this,e)},n},this),function(l,u){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil"),n=require("sfmCMouseTip"),r=require("sfmCPoint"),o=require("sfmCPolyline"),s=require("sfmCPolygon"),a=require("sfmCCircle");module.exports=l(e,t,i,n,r,o,s,a,u)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil","sfmCMouseTip","sfmCPoint","sfmCPolyline","sfmCPolygon","sfmCCircle"],function(e,t,i,n,r,o,s,a){return l(e,t,i,n,r,o,s,a,u)});else{null==u.SFM&&(u.SFM={}),u.SFM||(u.SFM={});var c=u.SFM.cesiumlib||(u.SFM.cesiumlib={});u.SFM.cesiumlib.SfmCDrawTool=l(u.Cesium,c.sfmCEnum,c.sfmCesiumUtil,c.SfmCMouseTip,c.SfmCPoint,c.SfmCPolyline,c.SfmCPolygon,c.SfmCCircle,u)}}(function(s,e,p,t,c,m,g,d,i){function v(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}function y(){if(0!=arguments.length){if(1==arguments.length)return arguments[0];for(var e=arguments[0],t=1;t<arguments.length;t++)e=w(e,arguments[t]);return e}}function n(t){if(t.cel){var e=t._els.findIndex(function(e){return e==t.cel});if(0<=e)t._els.splice(e,1)[0].destroy();else t.cel.destroy()}delete t.cel}function r(e){!function(e,t){e.viewer=t.viewer,e._mt=t.mouseTip,e.options={};var i=e._ds=new s.CustomDataSource;e.viewer.dataSources.add(i),e._els=[],e._handler=new s.ScreenSpaceEventHandler(e.viewer.scene.canvas)}(this,e)}var C=s,o=[0,255,255,255],a=[0,255,255,255],l=[0,255,255,255],u=[0,255,255,50],f=e.drawType,h=(p.fguid,function(e){if(null==e)return e;if("string"==typeof e||"number"==typeof e||"boolean"==typeof e||"function"==typeof e)return e;if(e instanceof Array){for(var t=[],i=0;i<e.length;i++)t.push(h(e[i]));return t}var n={};for(var r in e){var o=e[r];n[r]=h(o)}return n}),w=function(e,t){if(null==e||"object"!=typeof e)return h(t);for(var i in t){var n=t[i],r=e[i],o=typeof n;if("undefined"!=o)if(null==r)e[i]=h(n);else if(null==n)e[i]=null;else if("string"==o||"number"==o||"boolean"==o||"function"==o)e[i]=n;else if(n instanceof Array)for(var s=e[i],a=0;a<n.length;a++)s[a]=w(s[a],n[a]);else"object"==o&&(e[i]=w(e[i],n))}return e},_=function(e,t,i,n,r,o,s){if(n){var a=new c({position:t});e._els.push(a),e.stopDraw();var l=a.getPosition(),u=void 0;v(r,"toDegree",!1)&&(u=p.cartesian3ToDegree(l)),"function"==typeof o&&o({positions:l,degrees:u})}else{v(r,"tip",!1!==e.options.tip)&&e._mt&&e._mt.show("单击绘制点")}},S=function(e,t,i,n,r,o,s){var a=e.cel,l=v(r,"style",void 0),u=v(r,"tip",!1!==e.options.tip);if(a){var c=a.getPositions(),f=c[c.length-1];if(f.x=t.x,f.y=t.y,f.z=t.z,n){i||(c.pop(),a.setPositions(c)),delete e.cel,e.stopDraw(),e._mt&&e._mt.hide();var h=a.getPositions(),d=void 0;v(r,"toDegree",!1)&&(d=p.cartesianArray3ToDegreeArray(h)),"function"==typeof o&&o({positions:h,degrees:d})}else i&&c.push(C.Cartesian3.clone(f)),a.setPositions(c)}else{if(!i)return void(u&&e._mt&&e._mt.show("单击绘制折线，右击结束绘制"));(a=e.cel=new m({style:y({},b(),e.options.style,l)})).setPositions([t,C.Cartesian3.clone(t)]),a.add(e._ds.entities),e._els.push(a)}},b=function(){return{point:{size:5,color:a,lineColor:o,lineWidth:0,visible:!1},polyline:{color:l,width:1,glow:!1,dash:!1},clampToGround:!0}},x=function(e,t,i,n,r,o,s){var a=e.cel,l=v(r,"style",void 0),u=v(r,"tip",!1!==e.options.tip);if(a){var c=a.getPositions(),f=c[c.length-1];if(f.x=t.x,f.y=t.y,f.z=t.z,n){i||(c.pop(),a.setPositions(c)),delete e.cel,e.stopDraw(),e._mt&&e._mt.hide();var h=a.getPositions(),d=void 0;v(r,"toDegree",!1)&&(d=p.cartesianArray3ToDegreeArray(h)),"function"==typeof o&&o({positions:h,degrees:d})}else i&&c.push(C.Cartesian3.clone(f)),a.setPositions(c)}else{if(!i)return void(u&&e._mt&&e._mt.show("单击绘制多边形，右击结束绘制"));(a=e.cel=new g({style:y({},E(),e.options.style,l)})).setPositions([t,C.Cartesian3.clone(t)]),a.add(e._ds.entities),e._els.push(a)}},E=function(){return{point:{size:5,color:a,lineColor:o,lineWidth:0,visible:!1},polyline:{color:l,width:1,glow:!1,dash:!1},polygon:{color:u},clampToGround:!0}},M=function(e,t,i,n,r,o,s){var a=e.cel,l=v(r,"style",void 0),u=v(r,"tip",!1!==e.options.tip);if(a){var c=a.getPositions();if(a.setPositions({center:c.center,point:t}),n||i){delete e.cel,e.stopDraw(),e._mt&&e._mt.hide();var f=a.getPositions(),h=void 0;v(r,"toDegree",!1)&&(h={center:p.cartesian3ToDegree(f.center),point:p.cartesian3ToDegree(f.point),radius:f.radius}),"function"==typeof o&&o({positions:f,degrees:h})}}else{if(!i)return void(u&&e._mt&&e._mt.show("单击绘制圆，右击结束绘制"));(a=e.cel=new d({style:y({},T(),e.options.style,l)})).setPositions({center:t,point:C.Cartesian3.clone(t)}),a.add(e._ds.entities),e._els.push(a)}},T=function(){return{point:{size:5,color:a,lineColor:o,lineWidth:0,visible:!1},line:{color:l,width:1},circle:{color:u},label:{},clampToGround:!0}},P=function(e,t){return t.scene.pickPosition(e)};return r.prototype.destroy=function(){!function(e){e.stopDraw(),e._handler&&e._handler.destroy(),delete e._handler,e.clearDraw(),e._ds&&e.viewer.dataSources.remove(e._ds,!0),delete e._ds,delete e.viewer}(this)},r.prototype.setDrawOptions=function(e){this.options=e||{}},r.prototype.clearDraw=function(){var e=this;for(e._mt&&e._mt.hide(),n(e);0<e._els.length;){e._els.pop().destroy()}e._ds&&e._ds.entities.removeAll()},r.prototype.clearLast=function(){0<this._els.length&&this._els.pop().destroy()},r.prototype.draw=function(e,t,i){!function(e){for(var t in f)if(f[t]===e)return!0;return!1}(e)||(n(this),this.viewer.scene.pickTranslucentDepth=!0,function(i,n,r,o){var e=i._handler;e&&(e.setInputAction(function(e){var t=P(e.position,i.viewer);t&&(n==f.POINT?_(i,t,!0,!0,o,r):n==f.POLYLINE?S(i,t,!0,!1,o,r):n==f.POLYGON?x(i,t,!0,!1,o,r):n==f.CIRCLE&&M(i,t,!0,!1,o,r))},s.ScreenSpaceEventType.LEFT_CLICK),e.setInputAction(function(e){var t=P(e.endPosition,i.viewer);t&&(n==f.POINT?_(i,t,!1,!1,o,r):n==f.POLYLINE?S(i,t,!1,!1,o,r):n==f.POLYGON?x(i,t,!1,!1,o,r):n==f.CIRCLE&&M(i,t,!1,!1,o,r))},s.ScreenSpaceEventType.MOUSE_MOVE),e.setInputAction(function(e){var t=P(e.position,i.viewer);t&&(n==f.POINT?_(i,t,!0,!0,o,r):n==f.POLYLINE?S(i,t,!1,!0,o,r):n==f.POLYGON?x(i,t,!1,!0,o,r):n==f.CIRCLE&&M(i,t,!1,!0,o,r),i.viewer.scene.pickTranslucentDepth=!1)},s.ScreenSpaceEventType.RIGHT_CLICK))}(this,e,t,i))},r.prototype.stopDraw=function(){var e=this;e._mt&&e._mt.hide(),e._handler&&(e._handler.removeInputAction(s.ScreenSpaceEventType.LEFT_CLICK),e._handler.removeInputAction(s.ScreenSpaceEventType.MOUSE_MOVE),e._handler.removeInputAction(s.ScreenSpaceEventType.RIGHT_CLICK)),e.viewer.scene.pickTranslucentDepth=!1,n(e)},r},this),function(n,r){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil");module.exports=n(e,t,i,r)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil"],function(e,t,i){return n(e,t,i,r)});else{null==r.SFM&&(r.SFM={}),r.SFM||(r.SFM={});var o=r.SFM.cesiumlib||(r.SFM.cesiumlib={});r.SFM.cesiumlib.SfmCHDistance=n(r.Cesium,o.sfmCEnum,o.sfmCesiumUtil,r)}}(function(s,e,a,t){function h(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}function i(e){!function(e,t){e.id=t.id||b(),e.data={},e.style={tpoint:h(t.style,"tpoint",void 0),bpoint:h(t.style,"bpoint",void 0),label:h(t.style,"label",void 0),polyline:h(t.style,"polyline",void 0),vline:h(t.style,"vline",void 0)},e.positions=[],e.hpos=[],e.entities={hpolyline:null,tpoints:[],bpoints:[],vlines:[]},e.distance=0,x(e)}(this,e)}var d=s,l=[0,255,255,255],u=[0,255,255,255],r=[255,255,0,255],o=[255,0,0,255],c=[0,255,255,255],f=[0,0,0,0],p=[0,255,0,255],m=[0,0,0,100],g=[255,255,0,255],v=[0,0,0,0],y=[7,5],C=[0,-20],n=new s.Cartographic,w=new s.Cartographic,_=new s.Cartographic,S=new s.EllipsoidGeodesic,b=a.fguid,x=function(e){var t=a.toColor(h(e.style.polyline,"color",c)),i=t;if(h(e.style.polyline,"glow",!1)){var n=h(e.style.polyline,"glowPower",.25),r=h(e.style.polyline,"taperPower",1);i=new d.PolylineGlowMaterialProperty({color:t,glowPower:n,taperPower:r})}else h(e.style.polyline,"dash",!1)&&(i=new d.PolylineDashMaterialProperty({color:t,gapColor:a.toColor(h(e.style.polyline,"gapColor",f)),dashLength:h(e.style.polyline,"dashLength",16),dashPattern:h(e.style.polyline,"dashPattern",parseInt("11111111",2))}));e.entities.hpolyline=new d.Entity({polyline:{positions:new d.CallbackProperty(function(){return e.hpos},!1),width:h(e.style.polyline,"width",2),material:i,clampToGround:!1,show:!0}})},E=function(e,t,i){var n=e.style.vline;"function"==typeof n&&(n=n(i));var r=i.index;return new d.Entity({polyline:{positions:new d.CallbackProperty(function(){return[e.positions[r],e.hpos[r]]},!1),width:h(n,"width",1),material:a.toColor(h(n,"color",p)),clampToGround:!1,show:!0}})},M=function(e,t,i){var n=e.style.tpoint,r=h(e.style.label,"backgroundPadding",y),o=h(e.style.label,"pixelOffset",C);return new d.Entity({position:t,point:{pixelSize:h(n,"size",5),heightReference:d.HeightReference.NONE,color:a.toColor(h(n,"color",u)),outlineColor:a.toColor(h(n,"lineColor",l)),outlineWidth:h(n,"lineWidth",0),disableDepthTestDistance:Number.POSITIVE_INFINITY,show:h(n,"visible",!0)},label:{showBackground:h(e.style.label,"showBackground",!0),backgroundColor:a.toColor(h(e.style.label,"backgroundColor",m)),backgroundPadding:new s.Cartesian2(r[0],r[1]),pixelOffset:new s.Cartesian2(o[0],o[1]),fillColor:a.toColor(h(e.style.label,"fillColor",g)),outlineColor:a.toColor(h(e.style.label,"lineColor",v)),outlineWidth:h(e.style.point,"lineWidth",1),font:h(e.style.label,"font","14px sans-serif"),horizontalOrigin:s.HorizontalOrigin.CENTER,text:"",disableDepthTestDistance:Number.POSITIVE_INFINITY,show:h(e.style.label,"visible",!0)}})},T=function(e,t,i){var n=e.style.bpoint;return new d.Entity({position:t,point:{pixelSize:h(n,"size",5),heightReference:d.HeightReference.NONE,color:a.toColor(h(n,"color",o)),outlineColor:a.toColor(h(n,"lineColor",r)),outlineWidth:h(n,"lineWidth",1),disableDepthTestDistance:Number.POSITIVE_INFINITY,show:h(n,"visible",!0)}})},P=function(e,t){return e&&t?(S.setEndPoints(e,t),S.surfaceDistance):0},F=function(e){for(var t=Number.NEGATIVE_INFINITY,i=0;i<e.length;i++)s.Cartographic.fromCartesian(e[i],null,n),n&&n.height>t&&(t=n.height);return t};return i.prototype.destroy=function(){this.remove(),delete this.entities,delete this.positions,delete this.data},i.prototype.getDistance=function(){return this.distance},i.prototype.getPositions=function(){return this.positions},i.prototype.setPositions=function(e,t){this.positions=e,function(e,t){var i=e.positions,n=F(i),r=0,o=0;for(r=0;r<i.length;r++){var s=i[r];if(d.Cartographic.fromCartesian(s,null,w),w.height=n+20,r<e.hpos.length){if(d.Cartesian3.fromRadians(w.longitude,w.latitude,w.height,null,e.hpos[r]),e.entities.tpoints[r].position.setValue(e.hpos[r]),0<r){d.Cartographic.fromCartesian(e.hpos[r-1],null,_);var a=1e3<=(o+=P(_,w))?Number((o/1e3).toFixed(3))+"km":Number(o.toFixed(3))+"m";e.entities.tpoints[r].label.text=a}h(e.style.tpoint,"visible",!0)&&(e.entities.tpoints[r].point.show=r<(t?i.length:i.length-1)),e.entities.bpoints[r].position.setValue(s),h(e.style.bpoints,"visible",!0)&&(e.entities.bpoints[r].point.show=r<(t?i.length:i.length-1))}else{var l=d.Cartesian3.fromRadians(w.longitude,w.latitude,w.height);e.hpos.push(l);var u=M(e,l,{index:r,count:i.length});e.entities.tpoints.push(u),h(e.style.tpoint,"visible",!0)&&(u.point.show=r<(t?i.length:i.length-1)),e.ec&&e.ec.add(u);var c=T(e,s,{index:r,count:i.length});e.entities.bpoints.push(c),h(e.style.bpoints,"visible",!0)&&(c.point.show=r<(t?i.length:i.length-1)),e.ec&&e.ec.add(c);var f=E(e,[s,l],{index:r,count:i.length});e.entities.vlines.push(f),e.ec&&e.ec.add(f)}}for(;r<e.hpos.length;r++){e.hpos.splice(r,1);u=e.entities.tpoints.splice(r,1)[0];e.ec&&e.ec.remove(u);c=e.entities.bpoints.splice(r,1)[0];e.ec&&e.ec.remove(c);f=e.entities.vlines.splice(r,1)[0];e.ec&&e.ec.remove(f),r--}e.distance=o}(this,t)},i.prototype.add=function(e){if(e){this.ec=e,this.ec.add(this.entities.hpolyline);for(var t=0;t<this.entities.tpoints.length;t++)this.ec.add(this.entities.tpoints[t]),this.ec.add(this.entities.bpoints[t]),this.ec.add(this.entities.vlines[t])}},i.prototype.remove=function(){if(this.ec){for(var e=this.entities.tpoints.length-1;0<=e;e--)this.ec.remove(this.entities.vlines[e]),this.ec.remove(this.entities.bpoints[e]),this.ec.remove(this.entities.tpoints[e]);this.ec.remove(this.entities.hpolyline),delete this.ec}},i},this),function(n,r){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil");module.exports=n(e,t,i,r)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil"],function(e,t,i){return n(e,t,i,r)});else{null==r.SFM&&(r.SFM={}),r.SFM||(r.SFM={});var o=r.SFM.cesiumlib||(r.SFM.cesiumlib={});r.SFM.cesiumlib.SfmCVDistance=n(r.Cesium,o.sfmCEnum,o.sfmCesiumUtil,r)}}(function(s,e,a,t){function v(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}function i(e){!function(e,t){e.id=t.id||_(),e.data={},e.style={spoint:v(t.style,"spoint",void 0),epoint:v(t.style,"epoint",void 0),label:v(t.style,"label",void 0),hline:v(t.style,"hline",void 0),vline:v(t.style,"vline",void 0)},e.positions=[],e.spos=null,e.eps=[],e.entities={spoint:null,epoints:[],hlines:[],vlines:[]}}(this,e)}var y=s,n=[0,255,255,255],r=[0,255,0,255],l=[255,255,0,255],u=[255,0,0,255],o=[0,255,0,255],c=[0,0,0,0],f=[0,255,255,255],h=[0,0,0,100],d=[255,255,0,255],p=[0,0,0,0],m=[7,5],g=[0,-20],C=(new s.Cartographic,new s.Cartographic),w=new s.Cartographic,_=(new s.EllipsoidGeodesic,a.fguid),S=function(t,i){var e=M(t.style.vline);return new y.Entity({polyline:{positions:new y.CallbackProperty(function(){var e=t.eps[i.index];return e.f?[t.spos,e.fpos]:[e.epos,e.fpos]},!1),width:v(t.style.vline,"width",2),material:e,clampToGround:!1,show:!0}})},b=function(t,i){var e=t.style.hline;return new y.Entity({polyline:{positions:new y.CallbackProperty(function(){var e=t.eps[i.index];return e.f?[e.epos,e.fpos]:[t.spos,e.fpos]},!1),width:v(e,"width",1),material:a.toColor(v(e,"color",o)),clampToGround:!1,show:!0}})},x=function(e,t){var i=e.style.spoint;return new y.Entity({position:t,point:{pixelSize:v(i,"size",5),heightReference:y.HeightReference.NONE,color:a.toColor(v(i,"color",r)),outlineColor:a.toColor(v(i,"lineColor",n)),outlineWidth:v(i,"lineWidth",0),disableDepthTestDistance:Number.POSITIVE_INFINITY,show:v(i,"visible",!0)}})},E=function(e,t,i){var n=e.style.epoint,r=v(e.style.label,"backgroundPadding",m),o=v(e.style.label,"pixelOffset",g);return new y.Entity({position:t,point:{pixelSize:v(n,"size",5),heightReference:y.HeightReference.NONE,color:a.toColor(v(n,"color",u)),outlineColor:a.toColor(v(n,"lineColor",l)),outlineWidth:v(n,"lineWidth",1),disableDepthTestDistance:Number.POSITIVE_INFINITY,show:v(n,"visible",!0)},label:{showBackground:v(e.style.label,"showBackground",!0),backgroundColor:a.toColor(v(e.style.label,"backgroundColor",h)),backgroundPadding:new s.Cartesian2(r[0],r[1]),pixelOffset:new s.Cartesian2(o[0],o[1]),fillColor:a.toColor(v(e.style.label,"fillColor",d)),outlineColor:a.toColor(v(e.style.label,"lineColor",p)),outlineWidth:v(e.style.point,"lineWidth",1),font:v(e.style.label,"font","14px sans-serif"),horizontalOrigin:s.HorizontalOrigin.CENTER,text:"",disableDepthTestDistance:Number.POSITIVE_INFINITY,show:v(e.style.label,"visible",!0)}})},M=function(e){var t=a.toColor(v(e,"color",f)),i=t;if(v(e,"glow",!1)){var n=v(e,"glowPower",.25),r=v(e,"taperPower",1);i=new y.PolylineGlowMaterialProperty({color:t,glowPower:n,taperPower:r})}else v(e,"dash",!1)&&(i=new y.PolylineDashMaterialProperty({color:t,gapColor:a.toColor(v(e,"gapColor",c)),dashLength:v(e,"dashLength",16),dashPattern:v(e,"dashPattern",parseInt("11111111",2))}));return i};return i.prototype.destroy=function(){this.remove(),delete this.entities,delete this.positions,delete this.spos,delete this.eps,delete this.style,delete this.data},i.prototype.getDistance=function(){for(var e=[{position:this.spos,distance:0}],t=0;t<this.eps.length;t++){var i=this.eps[t];e.push({position:i.epos,distance:i.distance})}return e},i.prototype.getPositions=function(){return this.positions},i.prototype.setPositions=function(e,t){this.positions=e,function(e,t){var i=e.positions,n=e.spos=i[0];e.entities.spoint?e.entities.spoint.position.setValue(n):(e.entities.spoint=x(e,n),e.ec&&e.ec.add(e.entities.spoint)),y.Cartographic.fromCartesian(n,null,C);for(var r=C.height,o=1,s=o-1;o<i.length;o++){var a=i[o];s=o-1,y.Cartographic.fromCartesian(a,null,w);var l=w.height;if(s<e.eps.length){var u=e.eps[s];if(y.Cartesian3.clone(a,u.epos),d=(h=u.f=r<=l)?y.Cartesian3.fromRadians(C.longitude,C.latitude,l,null,u.fpos):y.Cartesian3.fromRadians(w.longitude,w.latitude,r,null,u.fpos),e.entities.epoints[s].position.setValue(u.epos),0<o){var c=u.distance=l-r,f=1e3<=c?Number((c/1e3).toFixed(3))+"km":Number(c.toFixed(3))+"m";e.entities.epoints[s].label.text=f}v(e.style.epoints,"visible",!0)&&(e.entities.epoints[s].point.show=s<(t?e.eps.length:e.eps.length-1))}else{var h,d=null;d=(h=r<=l)?y.Cartesian3.fromRadians(C.longitude,C.latitude,l):y.Cartesian3.fromRadians(w.longitude,w.latitude,r),e.eps.push({epos:a,fpos:d,f:h,distance:l-r});var p=S(e,{index:s,count:e.eps.length});e.entities.vlines.push(p),e.ec&&e.ec.add(p);var m=b(e,{index:s,count:e.eps.length});e.entities.hlines.push(m),e.ec&&e.ec.add(m);var g=E(e,a,{index:o,count:e.eps.length});e.entities.epoints.push(g),e.ec&&e.ec.add(g)}}for(s=o-1;s<e.eps.length;s++){e.eps.splice(s,1);g=e.entities.epoints.splice(s,1)[0];e.ec&&e.ec.remove(g);m=e.entities.hlines.splice(s,1)[0];e.ec&&e.ec.remove(m);p=e.entities.vlines.splice(s,1)[0];e.ec&&e.ec.remove(p),s--}}(this,t)},i.prototype.add=function(e){if(e){this.ec=e,this.ec.add(this.entities.spoint);for(var t=0;t<this.entities.epoints.length;t++)this.ec.add(this.entities.epoints[t]),this.ec.add(this.entities.hlines[t]),this.ec.add(this.entities.vlines[t])}},i.prototype.remove=function(){if(this.ec){for(var e=this.entities.epoints.length-1;0<=e;e--)this.ec.remove(this.entities.vlines[e]),this.ec.remove(this.entities.hlines[e]),this.ec.remove(this.entities.epoints[e]);this.ec.remove(this.entities.spoint),delete this.ec}},i},this),function(n,r){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil");module.exports=n(e,t,i,r)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil"],function(e,t,i){return n(e,t,i,r)});else{null==r.SFM&&(r.SFM={}),r.SFM||(r.SFM={});var o=r.SFM.cesiumlib||(r.SFM.cesiumlib={});r.SFM.cesiumlib.SfmCDistance=n(r.Cesium,o.sfmCEnum,o.sfmCesiumUtil,r)}}(function(s,e,a,t){function l(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}function i(e){!function(e,t){e.id=t.id||n(),e.data={},e.style={point:l(t.style,"point",void 0),label:l(t.style,"label",void 0),polyline:l(t.style,"polyline",void 0)},e.positions=[],e.ps=[],e.entities={polyline:null,points:[]},e.distance=0,r(e)}(this,e)}var u=s,c=[255,255,0,255],f=[255,0,0,255],o=[0,255,255,255],h=[0,0,0,0],d=[0,0,0,100],p=[255,255,0,255],m=[0,0,0,0],g=[7,5],v=[0,-20],n=(new s.Cartographic,new s.Cartographic,new s.Cartographic,new s.EllipsoidGeodesic,a.fguid),r=function(e){var t=a.toColor(l(e.style.polyline,"color",o)),i=t;if(l(e.style.polyline,"glow",!1)){var n=l(e.style.polyline,"glowPower",.25),r=l(e.style.polyline,"taperPower",1);i=new u.PolylineGlowMaterialProperty({color:t,glowPower:n,taperPower:r})}else l(e.style.polyline,"dash",!1)&&(i=new u.PolylineDashMaterialProperty({color:t,gapColor:a.toColor(l(e.style.polyline,"gapColor",h)),dashLength:l(e.style.polyline,"dashLength",16),dashPattern:l(e.style.polyline,"dashPattern",parseInt("11111111",2))}));e.entities.polyline=new u.Entity({polyline:{positions:new u.CallbackProperty(function(){return e.ps},!1),width:l(e.style.polyline,"width",2),material:i,clampToGround:!1,show:!0}})},y=function(e,t,i){var n=e.style.point,r=l(e.style.label,"backgroundPadding",g),o=l(e.style.label,"pixelOffset",v);return new u.Entity({position:t,point:{pixelSize:l(n,"size",5),heightReference:u.HeightReference.NONE,color:a.toColor(l(n,"color",f)),outlineColor:a.toColor(l(n,"lineColor",c)),outlineWidth:l(n,"lineWidth",1),disableDepthTestDistance:Number.POSITIVE_INFINITY,show:l(n,"visible",!0)},label:{showBackground:l(e.style.label,"showBackground",!0),backgroundColor:a.toColor(l(e.style.label,"backgroundColor",d)),backgroundPadding:new s.Cartesian2(r[0],r[1]),pixelOffset:new s.Cartesian2(o[0],o[1]),fillColor:a.toColor(l(e.style.label,"fillColor",p)),outlineColor:a.toColor(l(e.style.label,"lineColor",m)),outlineWidth:l(e.style.point,"lineWidth",1),font:l(e.style.label,"font","14px sans-serif"),horizontalOrigin:s.HorizontalOrigin.CENTER,text:"",disableDepthTestDistance:Number.POSITIVE_INFINITY,show:l(e.style.label,"visible",!0)}})};return i.prototype.destroy=function(){this.remove(),delete this.entities,delete this.positions,delete this.data},i.prototype.getDistance=function(){return this.distance},i.prototype.getPositions=function(){return this.positions},i.prototype.setPositions=function(e,t){this.positions=e,function(e,t){var i=e.positions,n=0,r=0;for(n=0;n<i.length;n++){var o=i[n];if(n<e.ps.length){if(u.Cartesian3.clone(o,e.ps[n]),e.entities.points[n].position.setValue(e.ps[n]),0<n){var s=1e3<=(r+=u.Cartesian3.distance(e.ps[n-1],e.ps[n]))?Number((r/1e3).toFixed(3))+"km":Number(r.toFixed(3))+"m";e.entities.points[n].label.text=s}l(e.style.tpoint,"visible",!0)&&(e.entities.points[n].point.show=n<(t?i.length:i.length-1))}else{e.ps.push(o);var a=y(e,o,{index:n,count:i.length});e.entities.points.push(a),l(e.style.tpoint,"visible",!0)&&(a.point.show=n<(t?i.length:i.length-1)),e.ec&&e.ec.add(a)}}for(;n<e.ps.length;n++){e.ps.splice(n,1);a=e.entities.points.splice(n,1)[0];e.ec&&e.ec.remove(a),n--}e.distance=r}(this,t)},i.prototype.add=function(e){if(e){this.ec=e,this.ec.add(this.entities.polyline);for(var t=0;t<this.entities.points.length;t++)this.ec.add(this.entities.points[t])}},i.prototype.remove=function(){if(this.ec){for(var e=this.entities.points.length-1;0<=e;e--)this.ec.remove(this.entities.points[e]);this.ec.remove(this.entities.polyline),delete this.ec}},i},this),function(r,o){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil"),n=require("sfmCPolyline");module.exports=r(e,t,i,n,o)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil","sfmCPolyline"],function(e,t,i,n){return r(e,t,i,n,o)});else{null==o.SFM&&(o.SFM={}),o.SFM||(o.SFM={});var s=o.SFM.cesiumlib||(o.SFM.cesiumlib={});o.SFM.cesiumlib.SfmCPolygonArea=r(o.Cesium,s.sfmCEnum,s.sfmCesiumUtil,s.SfmCPolyline,o)}}(function(u,e,s,o,t){function a(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}function l(e){for(var t=[],i=0;i<e.length;i++)t.push(c.Cartesian3.clone(e[i]));return t}function i(e){!function(e,t){e.id=t.id||v(),e.data={},e.style={point:a(t.style,"point",void 0),polyline:a(t.style,"polyline",void 0),polygon:a(t.polygon,"polygon",void 0),label:a(t.style,"label",void 0),clampToGround:a(t.style,"clampToGround",!0)},e.positions=[];var i=e.entities=[],n=s.toColor(a(e.style.polygon,"color",f)),r=e.data.polygon=new c.Entity({polygon:{hierarchy:new c.CallbackProperty(function(){return{positions:e.positions}},!1),material:n,height:0,heightReference:c.HeightReference.NONE,perPositionHeight:!e.style.clampToGround,fill:a(e.style.polygon,"fill",!0),show:a(t,"visible",!0)}});i.push(r),e.style.polyline||(e.style.polyline={}),e.style.polyline.close=!0;e._elOutline=new o({style:{point:e.style.point,polyline:e.style.polyline,clampToGround:e.style.clampToGround}});e.setPositions(e.positions)}(this,e)}var c=u,f=[0,255,255,50],h=[0,0,0,100],d=[255,255,0,255],p=[0,0,0,0],m=[7,5],g=[0,-30],v=s.fguid;return i.prototype.destroy=function(){this.remove(),delete this.entities,delete this.positions,delete this._positions,delete this.data},i.prototype.getArea=function(){return this.area},i.prototype.getEntity=function(){return this.entities[0]},i.prototype.getPositions=function(){return this._positions},i.prototype.setPositions=function(e){var t=this;t.positions=l(t._positions=e);var i=t.entities[0];if(t.positions.length<3?i.polyline||(t.ec&&t.ec.remove(t.entities[0]),i=t.entities[0]=new c.Entity({polyline:{positions:new c.CallbackProperty(function(){return t.positions},!1),material:s.toColor(a(t.style.polygon,"color",f)),clampToGround:a(t.style,"clampToGround",!1),show:!0}}),t.ec&&t.ec.add(t.entities[0])):i.polygon||(t.ec&&t.ec.remove(t.entities[0]),i=t.entities[0]=new c.Entity({polygon:{hierarchy:new c.CallbackProperty(function(){return{positions:t.positions}},!1),material:s.toColor(a(t.style.polygon,"color",f)),heightReference:c.HeightReference.NONE,perPositionHeight:!t.style.clampToGround,fill:a(t.style.polygon,"fill",!0),show:!0}}),t.ec&&t.ec.add(t.entities[0])),t._elOutline.setPositions(l(t.positions)),t.area=0,2<t.positions.length){t.area=function(e){if(!e||e.length<3)return 0;for(var t=e[0],i=new u.Cartesian3,n=new u.Cartesian3,r=new u.Cartesian3,o=0,s=0;s<e.length-1;s++){var a=e[s],l=e[s+1];u.Cartesian3.subtract(a,t,i),u.Cartesian3.subtract(l,t,n),u.Cartesian3.cross(i,n,r),o+=u.Cartesian3.magnitude(r)}return o/2}(t.positions);var n=t.positions[t.positions.length-1];t.label?t.label.position.setValue(n):(t.label=function(e,t){var i=a(e.style.label,"backgroundPadding",m),n=a(e.style.label,"pixelOffset",g);return new c.Entity({position:t,label:{showBackground:a(e.style.label,"showBackground",!0),backgroundColor:s.toColor(a(e.style.label,"backgroundColor",h)),backgroundPadding:new u.Cartesian2(i[0],i[1]),pixelOffset:new u.Cartesian2(n[0],n[1]),fillColor:s.toColor(a(e.style.label,"fillColor",d)),outlineColor:s.toColor(a(e.style.label,"lineColor",p)),outlineWidth:a(e.style.label,"lineWidth",1),font:a(e.style.label,"font","14px sans-serif"),horizontalOrigin:u.HorizontalOrigin.CENTER,text:"",disableDepthTestDistance:Number.POSITIVE_INFINITY,show:a(e.style.label,"visible",!0)}})}(this,n),t.ec&&t.ec.add(t.label));var r=t.area,o=1e6<=r?Number((r/1e6).toFixed(3))+"平方千米":Number(r.toFixed(3))+"平方米";t.label.label.text=o}else t.label&&(t.label.show=!1)},i.prototype.add=function(e){e&&(this.ec=e,this.ec.add(this.entities[0]),this.label&&this.ec.add(this.label),this._elOutline.add(this.ec))},i.prototype.remove=function(){this.ec&&(this._elOutline.remove(),this.label&&this.ec.remove(this.label),this.ec.remove(this.entities[0]),delete this.ec)},i},this),function(n,r){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil");module.exports=n(e,t,i,r)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil"],function(e,t,i){return n(e,t,i,r)});else{null==r.SFM&&(r.SFM={}),r.SFM||(r.SFM={});var o=r.SFM.cesiumlib||(r.SFM.cesiumlib={});r.SFM.cesiumlib.SfmCHAngle=n(r.Cesium,o.sfmCEnum,o.sfmCesiumUtil,r)}}(function(a,e,l,t){function p(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}function i(e){!function(e,t){e.id=t.id||_(),e.data={},e.style={tpoint:p(t.style,"tpoint",void 0),bpoint:p(t.style,"bpoint",void 0),label:p(t.style,"label",void 0),hline:p(t.style,"hline",void 0),vline:p(t.style,"vline",void 0)},e.positions=[],e.hpos=[],e.entities={hlines:[],tpoints:[],bpoints:[],vlines:[]},e.angle=0}(this,e)}var m=a,u=[0,255,255,255],c=[0,255,255,255],r=[255,255,0,255],o=[255,0,0,255],n=[0,255,255,255],s=[0,255,0,255],f=[0,0,0,100],h=[255,255,0,255],d=[0,0,0,0],g=[7,5],v=[0,-20],y=new a.Cartographic,C=new a.Cartographic,w=(new a.Cartographic,new a.EllipsoidGeodesic),_=l.fguid,S=function(e,t){var i=e.style.hline;return new m.Entity({polyline:{positions:new m.CallbackProperty(function(){return[e.hpos[0],e.hpos[t.index]]},!1),width:p(i,"width",2),material:l.toColor(p(i,"color",n)),clampToGround:!1,show:!0}})},b=function(e,t){var i=e.style.vline;"function"==typeof i&&(i=i(t));var n=t.index;return new m.Entity({polyline:{positions:new m.CallbackProperty(function(){return[e.positions[n],e.hpos[n]]},!1),width:p(i,"width",1),material:l.toColor(p(i,"color",s)),clampToGround:!1,show:!0}})},x=function(e,t,i){var n=e.style.tpoint,r=p(e.style.label,"backgroundPadding",g),o=p(e.style.label,"pixelOffset",v),s={position:t,point:{pixelSize:p(n,"size",5),heightReference:m.HeightReference.NONE,color:l.toColor(p(n,"color",c)),outlineColor:l.toColor(p(n,"lineColor",u)),outlineWidth:p(n,"lineWidth",0),disableDepthTestDistance:Number.POSITIVE_INFINITY,show:p(n,"visible",!0)}};return 1<i.index&&(s.label={showBackground:p(e.style.label,"showBackground",!0),backgroundColor:l.toColor(p(e.style.label,"backgroundColor",f)),backgroundPadding:new a.Cartesian2(r[0],r[1]),pixelOffset:new a.Cartesian2(o[0],o[1]),fillColor:l.toColor(p(e.style.label,"fillColor",h)),outlineColor:l.toColor(p(e.style.label,"lineColor",d)),outlineWidth:p(e.style.point,"lineWidth",1),font:p(e.style.label,"font","14px sans-serif"),horizontalOrigin:a.HorizontalOrigin.CENTER,text:"",disableDepthTestDistance:Number.POSITIVE_INFINITY,show:p(e.style.label,"visible",!0)}),new m.Entity(s)},E=function(e,t,i){var n=e.style.bpoint;return new m.Entity({position:t,point:{pixelSize:p(n,"size",5),heightReference:m.HeightReference.NONE,color:l.toColor(p(n,"color",o)),outlineColor:l.toColor(p(n,"lineColor",r)),outlineWidth:p(n,"lineWidth",1),disableDepthTestDistance:Number.POSITIVE_INFINITY,show:p(n,"visible",!0)}})},M=function(e,t,i){if(!e||!t)return 0;w.setEndPoints(e,t);var n=w.startHeading;w.setEndPoints(e,i);var r=180*(w.startHeading-n)/Math.PI;return r<0&&(r+=360),180<r&&(r=360-r),r},T=function(e){for(var t=Number.NEGATIVE_INFINITY,i=0;i<e.length;i++)a.Cartographic.fromCartesian(e[i],null,y),y&&y.height>t&&(t=y.height);return t};return i.prototype.destroy=function(){this.remove(),delete this.entities,delete this.positions,delete this.data},i.prototype.getAngle=function(){return this.angle},i.prototype.getPositions=function(){return this.positions},i.prototype.setPositions=function(e,t){this.positions=e,function(e,t){var i=e.positions,n=T(i),r=null,o=null,s=0,a=0;for(s=0;s<i.length;s++){var l=i[s];if(m.Cartographic.fromCartesian(l,null,C),C.height=n+20,0==s?r=m.Cartographic.clone(C):1==s&&(o=m.Cartographic.clone(C)),s<e.hpos.length){if(m.Cartesian3.fromRadians(C.longitude,C.latitude,C.height,null,e.hpos[s]),e.entities.tpoints[s].position.setValue(e.hpos[s]),p(e.style.tpoint,"visible",!0)&&(e.entities.tpoints[s].point.show=s<(t?i.length:i.length-1)),1<s){a=e.angle=M(r,o,C);e.entities.tpoints[s].label.text=Number(a.toFixed(3))+"度"}e.entities.bpoints[s].position.setValue(l),p(e.style.bpoints,"visible",!0)&&(e.entities.bpoints[s].point.show=s<(t?i.length:i.length-1))}else{var u=m.Cartesian3.fromRadians(C.longitude,C.latitude,C.height);e.hpos.push(u);var c=x(e,u,{index:s,count:i.length});e.entities.tpoints.push(c),p(e.style.tpoint,"visible",!0)&&(c.point.show=s<(t?i.length:i.length-1)),e.ec&&e.ec.add(c);var f=E(e,l,{index:s,count:i.length});e.entities.bpoints.push(f),p(e.style.bpoints,"visible",!0)&&(f.point.show=s<(t?i.length:i.length-1)),e.ec&&e.ec.add(f);var h=b(e,{index:s,count:i.length});if(e.entities.vlines.push(h),e.ec&&e.ec.add(h),0<s){var d=S(e,{index:s,count:i.length});e.entities.hlines.push(d),e.ec&&e.ec.add(d)}}}for(;s<e.hpos.length;s++){e.hpos.splice(s,1);c=e.entities.tpoints.splice(s,1)[0];e.ec&&e.ec.remove(c);f=e.entities.bpoints.splice(s,1)[0];e.ec&&e.ec.remove(f);h=e.entities.vlines.splice(s,1)[0];e.ec&&e.ec.remove(h);d=e.entities.hlines.splice(s-1,1)[0];e.ec&&e.ec.remove(d),s--}}(this,t)},i.prototype.add=function(e){if(e){this.ec=e,this.ec.add(this.entities.hpolyline);for(var t=0;t<this.entities.tpoints.length;t++)this.ec.add(this.entities.tpoints[t]),this.ec.add(this.entities.bpoints[t]),this.ec.add(this.entities.vlines[t]);for(t=0;t<this.entities.hlines.length;t++)this.ec.add(this.entities.hlines[t])}},i.prototype.remove=function(){if(this.ec){for(var e=this.entities.tpoints.hlines-1;0<=e;e--)this.ec.remove(this.entities.hlines[e]);for(e=this.entities.tpoints.length-1;0<=e;e--)this.ec.remove(this.entities.vlines[e]),this.ec.remove(this.entities.bpoints[e]),this.ec.remove(this.entities.tpoints[e]);this.ec.remove(this.entities.hpolyline),delete this.ec}},i},this),function(h,d){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil"),n=require("sfmCMouseTip"),r=require("sfmCPolyline"),o=require("sfmCPolygon"),s=require("sfmCCircle"),a=require("sfmCHDistance"),l=require("sfmCVDistance"),u=require("sfmCDistance"),c=require("sfmCPolygonArea"),f=require("sfmCHAngle");module.exports=h(e,t,i,n,r,o,s,a,l,u,c,f,d)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil","sfmCMouseTip","sfmCPolyline","sfmCPolygon","sfmCCircle","sfmCHDistance","sfmCVDistance","sfmCDistance","sfmCPolygonArea","sfmCHAngle"],function(e,t,i,n,r,o,s,a,l,u,c,f){return h(e,t,i,n,r,o,s,a,l,u,c,f,d)});else{null==d.SFM&&(d.SFM={}),d.SFM||(d.SFM={});var p=d.SFM.cesiumlib||(d.SFM.cesiumlib={});d.SFM.cesiumlib.SfmCMeasureTool=h(d.Cesium,p.sfmCEnum,p.sfmCesiumUtil,p.SfmCMouseTip,p.SfmCPolyline,p.SfmCPolygon,p.SfmCCircle,p.SfmCHDistance,p.SfmCVDistance,p.SfmCDistance,p.SfmCPolygonArea,p.SfmCHAngle,d)}}(function(s,e,p,t,i,n,r,m,g,v,y,C,o){function w(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}function _(){if(0!=arguments.length){if(1==arguments.length)return arguments[0];for(var e=arguments[0],t=1;t<arguments.length;t++)e=f(e,arguments[t]);return e}}function a(t){if(t.cel){var e=t._els.findIndex(function(e){return e==t.cel});if(0<=e)t._els.splice(e,1)[0].destroy();else t.cel.destroy()}delete t.cel}function l(e){!function(e,t){e.viewer=t.viewer,e._mt=t.mouseTip,e.options={};var i=e._ds=new s.CustomDataSource;e.viewer.dataSources.add(i),e._els=[],e._handler=new s.ScreenSpaceEventHandler(e.viewer.scene.canvas)}(this,e)}var S=s,u=e.measureType,c=(p.fguid,function(e){if(null==e)return e;if("string"==typeof e||"number"==typeof e||"boolean"==typeof e||"function"==typeof e)return e;if(e instanceof Array){for(var t=[],i=0;i<e.length;i++)t.push(c(e[i]));return t}var n={};for(var r in e){var o=e[r];n[r]=c(o)}return n}),f=function(e,t){if(null==e||"object"!=typeof e)return c(t);for(var i in t){var n=t[i],r=e[i],o=typeof n;if("undefined"!=o)if(null==r)e[i]=c(n);else if(null==n)e[i]=null;else if("string"==o||"number"==o||"boolean"==o||"function"==o)e[i]=n;else if(n instanceof Array)for(var s=e[i],a=0;a<n.length;a++)s[a]=f(s[a],n[a]);else"object"==o&&(e[i]=f(e[i],n))}return e},h=function(e,t,i,n,r,o,s){var a=e.cel,l=w(r,"style",void 0),u=w(r,"tip",!1!==e.options.tip);if(a){var c=a.getPositions(),f=c[c.length-1];if(f.x=t.x,f.y=t.y,f.z=t.z,n){i||(c.pop(),a.setPositions(c,!0)),delete e.cel,e.stopMeasure(),e._mt&&e._mt.hide();var h=a.getPositions(),d=void 0;w(r,"toDegree",!1)&&(d=p.cartesianArray3ToDegreeArray(h)),"function"==typeof o&&o({positions:h,degrees:d,distance:a.getDistance()})}else i&&c.push(S.Cartesian3.clone(f)),a.setPositions(c)}else{if(!i)return void(u&&e._mt&&e._mt.show("单击绘制折线，右击结束测量"));(a=e.cel=new m({style:_({},b(),e.options.style,l)})).setPositions([t,S.Cartesian3.clone(t)]),a.add(e._ds.entities),e._els.push(a)}},b=function(){return{}},d=function(e,t,i,n,r,o,s){var a=e.cel,l=w(r,"style",void 0),u=w(r,"tip",!1!==e.options.tip);if(a){var c=a.getPositions(),f=c[c.length-1];if(f.x=t.x,f.y=t.y,f.z=t.z,n){i||c.pop(),a.setPositions(c,!0),delete e.cel,e.stopMeasure(),e._mt&&e._mt.hide();var h=a.getDistance();if(w(r,"toDegree",!1))for(var d=0;d<h.length;d++)h[d].degree=p.cartesian3ToDegree(h[d].position);"function"==typeof o&&o({positions:h})}else i&&c.push(S.Cartesian3.clone(f)),a.setPositions(c)}else{if(!i)return void(u&&e._mt&&e._mt.show("单击拾取点，右击结束测量"));(a=e.cel=new g({style:_({},x(),e.options.style,l)})).setPositions([t,S.Cartesian3.clone(t)]),a.add(e._ds.entities),e._els.push(a)}},x=function(){return{}},E=function(e,t,i,n,r,o,s){var a=e.cel,l=w(r,"style",void 0),u=w(r,"tip",!1!==e.options.tip);if(a){var c=a.getPositions(),f=c[c.length-1];if(f.x=t.x,f.y=t.y,f.z=t.z,n){i||(c.pop(),a.setPositions(c,!0)),delete e.cel,e.stopMeasure(),e._mt&&e._mt.hide();var h=a.getPositions(),d=void 0;w(r,"toDegree",!1)&&(d=p.cartesianArray3ToDegreeArray(h)),"function"==typeof o&&o({positions:h,degrees:d,distance:a.getDistance()})}else i&&c.push(S.Cartesian3.clone(f)),a.setPositions(c)}else{if(!i)return void(u&&e._mt&&e._mt.show("单击绘制折线，右击结束测量"));(a=e.cel=new v({style:_({},M(),e.options.style,l)})).setPositions([t,S.Cartesian3.clone(t)]),a.add(e._ds.entities),e._els.push(a)}},M=function(){return{}},T=function(e,t,i,n,r,o,s){var a=e.cel,l=w(r,"style",void 0),u=w(r,"tip",!1!==e.options.tip);if(a){var c=a.getPositions(),f=c[c.length-1];if(f.x=t.x,f.y=t.y,f.z=t.z,n){i||(c.pop(),a.setPositions(c)),delete e.cel,e.stopMeasure(),e._mt&&e._mt.hide();var h=a.getPositions(),d=void 0;w(r,"toDegree",!1)&&(d=p.cartesianArray3ToDegreeArray(h)),"function"==typeof o&&o({positions:h,degrees:d,area:a.getArea()})}else i&&c.push(S.Cartesian3.clone(f)),a.setPositions(c)}else{if(!i)return void(u&&e._mt&&e._mt.show("单击绘制多边形，右击结束绘制"));(a=e.cel=new y({style:_({},P(),e.options.style,l)})).setPositions([t,S.Cartesian3.clone(t)]),a.add(e._ds.entities),e._els.push(a)}},P=function(){return{}},F=function(e,t,i,n,r,o,s){var a=e.cel,l=w(r,"style",void 0),u=w(r,"tip",!1!==e.options.tip);if(a){var c=a.getPositions(),f=c[c.length-1];if(f.x=t.x,f.y=t.y,f.z=t.z,n){i||c.pop(),a.setPositions(c,!0),delete e.cel,e.stopMeasure(),e._mt&&e._mt.hide();var h=a.getPositions(),d=void 0;w(r,"toDegree",!1)&&(d=p.cartesianArray3ToDegreeArray(h)),"function"==typeof o&&o({positions:h,degrees:d,angle:a.getAngle()})}else i&&c.push(S.Cartesian3.clone(f)),a.setPositions(c)}else{if(!i)return void(u&&e._mt&&e._mt.show("单击拾取点，右击结束测量"));(a=e.cel=new C({style:_({},A(),e.options.style,l)})).setPositions([t,S.Cartesian3.clone(t)]),a.add(e._ds.entities),e._els.push(a)}},A=function(){return{}},I=function(e,t){return t.scene.pickPosition(e)};return l.prototype.destroy=function(){!function(e){e.stopMeasure(),e._handler&&e._handler.destroy(),delete e._handler,e.clear(),e._ds&&e.viewer.dataSources.remove(e._ds,!0),delete e._ds,delete e.viewer}(this)},l.prototype.setOptions=function(e){this.options=e||{}},l.prototype.clear=function(){var e=this;for(e._mt&&e._mt.hide(),a(e);0<e._els.length;){e._els.pop().destroy()}e._ds&&e._ds.entities.removeAll()},l.prototype.clearLast=function(){0<this._els.length&&this._els.pop().destroy()},l.prototype.measure=function(e,t,i){!function(e){for(var t in u)if(u[t]===e)return!0;return!1}(e)||(a(this),function(i,n,r,o){var e=i._handler;e&&(e.setInputAction(function(e){var t=I(e.position,i.viewer);t&&(n==u.HDISTANCE?h(i,t,!0,!1,o,r):n==u.VDISTANCE?d(i,t,!0,!1,o,r):n==u.DISTANCE?E(i,t,!0,!1,o,r):n==u.AREA?T(i,t,!0,!1,o,r):n==u.HANGLE&&F(i,t,!0,!1,o,r))},s.ScreenSpaceEventType.LEFT_CLICK),e.setInputAction(function(e){var t=I(e.endPosition,i.viewer);t&&(n==u.HDISTANCE?h(i,t,!1,!1,o,r):n==u.VDISTANCE?d(i,t,!1,!1,o,r):n==u.DISTANCE?E(i,t,!1,!1,o,r):n==u.AREA?T(i,t,!1,!1,o,r):n==u.HANGLE&&F(i,t,!1,!1,o,r))},s.ScreenSpaceEventType.MOUSE_MOVE),e.setInputAction(function(e){var t=I(e.position,i.viewer);t&&(n==u.HDISTANCE?h(i,t,!1,!0,o,r):n==u.VDISTANCE?d(i,t,!1,!0,o,r):n==u.DISTANCE?E(i,t,!1,!0,o,r):n==u.AREA?T(i,t,!1,!0,o,r):n==u.HANGLE&&F(i,t,!1,!0,o,r))},s.ScreenSpaceEventType.RIGHT_CLICK))}(this,e,t,i))},l.prototype.stopMeasure=function(){var e=this;e._mt&&e._mt.hide(),e._handler&&(e._handler.removeInputAction(s.ScreenSpaceEventType.LEFT_CLICK),e._handler.removeInputAction(s.ScreenSpaceEventType.MOUSE_MOVE),e._handler.removeInputAction(s.ScreenSpaceEventType.RIGHT_CLICK)),a(e)},l},this),function(r,o){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil"),n=require("SfmCViewShed");module.exports=r(e,t,i,n,o)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil","SfmCViewShed"],function(e,t,i,n){return r(e,t,i,n,o)});else{null==o.SFM&&(o.SFM={}),o.SFM||(o.SFM={});var s=o.SFM.cesiumlib||(o.SFM.cesiumlib={});o.SFM.cesiumlib.ZlskCViewShedTool=r(o.Cesium,s.sfmCEnum,s.sfmCesiumUtil,s.SfmCViewShed,o)}}(function(a,e,s,l,t){function u(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}function c(e){e._handler&&(e._handler.removeInputAction(a.ScreenSpaceEventType.LEFT_CLICK),e._handler.removeInputAction(a.ScreenSpaceEventType.MOUSE_MOVE)),e._cel&&(function(e,t,i){if(!e)return;for(var n=[],r=0;r<e.length;r++)e[r][t]==i&&n.push(e.splice(r--,1)[0])}(e._els,"el",e._cel),e.viewer.scene.primitives.remove(e._cel)),delete e._cel}function i(e,t,i,n){if(!(o.indexOf(t)<0))if(n)for(var r=0;r<e._els.length;r++)e._els[r].el[t]=i;else 0<e._els.length&&(e._els[e._els.length-1].el[t]=i)}function n(e){!function(e,t){e.viewer=t.viewer,e._els=[]}(this,e)}var f=[0,255,0,.8],h=[255,0,0,.8],d=new a.Cartographic,p=new a.Cartographic,r=function(e){for(var t=e.viewer.scene.primitives;0<e._els.length;){var i=e._els.pop();t.remove(i.el)}},o=["visibleAreaColor","hiddenAreaColor","viewerPosition","distance","direction","pitch","horizontalFov","verticalFov"],m=function(e,t,i){if(e){var n=a.Cartesian3.distance(t,i),r=a.Cartographic.fromCartesian(t,void 0,d),o=a.Cartographic.fromCartesian(i,void 0,p),s=g(r,o);e.distance=n,e.direction=s}},g=function(e,t){var i=e.longitude,n=e.latitude,r=t.longitude,o=t.latitude,s=Math.sin(r-i)*Math.cos(o),a=Math.cos(n)*Math.sin(o)-Math.sin(n)*Math.cos(o)*Math.cos(r-i),l=Math.atan2(s,a);return(l=180*l/Math.PI)<-180&&(l+=360),l};return n.prototype.destroy=function(){!function(e){e._handler&&e._handler.destroy(),delete e._handler,r(e),delete e._els,delete e.viewer}(this)},n.prototype.clear=function(){c(this),r(this)},n.prototype.beginDraw=function(e){!function(n,r){c(n);var o=n.viewer.scene;n._handler||(n._handler=new a.ScreenSpaceEventHandler(o.canvas)),n._handler.setInputAction(function(e){var t=o.pickPosition(e.position);if(t)if(n._cel)m(n._cel,n._cel.viewerPosition,t),n._els.push({el:n._cel}),n._cel=null,c(n);else{var i=a.Cartographic.fromCartesian(t,void 0,d);i.height+=u(r,"viewpointHeight",2),t=a.Cartesian3.fromRadians(i.longitude,i.latitude,i.height,void 0,t),n._cel=new l({scene:o,cameraOptions:{viewerPosition:t,distance:1e-6,visibleAreaColor:u(r,"visibleAreaColor",s.toColor(f)),hiddenAreaColor:u(r,"hiddenAreaColor",s.toColor(h))}}),o.primitives.add(n._cel),o.requestRender()}},a.ScreenSpaceEventType.LEFT_CLICK),n._handler.setInputAction(function(e){if(n._cel){var t=o.pickPosition(e.endPosition);t&&m(n._cel,n._cel.viewerPosition,t)}},a.ScreenSpaceEventType.MOUSE_MOVE)}(this,e)},n.prototype.quitDraw=function(){c(this)},n.prototype.updateVisibleAreaColor=function(e,t){i(this,"visibleAreaColor",e,t)},n.prototype.updateHiddenAreaColor=function(e,t){i(this,"hiddenAreaColor",e,t)},n.prototype.updateDistance=function(e,t){i(this,"distance",e,t)},n.prototype.updateDirection=function(e,t){i(this,"direction",e,t)},n.prototype.updatePitch=function(e,t){i(this,"pitch",e,t)},n.prototype.updateHorizontalFov=function(e,t){i(this,"horizontalFov",e,t)},n.prototype.updateVerticalFov=function(e,t){i(this,"verticalFov",e,t)},n},this),function(o,s){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil"),n=require("sfmCEntityManager"),r=require("ZlskCViewShedTool");module.exports=o(e,t,i,n,r,s)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil","sfmCEntityManager","ZlskCViewShedTool"],function(e,t,i,n,r){return o(e,t,i,n,r,s)});else{null==s.SFM&&(s.SFM={}),s.SFM||(s.SFM={});var a=s.SFM.cesiumlib||(s.SFM.cesiumlib={});s.SFM.cesiumlib.SfmCAnalysisTool=o(s.Cesium,a.sfmCEnum,a.sfmCesiumUtil,a.SfmCEntityManager,a.ZlskCViewShedTool,s)}}(function(S,e,w,t,i,n){function _(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}function o(e){this.options=e,this.viewer=e.viewer,this.data={},this._ds=new S.CustomDataSource,this.viewer.dataSources.add(this._ds)}w.fguid;o.prototype.destroy=function(){var e=this;e.clear(),delete e.fdt,delete e.oriCps,e._ds&&e.viewer.dataSources.remove(e._ds,!0),delete e._ds,delete e.data,delete e.viewer,delete e.options},o.prototype.clear=function(){var e=this;e.entityDMBJ&&(e._ds.entities.remove(e.entityDMBJ),delete e.entityDMBJ),e.entityDM&&(e._ds.entities.remove(e.entityDM),delete e.entityDM),delete e.polygonPositions,delete e.balt,e.viewer.scene.globe.depthTestAgainstTerrain=e.fdt,e.viewer.scene.globe.clippingPlanes=e.oriCps},o.prototype.clipTerrain=function(e,t,i,n){if(e&&0!=e.length){var r=this;r.data.positions=e,r.data.bottomAlt=t,r.data.depth=i,r.data.minAlt=n,r.fdt=r.viewer.scene.globe.depthTestAgainstTerrain,r.oriCps=r.viewer.scene.globe.clippingPlanes;var o=[],s=e.length,a=new S.Cartesian3,l=S.Cartesian3.subtract(e[0],e[1],a);l=0<l.x;for(var u=0;u<s;++u){var c,f=(u+1)%s,h=S.Cartesian3.midpoint(e[u],e[f],new S.Cartesian3),d=S.Cartesian3.normalize(h,new S.Cartesian3);c=l?S.Cartesian3.subtract(e[u],h,new S.Cartesian3):S.Cartesian3.subtract(e[f],h,new S.Cartesian3),c=S.Cartesian3.normalize(c,c);var p=S.Cartesian3.cross(c,d,new S.Cartesian3);p=S.Cartesian3.normalize(p,p);var m=new S.Plane(p,0),g=S.Plane.getPointDistance(m,h);o.push(new S.ClippingPlane(p,g))}r.viewer.scene.globe.clippingPlanes=new S.ClippingPlaneCollection({planes:o,edgeWidth:_(r.options,"edgeWidth",1),edgeColor:w.toColor(_(r.options,"edgeColor",[255,255,255,255])),enabled:!0});var v=E(e),y=E([e[0],e[e.length-1]]),C=v.concat(y).concat(v[0]);b(r,C,t)}};var b=function(e,t,i){if(t&&!(t.length<1)){var n=e,r=[];n.polygonPositions=[],n.balt=[];for(var o=0;o<t.length;++o){var s=S.Cartographic.fromCartesian(t[o]),a=n.viewer.scene.globe.getHeight(s);r.push(a),n.balt.push(i),n.polygonPositions.push(S.Cartesian3.fromRadians(s.longitude,s.latitude,i))}n.entityDMBJ=n._ds.entities.add({wall:{positions:t,maximumHeights:r,minimumHeights:new S.CallbackProperty(function(){return n.balt},!1),material:_(n.options,"sideMaterial",w.toColor([255,255,255,255]))}}),n.entityDM=n._ds.entities.add({polygon:{hierarchy:new S.CallbackProperty(function(){return{positions:n.polygonPositions}},!1),perPositionHeight:!0,material:_(n.options,"bottomMaterial",w.toColor([255,255,255,255]))}})}};o.prototype.updateBottomAlt=function(e){var t=this,i=[],n=[];t.data.bottomAlt=e,t.data.minAlt&&(t.dat.depth=t.data.minAlt-e);for(var r=0;r<t.polygonPositions.length;r++){var o=S.Cartographic.fromCartesian(t.polygonPositions[r]),s=S.Cartesian3.fromRadians(o.longitude,o.latitude,e);i.push(s),n.push(e)}t.polygonPositions=i,t.balt=n},o.prototype.updateDepth=function(e){var t=this;if(null==t.data.minAlt){var i=l(t.viewer,t.data.positions);t.data.minAlt=i.minHeight}t.data.depth=e,t.data.bottomAlt=t.data.minAlt-e;for(var n=[],r=[],o=0;o<t.polygonPositions.length;o++){var s=S.Cartographic.fromCartesian(t.polygonPositions[o]),a=S.Cartesian3.fromRadians(s.longitude,s.latitude,t.data.bottomAlt);n.push(a),r.push(t.data.bottomAlt)}t.polygonPositions=n,t.balt=r};var l=function(e,t,i,n){if(!t)return null;i=i||1e3;for(var r=[],o=0;o<t.length;o++)r.push(t[o].clone());var s=new S.PolygonGeometry.fromPositions({positions:r,vertexFormat:S.PerInstanceColorAppearance.FLAT_VERTEX_FORMAT,granularity:Math.PI/Math.pow(2,11)/i}),a=new S.PolygonGeometry.createGeometry(s),l=a.indices,u=a.attributes.position,c={uniformArr:[]};c.minHeight=Number.MAX_VALUE,c.maxHeight=Number.MIN_VALUE;for(var f=0;f<l.length;f+=3){var h={},d=l[f],p=l[f+1],m=l[f+2],g=new S.Cartesian3(u.values[3*d],a.attributes.position.values[3*d+1],u.values[3*d+2]),v=e.scene.globe.getHeight(S.Cartographic.fromCartesian(g)),y=new S.Cartesian3(u.values[3*p],a.attributes.position.values[3*p+1],u.values[3*p+2]),C=e.scene.globe.getHeight(S.Cartographic.fromCartesian(y)),w=new S.Cartesian3(a.attributes.position.values[3*m],a.attributes.position.values[3*m+1],u.values[3*m+2]),_=e.scene.globe.getHeight(S.Cartographic.fromCartesian(w));h.height=(v+C+_)/3,c.minHeight>h.height&&(c.minHeight=h.height),c.maxHeight<h.height&&(c.maxHeight=h.height),n&&(h.area=x(g,y,w)),c.uniformArr.push(h)}return c};function s(e,t){if(!e)return 0;var i=e.uniformArr;if(!i||0==i.length)return 0;null==t&&(t=0);for(var n=0,r=0;r<i.length;r++){var o=i[r];o.height>t&&(n+=o.area*(o.height-t))}return n}function a(e,t){if(!e)return 0;var i=e.uniformArr;if(!i||0==i.length)return 0;null==t&&(t=0);for(var n=0,r=0;r<i.length;r++){var o=i[r];t>o.height&&(n+=o.area*(t-o.height))}return n}function r(e){!function(e,t){e.viewer=t.viewer}(this,e)}var x=function(e,t,i){if(!e||!t||!i)return 0;var n=S.Cartesian3.distance(e,t),r=S.Cartesian3.distance(t,i),o=S.Cartesian3.distance(i,e),s=(n+r+o)/2;return Math.sqrt(s*(s-n)*(s-r)*(s-o))},E=function(e){if(e&&0!=e.length){var t=S.PolylinePipeline.generateArc({positions:e,granularity:1e-5});if(t){for(var i=[],n=0;n<t.length;n+=3){var r=S.Cartesian3.unpack(t,n);i.push(r)}return i}}};return r.prototype.destroy=function(){!function(e){delete e.viewer}(this)},r.prototype.calcPolygonHeightRange=function(e){return l(this.viewer,e)},r.prototype.clipTerrain=function(e,t,i){if(e&&!(e.length<3)){var n=l(this.viewer,e);(i=i||{}).viewer=this.viewer;var r=new o(i);return r.clipTerrain(e,n.minHeight-t,t,n.minHeight),r}},r.prototype.clipTerrainTo=function(e,t,i){if(e&&!(e.length<3)){(i=i||{}).viewer=this.viewer;var n=new o(i);return n.clipTerrain(e,t),n}},r.prototype.calcDigFillVolume=function(e,t){var i={dig:0,fill:0};if(!e||0==e.length)return i;var n=l(this.viewer,e,void 0,!0);return n&&0!=n.length&&(i.dig=s(n,t),i.fill=a(n,t)),i},r.prototype.calcDigFillVolumeByDepth=function(e,t){var i={dig:0,fill:0};if(!e||0==e.length)return i;var n=l(this.viewer,e,void 0,!0);if(!n||0==n.length)return i;var r=n.minHeight-t;return i.dig=s(n,r),i.fill=a(n,r),i},r},this),function(n,r){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil");module.exports=n(e,t,i,r)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil"],function(e,t,i){return n(e,t,i,r)});else{null==r.SFM&&(r.SFM={}),r.SFM||(r.SFM={});var o=r.SFM.cesiumlib||(r.SFM.cesiumlib={});r.SFM.cesiumlib.SfmCPolylineWrapper=n(r.Cesium,o.sfmCEnum,o.sfmCesiumUtil,r)}}(function(h,e,d,t){function p(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}var m=function(e,t){var i=p(t,"positions",null);if(!i){var n=p(t,"coors",null);if(!n||n.length<2)return null;i=h.Cartesian3.fromDegreesArrayHeights(n)}if(!i||i.length<2)return null;var r=new h.PolylineVolumeGeometry({polylinePositions:i,shapePositions:o(t),cornerType:p(t,"cornerType",h.CornerType.ROUNDED)});return new h.GeometryInstance({geometry:r})},o=function(e){var t=p(e,"shape",null);if("function"==typeof t)return t();if(t instanceof Array)return t;var i=p(e,"width",0),n=p(e,"height",0);if(0<i&&0<n)return[new h.Cartesian2(i/2,n/2),new h.Cartesian2(-i/2,n/2),new h.Cartesian2(-i/2,-n/2),new h.Cartesian2(i/2,-n/2)];var r=p(e,"radius",1);return r<=0&&(r=1),function(e,t){var i=[];t<3&&(t=12);for(var n=0,r=2*Math.PI/t;n<2*Math.PI;n+=r)i.push(new h.Cartesian2(e*Math.cos(n),e*Math.sin(n)));return i}(r,p(e,"seg",12))};function i(e){!function(e,t){e.viewer=t.viewer,e.els=[]}(this,e)}return i.prototype.destroy=function(){this.clear(),delete this.els,delete this.viewer},i.prototype.add=function(e){return function(e,t){var i=p(t,"polylines",null);if(i&&0!=i.length){for(var n=[],r=0;r<i.length;r++){var o=i[r],s=m(e,o);s&&n.push(s)}var a={geometryInstances:n,appearance:new h.MaterialAppearance({material:h.Material.fromType(h.Material.ZlskFlowMaterialType)}),allowPicking:!1},l=null;(l=new h.Primitive(a)).appearance.material.uniforms.color=d.toColor(p(t,"color",[255,255,255,255]));var u=null,c=p(t,"duration",3e3);if(0<c){var f=(new Date).getTime();u=function(){l.appearance.material.uniforms.time=((new Date).getTime()-f)%c/c},e.viewer.scene.preUpdate.addEventListener(u)}e.viewer.scene.primitives.add(l),e.els.push({primitive:l,eh:u})}}(this,e)},i.prototype.clear=function(){return function(e){for(;0<e.els.length;){var t=e.els.pop();t.eh&&e.viewer.scene.preUpdate.removeEventListener(t.eh),e.viewer.scene.primitives.remove(t.primitive),t.primitive.destroy()}}(this)},i},this),function(n,r){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil");module.exports=n(e,t,i,r)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil"],function(e,t,i){return n(e,t,i,r)});else{null==r.SFM&&(r.SFM={}),r.SFM||(r.SFM={});var o=r.SFM.cesiumlib||(r.SFM.cesiumlib={});r.SFM.cesiumlib.SfmCFlowPolyline=n(r.Cesium,o.sfmCEnum,o.sfmCesiumUtil,r)}}(function(a,e,l,t){function u(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}function i(e){!function(e,t){e.viewer=t.viewer;var i=e._ds=new a.CustomDataSource;e.viewer.dataSources.add(i)}(this,e)}return i.prototype.destroy=function(){this.clear(),this._ds&&this.viewer.dataSources.remove(this._ds,!0),delete this._ds,delete this.viewer},i.prototype.add=function(e){return function(e,t){var i=u(t,"polylines",null);if(i&&0!=i.length){var n=e._ds.entities;n.suspendEvents();for(var r=0;r<i.length;r++){var o=i[r],s=1;0<o.radius?s=2*o.radius:0<o.width&&(s=o.width),s=5,n.add({polyline:{positions:u(o,"positions",null),material:new a.ZlskFlowMaterialProperty({duration:u(t,"duration",3e3),repeat:u(t,"repeat",new a.Cartesian2(1,1)),color:l.toColor(u(t,"color",[255,255,255,255]))}),clampToGround:u(t,"clampToGround",!0),width:s}})}n.resumeEvents()}}(this,e)},i.prototype.clear=function(){return function(e){e._ds&&e._ds.entities.removeAll()}(this)},i},this),function(o,s){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil"),n=require("sfmCPolylineWrapper"),r=require("sfmCFlowPolyline");module.exports=o(e,t,i,n,r,s)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil","sfmCPolylineWrapper","sfmCFlowPolyline"],function(e,t,i,n,r){return o(e,t,i,n,r,s)});else{null==s.SFM&&(s.SFM={}),s.SFM||(s.SFM={});var a=s.SFM.cesiumlib||(s.SFM.cesiumlib={});s.SFM.cesiumlib.SfmCPipeWrapper=o(s.Cesium,a.sfmCEnum,a.sfmCesiumUtil,a.SfmCPolylineWrapper,a.SfmCFlowPolyline,s)}}(function(h,e,t,i,n,r){function d(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}function o(e){!function(e,t){e.viewer=t.viewer,e.pwrapper=new i({viewer:e.viewer}),e.fpolyline=new n({viewer:e.viewer})}(this,e)}var a=function(e){var t=d(e,"coors",null);if(t&&!(t.length<2)){var i=e.size;if(i){var n=null,r=null,o=null;0<(i=i.toString()).indexOf("X")?o=i.split("X"):0<i.indexOf("x")?o=i.split("x"):r=Number(i)/1e3,o&&1<o.length&&(n=Number(o[0])/1e3,r=Number(o[1])/1e3);var s=d(e,"salt",0),a=d(e,"ealt",0),l=r/2;if(!d(e,"centerAlt",!1)){var u=d(e,"code",0);4e3<=u&&u<5e3?(s+=l,a+=l):(s-=l,a-=l)}var c=0==d(e,"dir",0)?[t[0],t[1],s,t[2],t[3],a]:[t[2],t[3],a,t[0],t[1],s],f={positions:h.Cartesian3.fromDegreesArrayHeights(c)};return null!=n?(f.width=n,f.height=r):f.radius=l,f}}};return o.prototype.destroy=function(){this.fpolyline.destroy(),this.pwrapper.destroy(),delete this.fpolyline,delete this.pwrapper,delete this.viewer},o.prototype.add=function(e){return function(e,t){var i=d(t,"pipes",null);if(i&&0!=i.length){for(var n=[],r=0;r<i.length;r++){var o=a(i[r]);o&&n.push(o)}var s={polylines:n,clampToGround:d(t,"clampToGround",!0),classification:d(t,"classification",!0),color:t.color};d(t,"rtype","polyline")?e.fpolyline.add(s):e.pwrapper.add(s)}}(this,e)},o.prototype.clear=function(){this.fpolyline&&this.fpolyline.clear(),this.pwrapper&&this.pwrapper.clear()},o},this),function(n,r){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil");module.exports=n(e,t,i,r)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil"],function(e,t,i){return n(e,t,i,r)});else{null==r.SFM&&(r.SFM={}),r.SFM||(r.SFM={});var o=r.SFM.cesiumlib||(r.SFM.cesiumlib={});r.SFM.cesiumlib.SfmCPrimitiveFactory=n(r.Cesium,o.sfmCEnum,o.sfmCesiumUtil,r)}}(function(c,e,f,t){function h(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}function i(e){var t=h(e,"polylines",null);if(!t||0==t.length)return null;for(var i=[],n=[],r=0;r<t.length;r++){var o=t[r],s=d(o);s&&(i.push(s),n.push(s.id))}var a,l=h(e,"color",[255,255,255,255]);a=c.Material.fromType(c.Material.ColorType,{color:f.toColor(l)});var u={geometryInstances:i,appearance:new c.MaterialAppearance({material:a}),releaseGeometryInstances:h(e,"releaseGeometryInstances",!0),allowPicking:h(e,"pickable",!0)};return{primitive:h(e,"classification",!1)?(u.classificationType=h(e,"classificationType",c.ClassificationType.BOTH),new c.ClassificationPrimitive(u)):new c.Primitive(u),ids:n}}function n(e){!function(e,t){e.viewer=t.viewer}(this,e)}var d=function(e){var t=h(e,"positions",null);if(!t){var i=h(e,"coors",null);if(!i||i.length<2)return null;t=c.Cartesian3.fromDegreesArrayHeights(i)}if(!t||t.length<2)return null;var n=new c.PolylineVolumeGeometry({polylinePositions:t,shapePositions:r(e),cornerType:h(e,"cornerType",c.CornerType.ROUNDED)});return new c.GeometryInstance({id:e.id||"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".replace(/x/g,function(e){return(16*Math.random()|0).toString(16)}),geometry:n})},r=function(e){var t=h(e,"shape",null);if("function"==typeof t)return t();if(t instanceof Array)return t;var i=h(e,"width",0),n=h(e,"height",0);if(0<i&&0<n)return[new c.Cartesian2(i/2,n/2),new c.Cartesian2(-i/2,n/2),new c.Cartesian2(-i/2,-n/2),new c.Cartesian2(i/2,-n/2)];var r=h(e,"radius",1);return r<=0&&(r=1),o(r,h(e,"seg",60))},o=function(e,t){var i=[];t<3&&(t=12);for(var n=0,r=2*Math.PI/t;n<2*Math.PI;n+=r)i.push(new c.Cartesian2(e*Math.cos(n),e*Math.sin(n)));return i},u=function(e){var t=h(e,"center",null),i=h(e,"radius",1),n=new c.CircleGeometry({center:t,radius:i,height:h(e,"bottom",0),extrudedHeight:h(e,"top",0)});return new c.GeometryInstance({id:e.id,geometry:n})};return n.prototype.destroy=function(){delete this.viewer},n.prototype.createPolylineVolume=function(e){return i(e)},n.createPolylineVolume=function(e){return i(e)},n.createCircle=function(e){return function(e){var t=h(e,"circles",null);if(!t||0==t.length)return null;for(var i=[],n=[],r=0;r<t.length;r++){var o=u(t[r]);o&&(i.push(o),n.push(o.id))}var s=null;if(e.image)s=c.Material.fromType(c.Material.ImageType,{image:e.image,repeat:e.repeat});else{var a=h(e,"color",[255,255,255,255]);s=c.Material.fromType(c.Material.ColorType,{color:f.toColor(a)})}var l={geometryInstances:i,appearance:new c.MaterialAppearance({material:s}),releaseGeometryInstances:h(e,"releaseGeometryInstances",!0),allowPicking:h(e,"pickable",!0)};return{primitive:h(e,"classification",!1)?(l.classificationType=h(e,"classificationType",c.ClassificationType.BOTH),new c.ClassificationPrimitive(l)):new c.Primitive(l),ids:n}}(e)},n},this),function(r,o){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil"),n=require("sfmCPrimitiveFactory");module.exports=r(e,t,i,n,o)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil","sfmCPrimitiveFactory"],function(e,t,i,n){return r(e,t,i,n,o)});else{null==o.SFM&&(o.SFM={}),o.SFM||(o.SFM={});var s=o.SFM.cesiumlib||(o.SFM.cesiumlib={});o.SFM.cesiumlib.SfmCPipeGenerater=r(o.Cesium,s.sfmCEnum,s.sfmCesiumUtil,s.SfmCPrimitiveFactory,o)}}(function(h,e,t,l,i){function d(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}function u(e,t){e.viewer.scene.primitives.add(t.primitive);var i="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".replace(/x/g,function(e){return(16*Math.random()|0).toString(16)});return e.els.push({id:i,primitive:t}),i}function n(e){!function(e,t){e.viewer=t.viewer,e.els=[]}(this,e)}var a=function(e){var t=d(e,"coors",null);if(t&&!(t.length<2)){var i=e.size;if(i){var n=null,r=null,o=null;0<(i=i.toString()).indexOf("X")?o=i.split("X"):0<i.indexOf("x")?o=i.split("x"):r=Number(i)/1e3,o&&1<o.length&&(n=Number(o[0])/1e3,r=Number(o[1])/1e3);var s=r/2,a=0,l=[];if(!d(e,"centerAlt",!1)){var u=d(e,"code",0);a=4e3<=u&&u<5e3?s:-s}if(1==d(e,"dir",0))for(var c=t.length-1;0<=c;c--)l.push(t[c][0],t[c][1],t[c][2]+a);else for(c=0;c<t.length;c++)l.push(t[c][0],t[c][1],t[c][2]+a);var f={positions:h.Cartesian3.fromDegreesArrayHeights(l)};return null!=n?(f.width=n,f.height=r):f.radius=s,f}}},c=function(e){var t=h.Cartographic.fromCartesian(e.center);if(!t)return null;var i=t.height,n=i-d(e,"depth",1);return{center:e.center,radius:e.radius/2e3,top:i,bottom:n}};return n.prototype.destroy=function(){this.clear(),delete this.els,delete this.viewer},n.prototype.add=function(e){},n.prototype.clear=function(){return function(e){for(;0<e.els.length;){var t=e.els.pop();t.eh&&e.viewer.scene.preUpdate.removeEventListener(t.eh),e.viewer.scene.primitives.remove(t.primitive),t.primitive.destroy()}}(this)},n.prototype.removeById=function(e){!function(e,t){if(e.els)for(var i=e.viewer.scene.primitives,n=0;n<e.els.length;n++){var r=e.els[n];r.id==t&&(i.remove(r.primitive),r.primitive.destroy(),e.els.splice(n--,1))}}(this,e)},n.prototype.addPipeline=function(e){return function(e,t){var i=d(t,"pipes",null);if(i&&0!=i.length){for(var n=[],r=0;r<i.length;r++){(s=a(i[r]))&&n.push(s)}var o={polylines:n,classification:d(t,"classification",!1),releaseGeometryInstances:t.releaseGeometryInstances,color:t.color},s=l.createPolylineVolume(o);return u(e,s)}}(this,e)},n.prototype.addWell=function(e){return function(e,t){var i=d(t,"wells",null);if(i&&0!=i.length){for(var n=[],r=0;r<i.length;r++){var o=c(i[r]);o&&n.push(o)}var s={circles:n,classification:d(t,"classification",!1),releaseGeometryInstances:t.releaseGeometryInstances,image:t.image,repeat:t.repeat,color:t.color},a=l.createCircle(s);return u(e,a)}}(this,e)},n},this),function(n,r){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil");module.exports=n(e,t,i,r)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil"],function(e,t,i){return n(e,t,i,r)});else{null==r.SFM&&(r.SFM={}),r.SFM||(r.SFM={});var o=r.SFM.cesiumlib||(r.SFM.cesiumlib={});r.SFM.cesiumlib.ZlskCTilesetEditor=n(r.Cesium,o.sfmCEnum,o.sfmCesiumUtil,r)}}(function(g,e,t,i){function o(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}function n(e,t){this.viewer=e,this.options=t,this.center=null,this.tileset=t.tileset,this.center=null,this.boundingSphere=null,this.tileset?(this.boundingSphere=this.tileset.boundingSphere,this.center=this.boundingSphere.center,this.movePoint=null,this.drawPoint=null,this.initAngle=null,this.tilesetZ=null,this.drawHandler=null,this.bindDrawHandler(),this.createtilesetPoint(),this.moveCallback=t.moveCallback,this.scale=1,this.currx=0,this.curry=0,this.currz=0,this.cbPoseChange=t.onPoseChange):console.warn("请添加模型！")}n.prototype={setHeight:function(e){e&&this.updateTilesetPosition({z:Number(e)})},setPosition:function(e,t,i){this.updateTilesetPosition({x:e,y:t,z:i})},setRoate:function(){},getTilesetZ:function(){var e=null,t=this.tileset.boundingSphere.center;return t&&(e=v(this.viewer,t)[2]),e},scaleModel:function(e){if(e){this.scale=e;var t=g.Transforms.eastNorthUpToFixedFrame(this.center);g.Matrix4.multiplyByUniformScale(t,this.scale,t),this.tileset._root.transform=t}},updateTilesetPosition:function(e){var t,i,n,r=null==e.rotateX?this.currx:e.rotateX,o=null==e.rotateY?this.curry:e.rotateY,s=null==e.rotateZ?this.currz:e.rotateZ;null!=e.scale&&(this.scale=e.scale);var a=v(this.viewer,this.center),l=null==e.x?a[0]:e.x,u=null==e.y?a[1]:e.y,c=null==e.z?a[2]:e.z,f=g.Cartesian3.fromDegrees(l,u,c),h=g.Transforms.eastNorthUpToFixedFrame(f);if(g.Matrix4.multiplyByUniformScale(h,this.scale,h),r){var d=g.Matrix3.fromRotationX(g.Math.toRadians(r));t=g.Matrix4.fromRotationTranslation(d),g.Matrix4.multiply(h,t,h)}if(o){var p=g.Matrix3.fromRotationY(g.Math.toRadians(o));i=g.Matrix4.fromRotationTranslation(p),g.Matrix4.multiply(h,i,h)}if(s){var m=g.Matrix3.fromRotationZ(g.Math.toRadians(s));n=g.Matrix4.fromRotationTranslation(m),g.Matrix4.multiply(h,n,h)}this.tileset._root.transform=h,this.currx=r,this.curry=o,this.currz=s,"function"==typeof this.cbPoseChange&&this.cbPoseChange({x:l,y:u,z:c,rx:this.currx,ry:this.curry,rz:this.currz,scale:this.scale})},remove:function(){this.viewer.scene.primitives.remove(this.tileset),this.tileset=null},getPosition:function(){var e=this.tileset.boundingSphere.center;return v(this.viewer,e)},createtilesetPoint:function(){this.movePoint=this.viewer.entities.add({position:this.center,billboard:{scale:1,image:o(this.options,"moveImg","../../../../../images/modules/tilesetedit/move.png"),verticalOrigin:g.VerticalOrigin.BOTTOM,heightReference:g.HeightReference.CLAMP_TO_GROUND,color:g.Color.YELLOW},show:!1});var e=v(this.viewer,this.center),t=turf.point([e[0],e[1]]),i=this.tileset.boundingSphere.radius/2e3,n=turf.destination(t,i,90).geometry.coordinates,r=g.Cartesian3.fromDegrees(n[0],n[1],e[2]);this.drawPoint=this.viewer.entities.add({position:r,billboard:{scale:1,image:o(this.options,"rotateImg","../../../../../images/modules/tilesetedit/rotate.png"),verticalOrigin:g.VerticalOrigin.BOTTOM,heightReference:g.HeightReference.CLAMP_TO_GROUND,color:g.Color.RED},show:!1}),this.initAngle=this.getAngle(this.center,r)},setCtrlPoint:function(){var e=this.center=this.tileset.boundingSphere.center;this.movePoint.position.setValue(e);var t=v(this.viewer,e),i=turf.point([t[0],t[1]]),n=this.tileset.boundingSphere.radius/2e3,r=turf.destination(i,n,90).geometry.coordinates,o=g.Cartesian3.fromDegrees(r[0],r[1],t[2]);this.drawPoint.position.setValue(o)},showEditPoint:function(e){this.drawPoint&&(this.drawPoint.show=e),this.movePoint&&(this.movePoint.show=e)},bindDrawHandler:function(){this.drawHandler=new g.ScreenSpaceEventHandler(this.viewer.scene.canvas);var s=this,a=!1;this.drawHandler.setInputAction(function(e){var t=s.viewer.scene.pick(e.position);g.defined(t)&&t.id&&(t.id!=s.movePoint&&t.id!=s.drawPoint||(s.pickPoint=t.id,a=!0,s.forbidDrawWorld(!0),s.tilesetZ=s.getTilesetZ()))},g.ScreenSpaceEventType.LEFT_DOWN),this.drawHandler.setInputAction(function(e){if(a){var t=s.viewer.camera.getPickRay(e.endPosition);if(t){var i=s.viewer.scene.globe.pick(t,s.viewer.scene);if(i)if(s.pickPoint.position.setValue(i),s.pickPoint==s.movePoint){var n=v(s.viewer,i);if(s.updateTilesetPosition({x:n[0],y:n[1],z:s.tilesetZ}),this.moveCallback){var r={};r.x=n[0],r.y=n[1],r.z=s.tilesetZ,this.moveCallback(r)}}else{var o=s.getAngle(s.tileset.boundingSphere.center,i);s.updateTilesetPosition({rotateZ:-(o-s.initAngle)})}}}},g.ScreenSpaceEventType.MOUSE_MOVE),this.drawHandler.setInputAction(function(e){if(a){var t=s.viewer.camera.getPickRay(e.position);if(t){var i=s.viewer.scene.globe.pick(t,s.viewer.scene);if(i){if(s.pickPoint.position.setValue(i),a=!1,s.pickPoint==s.movePoint){var n=v(s.viewer,i);if(s.updateTilesetPosition({x:n[0],y:n[1],z:s.tilesetZ}),s.moveCallback){var r={};r.x=n[0],r.y=n[1],r.z=s.tilesetZ,s.moveCallback(r)}}else{var o=s.getAngle(s.tileset.boundingSphere.center,i);if(!o)return;s.updateTilesetPosition({rotateZ:-(o-s.initAngle)})}s.forbidDrawWorld(!1)}}}},g.ScreenSpaceEventType.LEFT_UP)},forbidDrawWorld:function(e){this.viewer.scene.screenSpaceCameraController.enableRotate=!e,this.viewer.scene.screenSpaceCameraController.enableTilt=!e,this.viewer.scene.screenSpaceCameraController.enableTranslate=!e,this.viewer.scene.screenSpaceCameraController.enableInputs=!e},getAngle:function(e,t){var i=v(this.viewer,e),n=v(this.viewer,t),r=turf.point([i[0],i[1]]),o=turf.point([n[0],n[1]]);return turf.bearing(r,o)}};var v=function(e,t){if(t){var i=e.scene.globe.ellipsoid.cartesianToCartographic(t);return[g.Math.toDegrees(i.longitude),g.Math.toDegrees(i.latitude),i.height]}};return n},this),function(r,o){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil"),n=require("sfmCEntityManager");module.exports=r(e,t,i,n,o)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil","sfmCEntityManager"],function(e,t,i,n){return r(e,t,i,n,o)});else{null==o.SFM&&(o.SFM={}),o.SFM||(o.SFM={});var s=o.SFM.cesiumlib||(o.SFM.cesiumlib={});o.SFM.cesiumlib.ZlskCTilesetClip=r(o.Cesium,s.sfmCEnum,s.sfmCesiumUtil,s.SfmCEntityManager,o)}}(function(u,e,t,i,n){new u.Cartesian3,new u.Cartographic;function r(e,t,i,n,r){var o=e._cps,s=null;if(0==o.length){s=new u.ClippingPlane(new u.Cartesian3(t,i,n),r),o.add(s);var a=u.Matrix4.getTranslation(e._ts.root.transform,new u.Cartesian3),l=e._ts.boundingSphere.radius;e._em.add({position:a,plane:{dimensions:new u.Cartesian2(l,l),material:u.Color.WHITE.withAlpha(.1),plane:new u.CallbackProperty(function(){return s},!1),outline:!0,outlineColor:u.Color.WHITE},show:!1!==e._options.showClipPlane})}else(s=o.get(0)).normal.x=t,s.normal.y=i,s.normal.z=n,s.distance=r;e._ts.clippingPlanes=o}function o(e){!function(e,t){e._options=t,e._viewer=t.viewer,e._ts=t.tileset,e._oricps=e._ts.clippingPlanes,e._cps=new u.ClippingPlaneCollection,e.orimm=e._cps.modelMatrix,e._em=new i({viewer:e._viewer})}(this,e)}var s=function(e){e._em.clear(),e._cps&&e._cps.removeAll(),e._ts.clippingPlanes=e._oricps};return o.prototype.destroy=function(){!function(e){s(e),e._em.destroy(),delete e._em,e._cps&&e._cps.destroy(),delete e._cps,delete e._ts,delete e._viewer,delete e._options}(this)},o.prototype.clear=function(){s(this)},o.prototype.hClip=function(e){null!=e&&!isNaN(e)||(e=0),function(e,t){d=t,r(e,0,0,-1,d)}(this,e)},o.prototype.vClip=function(e){null==e&&(e=0),function(e,t){var i=new u.Cartesian3(1,0,0),n=u.Matrix3.fromRotationZ(t);u.Matrix3.multiplyByVector(n,i,i),r(e,i.x,i.y,i.z,0)}(this,e)},o},this),function(n,r){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil");module.exports=n(e,t,i,r)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil"],function(e,t,i){return n(e,t,i,r)});else{null==r.SFM&&(r.SFM={}),r.SFM||(r.SFM={});var o=r.SFM.cesiumlib||(r.SFM.cesiumlib={});r.SFM.cesiumlib.ZlskCEffect=n(r.Cesium,o.sfmCEnum,o.sfmCesiumUtil,r)}}(function(c,e,t,i){function f(e,t,i){var n;return e?void 0===(n=e[t])?i:n:i}new c.Cartesian3,new c.Cartographic;function n(e){!function(e,t){e._options=t,e._viewer=t.viewer,e._els=[]}(this,e)}var r=function(e){for(;0<e._els.length;){var t=e._els.pop();t.el instanceof c.ParticleSystem&&t.el.destroy()}},h=function(e){var t=f(e,"position",null);if(!t){var i=f(e,"coordinate",null);i&&(t=c.Cartesian3.fromDegrees(i[0],i[1],i[2]))}return t};return n.prototype.destroy=function(){!function(e){r(e),delete e._els,delete e._viewer,delete e._options}(this)},n.prototype.clear=function(){r(this)},n.prototype.remove=function(e){!function(e,t){for(var i=function(e,t,i){if(!e)return null;for(var n=[],r=0;r<e.length;r++)e[r][t]==i&&n.push(e.splice(r--,1)[0]);return n}(e._els,"el",t),n=0;n<i.length;n++)e._viewer.scene.primitives.remove(t),t.destroy()}(this,e)},n.prototype.addSmoke=function(e){return function(e,t){var i=h(t);if(i){var n=f(t,"startColor",null),r=f(t,"endColor",null);n||r||(r=(n=f(t,"color",new c.Color(0,0,0,.3))).withAlpha(0));var o=f(t,"minImageSize",[10,10]),s=f(t,"maxImageSize",[50,50]),a=f(t,"graAcc",-5),l=new c.Cartesian3,u=new c.ParticleSystem({image:f(t,"image",void 0),startColor:n,endColor:r,startScale:f(t,"startScale",1),endScale:f(t,"endScale",3),minimumParticleLife:f(t,"minLife",1),maximumParticleLife:f(t,"maxLife",1),minimumSpeed:f(t,"minSpeed",1),maximumSpeed:f(t,"maxSpeed",4),minimumImageSize:new c.Cartesian2(o[0],o[1]),maximumImageSize:new c.Cartesian2(s[0],s[1]),emissionRate:f(t,"rate",200),emitter:new c.SphereEmitter(.1),lifetime:20,modelMatrix:c.Transforms.eastNorthUpToFixedFrame(i),updateCallback:function(e,t){0!=a&&(c.Cartesian3.normalize(e.position,l),c.Cartesian3.negate(l,l),c.Cartesian3.multiplyByScalar(l,a*t,l),c.Cartesian3.add(e.velocity,l,e.velocity))}});return e._viewer.scene.primitives.add(u),e._els.push({el:u}),u}}(this,e)},n.prototype.addFire=function(e){return function(e,t){var i=h(t);if(i){var n=f(t,"startColor",null),r=f(t,"endColor",null);n||r||(r=(n=f(t,"color",new c.Color(1,1,1,.3))).withAlpha(0));var o=f(t,"minImageSize",[10,10]),s=f(t,"maxImageSize",[50,50]),a=f(t,"graAcc",-5),l=new c.Cartesian3,u=new c.ParticleSystem({image:f(t,"image",void 0),startColor:n,endColor:r,startScale:f(t,"startScale",1),endScale:f(t,"endScale",3),minimumParticleLife:f(t,"minLife",1),maximumParticleLife:f(t,"maxLife",1),minimumSpeed:f(t,"minSpeed",1),maximumSpeed:f(t,"maxSpeed",4),minimumImageSize:new c.Cartesian2(o[0],o[1]),maximumImageSize:new c.Cartesian2(s[0],s[1]),emissionRate:f(t,"rate",200),emitter:new c.SphereEmitter(.1),lifetime:20,modelMatrix:c.Transforms.eastNorthUpToFixedFrame(i),updateCallback:function(e,t){0!=a&&(c.Cartesian3.normalize(e.position,l),c.Cartesian3.negate(l,l),c.Cartesian3.multiplyByScalar(l,a*t,l),c.Cartesian3.add(e.velocity,l,e.velocity))}});return e._viewer.scene.primitives.add(u),e._els.push({el:u}),u}}(this,e)},n},this),function(n,r){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil");module.exports=n(e,t,i,r)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil"],function(e,t,i){return n(e,t,i,r)});else{null==r.SFM&&(r.SFM={}),r.SFM||(r.SFM={});var o=r.SFM.cesiumlib||(r.SFM.cesiumlib={});r.SFM.cesiumlib.SfmCWeather=n(r.Cesium,o.sfmCEnum,o.sfmCesiumUtil,r)}}(function(o,e,t,i){function n(e){!function(e,t){e.viewer=t.viewer}(this,e)}var s=new o.Cartesian2(12,12),a=new o.Cartesian2(24,24),l=[0,1e3,3e3,5e3,7e3],r=new o.Cartesian3,u=new o.Cartesian2(15,30),c=[0,3e3,5e3,7e3,9e3],f=new o.Cartesian3,h=function(n){return function(e,t){r=o.Cartesian3.normalize(e.position,r),o.Cartesian3.multiplyByScalar(r,o.Math.randomBetween(-30,-300),r),e.velocity=o.Cartesian3.add(e.velocity,r,e.velocity);var i=o.Cartesian3.distance(n.viewer.camera.position,e.position);e.endColor.alpha=1e5<i?0:n.snow.ps.endColor.alpha/(i/1e5+.1)}},d=function(n){return function(e,t){f=o.Cartesian3.normalize(e.position,f),f=o.Cartesian3.multiplyByScalar(f,-1050,f),e.position=o.Cartesian3.add(e.position,f,e.position);var i=o.Cartesian3.distance(n.viewer.camera.position,e.position);e.endColor.alpha=1e5<i?0:n.rain.ps.endColor.alpha/(i/1e5+.1)}};return n.prototype.destroy=function(){this.clear(),delete this.viewer},n.prototype.clear=function(){this.setSnow(0),this.setRain(0)},n.prototype.setSnow=function(e){!function(e,t){var i=e.viewer;if(0<t)if(4<t&&(t=4),e.snow)e.snow.ps.emissionRate=l[t];else{e.snow={};var n=e.snow.ps=new o.ParticleSystem({modelMatrix:o.Matrix4.fromTranslation(i.camera.position),minimumSpeed:-1,maximumSpeed:0,lifetime:15,emitter:new o.SphereEmitter(1e5),startScale:.5,endScale:1,image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAOwgAADsIBFShKgAAAABl0RVh0U29mdHdhcmUAcGFpbnQubmV0IDQuMC4xOdTWsmQAAAxDSURBVHhe7dsJjG1FEQbgx1ORRXZBBBEkLAKiEQg+IIBBFpVFUNSASIgYEIn7vhNXFI1CNODKoiIoUYJbUCERcCEmBldUIBE0BFQ2FQSR9/y/Q9fJvTN3nsydYWbAqeRPn9NdXVW9VVf3uXfJIi3SIi3SfNKKFSuWtcf/H0qjVxnAmfXcih9eNNDQwtLgEQ3rBPe21LuyIf4m5qFFAw2oxj4Sli9f/qhg1Tw/GvK8T1K0X+B9VTx57viDoU5p4hcmlZHN4BphDdLg1ZKunnSN4DGQ97WCd+R5RUu7/GCNxquOulDyFmZnNKMGR7sb5TRAg9cM1s7zOsF6wQbBYyH5FwU64NstTxkeS2LtYM08k2HGkDk0K5r6+SNGNNQIGfHVkhpFI6zR6+d9w2DjPG+S9AlJn9jwp7zrgBu9tzI8Gwcb5nn9gIy18k4m2YMzYv5mQylnSAyzbrsRZ2ywbmBEHxdsGmye8i2TbhVsG2yX9z2CnpL3zFa2VV7xbh6oSwZZZJLdzYikdM5PJ5RSBjRDjIx1bbRMY0ZvFjwp2Dpl2yfdMXh6sEuwa/LeEPSUvDe1Mjw7JkudrQMyyCKTbMuDr+Aj5r4TShnFMcB0ZIiRsXY3CozaFsE2wVOCnQIN3iPp3sE+Aa9/btBT8r7ayvbOK95dA3XJIItMsumgy7IoRzk3nVBKKKQ4qClvnVvjmyU1zXcIGL9boNH7BQcGhwYvCF4UXBXenvL+m1aGB6866pJB1g5hI5sOuviHbkkED34nlPCmqGt8Ut7dtGSQNWuknhoYvb2C/YODw3d40iODY4Jjg+OCu5LfU97vbmV4jkyWOgcHZJBFJtl00EXnBuFjA1se3E5ogrvGBzXtjcLjA+u0pjvn9qykBwUacVSgYScErw5eH5wcnkmU/I81HrzqqEvGQSkm09KgY7uATrq7mZDywR1idjuAwGBpFInkyuFZh0aBIQzaOTgtODo4NDxHJNWIEwONfkvwzuCk4MKUT6LkX9R48Kqj7rEpIsvSOCDYM3hO8JHAkmDDeuFhUznG2Y0TmkA9KyAR2FBY017jjQrDjkn+bUnPCYzia4O3Bu8JPhB8ODDKPw/fJEr+LxsPXnXUJeP44OiwmA2fCG4Jnh/QbYsVN7CJbWxk69Jm/swogobWfWCr44kFMvbtavyzAwZ+Mbwa88fg1EBjTgkY/sng9OBmPBMp+X9tPHjVUfddwRsDHXJ14zs7oJNuNrCFTWwb8getGeNThBh9IWite07PdmT6PS3YPTA1eXAO7FXB9eFn6L3BTwKN/kzw+YDx/1E+ilJm9uD9VPDxwIy4OHBqVH59YBehk242sIVNbCt/wOaZzYII6EY/QvWonq2pb0+21dnfOSfr09p/ZfDmwCh2BqM8m7LfCb4UfLdlj6SUfz/QSTrra8FfWpGy+4IPBuVn6LY7sGWLvNdSGNoaW3OmTyoHjrE1+g4w4nVbkelnezoweZyUdVpTlYO6MvmDlKzlvwt+0d5HUivX8N+qcH/u/ZTXHwV0HJ9XOsULbGDLNsljm7CZrTULxusAFYPy/LX2haPdlpeyZUnt0db9ywLOynr9UGDtfy64LXxDlLx+ZoyilP8t+Ed77Sl5twb8Ah100Un3/ilmi22YbWzsfEEw/o6gUlCe3xZTa198rsdFaQIVe7XtisfmtKzbM4Kzgu8FQ6M4LkXMNwKy6aCLTrrZwBY2sa3zBanivFA7wtgd0E3/pM7mjqe8ra3HuhPPGwF7vT3b1DdCnNcXAutdfP/78M2IIsPSIZNsOuiiU4zABmEzm9jmWO34LUIcfxmopHKErB44gXEwjqlOaiIy6+8lgf1e4GJkbF88+NnhOT/pD4JfBSud9iuj1L0nySVJdSjZdNBFJ91s4IfYxLYtA47aMnCzNHYHdOs/qbUk6tskMMUcV005nt+2J3QVvX024MF/HdjPp9zqxiHymtyrgm8F/AzdbGALm9jGRrbWbtD5gdasB04qpbKtpFv/SXlYQYcz+2GB7eibwdXBv1I+5xS9dwVmmF2Dc9w32DZFbO38QFJtmF4HpELvACPAdDLd3x8ISG5M/oKl2PfnwB0jP2GH0BHTc4SYg92Dc4Kx1+8CIfafFezWmve/KczdDEgPCoA4P2uM4+HURsbxC4Vi303BxXk0A54bCN7GmgHVAWJrW6CTn5DTDc1RyXOq4/SuyzNPPecU3fcE1+aRL7JEnxew0QmRzRURjtcBAR/QhcCB/XX7YFngICIUtQ1VAPTl4LLgmmBSBDgbRG7A6doWRZpvD9hwRIoPCNjmMlW80oXEeZ9+MIS5VRrsADezfRAUOJG52nKb+75AlPbpQAxwXtILg8sD2+ItyRuLUtex+rI8XpDUIYkOuuikmw1sGQyG2Dp+B6BUGNoGm9DaBt3eOv5WFOiWx5Jw7D0z+ErAYOGrW55/Rs5YlLp3BjqTTLLpoIvOLhoM2MImtrGRreNvgyiVVknlwUCo7gAmBkKvCezBzu2OwUJWy0EY/PXgmsiYEUXGH5pMsumgi066JwZCdTcwGAhNb/SRSoFQmBBfZaYKhd0BlB+oUNj2aRnYNWbjMESM+4TBUJhOuieFwknFLmx2hzGzs0DQHYYizJVT3QFaa3UUfnlQy+CjQR2GjNio4/BKd4yUW/N3tteeknd7YPrTUdOf7u5IHNT6Z+NGqeIAN+PDUN0GWUuunwePw77lHRK8NHA0fVtQs8Bx+GepN0TJuy64vL2OpJRfEfAbdpOJFyI/Deigi0662cCWweOwDzW1/qfvAJFKwdCFSN5NrfoGIB6wHb4w4IheF7w7ODkYuvfL89+DSwM+QeNWdieonAPlQ4Tet7ciZa7E+AC66KSbDWzpLkTCVifB/iAUTL8DkIrByq7EOB4fQHz1eUVgWzI9bwhfGWwbPC+vfIJGadytyidS8u/Ak0e8lpBLFfv9lcF9jcelqLVPJ91sYMvsXokhlYNRl6JmgYjrGYETmNOhi8oTU35BwNCbA1uXfZtPcNvrTH9uMPKSJPnXNh686qjrY4s7xtPDUrfN5NJJNxvY0o1+MHuXoigCJl6L6+HOFyTPlbRPYaIwzsjUvCPPpu57A8uBT+AYeXA3vfbyK8IziZL/48aDVx11yTgpxS5AnP/NJs5Vh9PNhlr7FfzU6M/840iEDM2CpNZXfRh5cmD61ecqI1cOynLgEzgtnltjrF+e/PzImkTJd67Hg1cddckgi0x7vnUvNUPoZkP/YSRiZm/0iyKomwURrGddNtZScBcv9vZd0PV0fRA1OnyCGaFD+AWNMZVFcULZu1O3p7z/u+XjwauOumSQRSbZOpqunVPNjy4Gvwfw/LM3+kURVrOAV62l0H0Zzrs7OJ0gDN0zz7yy9clJ2aeNnD1b4CJ60zBxvFNkT3m/oZXhwauOumSQdVjYyDbbdsmzg5mgZ+gLcVI2zt7oFxFIcBT4RuiiVCc4I/hRU3XCTklFZJyT62rT1V6tETy30FXDfD26JLw95f2HrQwPXnXUJYOsfcNGNh3VeHd/3eewgE2zO/UHidAGS2HwBxIcj1HwucxBhFPimf3UxYgJVExdIau1q2G+Ip2R8p7yzuMrw4NXnUNSRIatjkyy6aCLTtty9wOJQOO7bQ+a2bNLTXj5g1G/EuGMHEZsSxyUAEWUJlR1dvA9T8NeHByX557yfkISZQ42eNVRt/+JTEA2HXQ57U1s/PhBzwMlCpqi6oRaDpwQT2w7EicIlupXI/2PpJL6oOmjipG9KSly3S1P2VQ/kiJz05TR0f1IKqhpPzeNL6KoKaSYAd3uEGNskaalEXImZ/RUP5PzPe/SpMj612BleCb9TC7vZFpu/c/kgrlvfBGFTTGnYyYwyHTkjY1QdYQZ4YTGaZnC1rAfSmrgKUmRz11Ocsrw4FXHiHcNT9qNelI6qvF0z33jiyhuYEi3JJL2HRE4k/MPpq2GTPyp7OF5t/5dafU/lQ3wqqNu9wtRMgPbXI165+2hmTN/1AzpZkMMtA93MyJgtOnKWWmIUdQoU9moCmL8isRoy1OGZ1111M1zP+JJa4+fv1GfihjUUMui64ygmxVJR/1cHhx+jHCXj6fxdqMdVKP7hkNTuzCpjGwGM9yUtUQm/mFCI/caeK8Gd/zBQ6fRU1EZP4B+hoxA39hCE/PwoomNLLTiRVqkRVqkRZobWrLkv2pLYf4WcPZRAAAAAElFTkSuQmCC",emissionRate:l[t],startColor:o.Color.WHITE.withAlpha(0),endColor:o.Color.WHITE.withAlpha(1),minimumImageSize:s,maximumImageSize:a,updateCallback:h(e)});i.scene.primitives.add(n);var r=e.snow.eh=function(){e.snow.ps.modelMatrix=o.Matrix4.fromTranslation(e.viewer.camera.position)};i.scene.preUpdate.addEventListener(r)}else e.snow&&(i.scene.preUpdate.removeEventListener(e.snow.eh),delete e.snow.eh,i.scene.primitives.remove(e.snow.ps),e.snow.ps.destroy(),delete e.snow.ps,delete e.snow)}(this,e)},n.prototype.setRain=function(e){!function(e,t){var i=e.viewer;if(0<t)if(4<t&&(t=4),e.rain)e.rain.ps.emissionRate=c[t];else{e.rain={};var n=e.rain.ps=new o.ParticleSystem({modelMatrix:o.Matrix4.fromTranslation(i.camera.position),speed:-1,lifetime:15,emitter:new o.SphereEmitter(1e5),startScale:1,endScale:0,image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAOwgAADsIBFShKgAAAABl0RVh0U29mdHdhcmUAcGFpbnQubmV0IDQuMC4xOdTWsmQAAANMSURBVFhH7dc9j41BGMbx3bVrNwQJEq+dlwpB+AB0FEoaJQU+goSOEC3fAAndNgpaGq0CBRWV0ImIOK7fyT2bk33snuMUu4qd5J9M5r7ua56ZuWfO7sRa++9br9drTIapMB1mwmyYK/SNidHQ9vPGbs2gzNaF9WFD2BK2hR1hV6FvTIyGVs54H9KSgtVYGdOtYXfYFw6F4+FkoW9MjIZWjlweo39EE1eilWwKO8OBcCKcDufChXCx0DcmRkMrRy6P0T+ihG1yW7onHA6nwvlwNVwPt8K9Qt+YGA2tHLk8Fj5i2UYQnJut8/UMjoYz4VK4Ee6HR2E+PCv0jYnR0MqRy4MXz35NLNkEg+JxfrbQKhhdCXfCw/A8vA5vwttC35gYDa0cuTx48eRds/2lJegLbZcico620moYPgkvw7vwKXwJ3wp9Y2I0tHLk8uDFk/dkTddtCTonX6qSFZPztKVWxfhD+Bq+h5/hV6FvTIyGVo5cHrx48p6q6botQQ+JonGdVLSicq621upM8COY9PcijInR0MqRy4MXT97TNV23JahQPCjutGulshWX87XFVjk4eWuDH0FDK0cuD148ec/UdN2WoCfVq+ZhcbddLxWuyJyzrV48eWttnIZWjlwevHjynq3pui1B77qn1evmgXHHXTOVrtja6pdqYjS0cuTy4MWT91xN122CJVq1D1j1I1CE28NgET4OCupzGLUIaeXIHSxC3ssWYbuG+4Orcy08CC/C+zDqNaSVI5cHL55Dr2F7iLzfHg9bdzO4Tq/Cx2ACq7TVJoW+MTEaWjlyefDiOfQhGnyKDwZffjncDU8DY6uzxc5ZsUHfmBgNrRy5PHiN9BTDD8bG4AfkSDgbvGYMrcrWOl9FptKhb0yMhlaOXB68eA79MWq7oBg3h73hWGBkNbbUuSouFe6aQd+YGA2tHLk8eA3/OdYIglpwJRUNA6uwlc5TUans28Edh74xMRpaOXJ58Br+B4lGVLSP8PW20DkqJuaulYk8MNA3JkZDK0fuwuQYqTVxJdo656eIVLLr5E57WLxu0DcmRkMrR+6/Td5aSwrOTfGoYNfIlnpQvGqeVugbE6OhldM/c4zdmkGZWc3K/GOy1lamTUz8Af7rUXt1Ah4SAAAAAElFTkSuQmCC",emissionRate:c[t],startColor:new o.Color(.27,.5,.7,0),endColor:new o.Color(.27,.5,.7,.98),imageSize:u,updateCallback:d(e)});i.scene.primitives.add(n);var r=e.rain.eh=function(){e.rain.ps.modelMatrix=o.Matrix4.fromTranslation(e.viewer.camera.position)};i.scene.preUpdate.addEventListener(r)}else e.rain&&(i.scene.preUpdate.removeEventListener(e.rain.eh),delete e.rain.eh,i.scene.primitives.remove(e.rain.ps),e.rain.ps.destroy(),delete e.rain.ps,delete e.rain)}(this,e)},n},this),function(x,E){if("undefined"!=typeof module&&module.exports){var e=require("Cesium"),t=require("sfmCEnum"),i=require("sfmCesiumUtil"),n=require("sfmCPick"),r=require("sfmCEntityManager"),o=require("sfmCMoveTool"),s=require("sfmCLayerManager"),a=require("sfmCHighlightManager"),l=require("viewshed"),u=require("sfmCHeatMapGL"),c=require("sfmCMouseTip"),f=require("sfmCDrawTool"),h=require("sfmCAnalysisTool"),d=require("sfmCMeasureTool"),p=require("sfmCPipeWrapper"),m=require("sfmCPipeGenerater"),g=require("ZlskCPopupManager"),v=require("ZlskCMarkerManager"),y=require("ZlskCViewShedTool"),C=require("zlskCTilesetEditor"),w=require("zlskCTilesetClip"),_=require("ZlskCEffect"),S=require("sfmCWeather"),b=require("zlskCMigrationMap");module.exports=x(e,t,i,n,r,o,s,a,l,u,c,f,h,d,p,m,g,v,y,C,w,_,S,b,E)}else if("function"==typeof define&&define.amd)define(["Cesium","sfmCEnum","sfmCesiumUtil","sfmCPick","sfmCEntityManager","sfmCMoveTool","sfmCLayerManager","sfmCHighlightManager","viewshed","sfmCHeatMapGL","sfmCMouseTip","sfmCDrawTool","sfmCAnalysisTool","sfmCMeasureTool","sfmCPipeWrapper","sfmCPipeGenerater","ZlskCPopupManager","ZlskCMarkerManager","ZlskCViewShedTool","zlskCTilesetEditor","zlskCTilesetClip","ZlskCEffect","sfmCWeather","zlskCMigrationMap"],function(e,t,i,n,r,o,s,a,l,u,c,f,h,d,p,m,g,v,y,C,w,_,S,b){return x(e,t,i,n,r,o,s,a,l,u,c,f,h,d,p,m,g,v,y,C,w,_,S,b,E)});else{null==E.SFM&&(E.SFM={}),E.SFM||(E.SFM={});var M=E.SFM.cesiumlib||(E.SFM.cesiumlib={});E.SFM.cesiumlib.ZlskEarth=x(E.Cesium,M.sfmCEnum,M.sfmCesiumUtil,M.SfmCPick,M.SfmCEntityManager,M.SfmCMoveTool,M.SfmCLayerManager,M.SfmCHighlightManager,M.SfmCViewShed,M.SfmCHeatMapGL,M.SfmCMouseTip,M.SfmCDrawTool,M.SfmCAnalysisTool,M.SfmCMeasureTool,M.SfmCPipeWrapper,M.SfmCPipeGenerater,M.ZlskCPopupManager,M.ZlskCMarkerManager,M.ZlskCViewShedTool,M.ZlskCTilesetEditor,M.ZlskCTilesetClip,M.ZlskCEffect,M.SfmCWeather,M.ZlskCMigrationMap,E),delete M.sfmCEnum,delete M.sfmCesiumUtil,delete M.SfmCPick,delete M.SfmCEntityManager,delete M.SfmCLayerManager,delete M.SfmCHighlightManager,delete M.SfmCViewShed,delete M.SfmCHeatMapGL,delete M.SfmCMouseTip,delete M.SfmCPoint,delete M.SfmCPolyline,delete M.SfmCPolygon,delete M.SfmCCircle,delete M.SfmCDrawTool,delete M.SfmCAnalysisTool,delete M.SfmCHDistance,delete M.SfmCVDistance,delete M.SfmCDistance,delete M.SfmCPolygonArea,delete M.SfmCMeasureTool,delete M.SfmCPipeWrapper,delete M.SfmCPipeGenerater,delete M.sfmCShaderSource,delete M.ZlskCPopupManager,delete M.ZlskCMarkerManager,delete M.ZlskCViewShedTool,delete M.ZlskCTilesetEditor,delete M.ZlskCTilesetClip,delete M.ZlskCEffect,delete M.SfmCWeather,delete M.ZlskCMigrationMap,delete M.ZlskCCicleRipple,delete M.SfmCViewShed,delete M.SfmCFlowPolyline,delete M.SfmCHAngle,delete M.SfmCMoveTool,delete M.SfmCLayerStyleManager,delete M.SfmCPolylineWrapper,delete M.SfmCPrimitiveFactory,delete M.sfmCLayerStyleHelper}}(function(l,e,t,i,n,r,o,s,a,u,c,f,h,d,p,m,g,v,y,C,w,_,S,b,x){function E(e,t){return e.data.mt||(e.data.mt=new c({viewer:e.data.cv,el:t}))}function M(e,t){return e.data.pm||(e.data.pm=new g({viewer:e.data.cv,el:t}))}var T=l,P=new l.Cartographic,F=function(e){e._pphandler&&e._pphandler.removeInputAction(l.ScreenSpaceEventType.LEFT_CLICK)};return x.SFM.Base.extend({constructor:function(e){this.data={},this.data.cv=e.viewer,e.vc&&this.initViewer(e.vc,e.viewerOption)},initViewer:function(e,t){return this.data.cv=new T.Viewer(e,t),this.data.cv},getViewer:function(){return this.data.cv},screenToCartesian:function(e,t){var i=this.data.cv;return i.camera.pickEllipsoid(new l.Cartesian2(e,t),i.scene.globe.ellipsoid)},screenToCartographic:function(e,t){var i=this.screenToCartesian(e,t);if(!i)return i;var n=this.data.cv.scene.globe,r=n.ellipsoid.cartesianToCartographic(i),o=n.getHeight(r);return null!=o&&(r.height=o),r},getCenter:function(){var e=this.getCenterCartographic();return e?{x:e.longitude*l.Math.DEGREES_PER_RADIAN,y:e.latitude*l.Math.DEGREES_PER_RADIAN,z:e.height}:e},getCenterCartesian:function(){var e=this.data.cv,t=e.canvas.clientWidth/2,i=e.canvas.clientHeight/2;return this.screenToCartesian(t,i)},getCenterCartographic:function(){var e=this.data.cv,t=e.canvas.clientWidth/2,i=e.canvas.clientHeight/2;return this.screenToCartographic(t,i)},distanceCartographic:function(e,t){var i=l.Cartesian3.fromRadians(e.longitude,e.latitude,e.height),n=l.Cartesian3.fromRadians(t.longitude,t.latitude,t.height);return l.Cartesian3.distance(i,n)},setTerrainOpacity:function(e){e=Number(e),isNaN(e)&&(e=1),1<e&&(e=1),e<0&&(e=0),this.data.cv.scene.globe._surface.tileProvider.translucent=e<1;for(var t=this.data.cv.scene.imageryLayers._layers,i=0;i<t.length;i++)t[i].alpha=e},getTerrainOpacity:function(){var e=this.data.cv.scene.imageryLayers._layers;return e&&0<e.length?e[0].alpha:1},initMouseTip:function(e){E(this,e)},showMouseTip:function(e){E(this).show(e)},hideMouseTip:function(){E(this).hide()},initPopup:function(e){M(this,e)},openPopup:function(e){return M(this).open(e)},closePopup:function(e){M(this).close(e)},clearPopup:function(){M(this).clear()},beginPick:function(e){var t=this.getDefaultPick();t.exit(),t.begin(e)},beginPickInfo:function(a){var e=this.getDefaultPick();e.exit(),e.begin(function(e,t){if(e instanceof l.Cesium3DTileFeature){for(var i=e.getPropertyNames(),n=[],r=0;r<i.length;r++){var o=i[r],s=e.getProperty(o);n.push({key:o,value:s})}"function"==typeof a&&a(n,e,t)}})},endPick:function(){this.getDefaultPick().exit()},destroyPickPosition:function(){!function(e){F(e),e._pphandler&&e._pphandler.destroy(),delete e._pphandler}(this)},beginPickPosition:function(e){!function(e,n){F(e);var r=e.data.cv;e._pphandler||(e._pphandler=new l.ScreenSpaceEventHandler(r.scene.canvas)),e._pphandler.setInputAction(function(e){var t=r.scene.pickPosition(e.position);if(t&&"function"==typeof n){l.Cartographic.fromCartesian(t,null,P);var i={};i.position=t,i.longitude=180*P.longitude/Math.PI,i.latitude=180*P.latitude/Math.PI,i.height=P.height,i.terrainHeight=r.scene.globe.getHeight(P),n(i)}},l.ScreenSpaceEventType.LEFT_CLICK)}(this,e)},exitPickPosition:function(){F(this)},getDefaultLayerManager:function(){return this.data.lm||(this.data.lm=new o({viewer:this.data.cv}))},getDefaultHighlightManager:function(){return this.data.hlm||(this.data.hlm=new s)},getDefaultDrawTool:function(){return this.data.dt||(this.data.dt=new f({viewer:this.data.cv,mouseTip:E(this)}))},getDefaultAnalysisTool:function(){return this.data.at||(this.data.at=new h({viewer:this.data.cv}))},getDefaultMeasureTool:function(){return this.data.meatool||(this.data.meatool=new d({viewer:this.data.cv,mouseTip:E(this)}))},getDefaultPipeWrapper:function(){return this.data.pw||(this.data.pw=new p({viewer:this.data.cv}))},getDefaultWeather:function(){return this.data.wea||(this.data.wea=new S({viewer:this.data.cv}))},getDefaultPipeGenerater:function(){return this.data.pg||(this.data.pg=new m({viewer:this.data.cv}))},getDefaultMoveTool:function(){return this.data.mvt||(this.data.mvt=new r({viewer:this.data.cv}))},getDefaultPick:function(){return this.data.pk||(this.data.pk=new i({viewer:this.data.cv}))},getMarkerManager:function(){return this.data.mm||(this.data.mm=new v({viewer:this.data.cv}))},getViewshedTool:function(){return this.data.vst||(this.data.vst=new y({viewer:this.data.cv}))},getEffectTool:function(){return this.data.et||(this.data.et=new _({viewer:this.data.cv}))},getMigrationMapTool:function(){return this.data.mmt||(this.data.mmt=new b({viewer:this.data.cv}))},createMarkerManager:function(){return new v({viewer:this.data.cv})},createEntityManager:function(e){return new n({viewer:this.data.cv,name:e})},createTilesetEditor:function(e){return new C(this.data.cv,e)},createTilesetClip:function(e){return new w({viewer:this.data.cv,tileset:e.tileset})},util:t,__className__:"ZlskEarth",version:"1.0.0"},{zlskCEnum:e,zlskCesiumUtil:t,ZlskCLayerManager:o,ZlskCHeatMapGL:u})},this);