{"remainingRequest":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\src\\views\\project\\quality\\processAudit.vue?vue&type=style&index=0&id=4866030c&lang=scss&scoped=true&","dependencies":[{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\src\\views\\project\\quality\\processAudit.vue","mtime":1684246188039},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\css-loader\\dist\\cjs.js","mtime":1684411443176},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1684411446724},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\postcss-loader\\src\\index.js","mtime":1684411443221},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1684411446938},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1684411445150},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":1684411444634}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQoucHJvY2Vzcy1hdWRpdCB7DQogIGhlaWdodDogMTAwJTsNCiAgb3ZlcmZsb3cteTogYXV0bzsNCn0NCi5wZW9wbGUgew0KICBzcGFuIHsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgcGFkZGluZzogMnB4IDZweDsNCiAgfQ0KfQ0K"},{"version":3,"sources":["processAudit.vue"],"names":[],"mappings":";AAiTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"processAudit.vue","sourceRoot":"src/views/project/quality","sourcesContent":["<template>\r\n  <div class=\"process-audit\">\r\n    <van-tabs>\r\n      <van-tab title=\"工序审核\">\r\n        <van-list\r\n          :finished=\"finished\"\r\n          finished-text=\"我也是有底线的~~\"\r\n          @load=\"onLoad\"\r\n          class=\"common-list common-card\"\r\n          :style=\"{ height: scrollerHeight }\"\r\n        >\r\n          <div v-for=\"(item, index) in list\" :key=\"index\" :class=\"'item ' + (index === list.length - 1 ? 'last' : '')\">\r\n            <div class=\"content\">\r\n              <span class=\"name\">构件编码：</span>\r\n              <span class=\"value\">{{ item.conponentcode }}</span>\r\n            </div>\r\n            <div class=\"content\">\r\n              <span class=\"name\">构件名称：</span>\r\n              <span class=\"value\">{{ item.conponentname }}</span>\r\n            </div>\r\n            <div class=\"content\">\r\n              <span class=\"name\">工序名称：</span>\r\n              <span class=\"value\">{{ item.producename }}</span>\r\n            </div>\r\n            <div class=\"content\">\r\n              <span class=\"name\">填报人：</span>\r\n              <span class=\"value\">{{ item.updateusername }}</span>\r\n            </div>\r\n            <div class=\"content\">\r\n              <span class=\"name\">填报时间：</span>\r\n              <span class=\"value\">{{ item.updatetime ? formatISO8601Time(item.updatetime) : '' }}</span>\r\n            </div>\r\n            <div class=\"content\">\r\n              <span class=\"name\">填报信息：</span>\r\n              <van-button class=\"button\" type=\"primary\" size=\"small\" @click.stop=\"previewPic(item)\"\r\n                >举牌照片</van-button\r\n              >\r\n              <van-button\r\n                style=\"margin-left:10px\"\r\n                class=\"button\"\r\n                type=\"primary\"\r\n                size=\"small\"\r\n                @click.stop=\"previewPdf(item)\"\r\n                >PDF</van-button\r\n              >\r\n            </div>\r\n            <div class=\"operate center-in-vertical\">\r\n              <van-button\r\n                v-if=\"item.checkresult === 3\"\r\n                class=\"button\"\r\n                type=\"warning\"\r\n                size=\"small\"\r\n                @click.stop=\"itemClick(item, 1)\"\r\n                >审核</van-button\r\n              >\r\n              <img\r\n                :src=\"item.checkresult === 1 ? require(`assets/image/已通过.png`) : require(`assets/image/已驳回.png`)\"\r\n                v-if=\"item.checkresult !== 3\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </van-list>\r\n      </van-tab>\r\n      <van-tab title=\"审核记录\">\r\n        <van-list\r\n          :finished=\"recordFinished\"\r\n          finished-text=\"我也是有底线的~~\"\r\n          @load=\"onRecordLoad\"\r\n          class=\"common-list common-card\"\r\n          :style=\"{ height: scrollerHeight }\"\r\n        >\r\n          <div\r\n            v-for=\"(item, index) in recordList\"\r\n            :key=\"index\"\r\n            :class=\"'item ' + (index === list.length - 1 ? 'last' : '')\"\r\n          >\r\n            <div class=\"content\">\r\n              <span class=\"name\">构件编码：</span>\r\n              <span class=\"value\">{{ item.conponentcode }}</span>\r\n            </div>\r\n            <div class=\"content\">\r\n              <span class=\"name\">构件名称：</span>\r\n              <span class=\"value\">{{ item.conponentname }}</span>\r\n            </div>\r\n            <div class=\"content\">\r\n              <span class=\"name\">工序名称：</span>\r\n              <span class=\"value\">{{ item.producename }}</span>\r\n            </div>\r\n            <div class=\"content\">\r\n              <span class=\"name\">审核人：</span>\r\n              <span class=\"value\">{{ item.checkusername }}</span>\r\n            </div>\r\n            <div class=\"content\">\r\n              <span class=\"name\">填报人：</span>\r\n              <span class=\"value\">{{ item.updateusername }}</span>\r\n            </div>\r\n            <div v-if=\"item.stime\" class=\"content\">\r\n              <span class=\"name\">填报时间：</span>\r\n              <span class=\"value\">{{ formatISO8601Time(item.stime) }}</span>\r\n            </div>\r\n            <div v-if=\"item.updatetime\" class=\"content\">\r\n              <span class=\"name\">完成时间：</span>\r\n              <span class=\"value\">{{ formatISO8601Time(item.updatetime) }}</span>\r\n            </div>\r\n            <div class=\"content\" style=\"text-align: center;\">\r\n              <van-button class=\"button\" type=\"primary\" size=\"small\" @click.stop=\"previewPic(item)\"\r\n                >举牌照片</van-button\r\n              >\r\n              <van-button\r\n                style=\"margin-left:10px\"\r\n                class=\"button\"\r\n                type=\"primary\"\r\n                size=\"small\"\r\n                @click.stop=\"previewPdf(item)\"\r\n                >PDF</van-button\r\n              >\r\n              <van-button\r\n                style=\"margin-left:10px\"\r\n                class=\"button\"\r\n                type=\"primary\"\r\n                size=\"small\"\r\n                @click.stop=\"previewPic(item, 'testurl')\"\r\n                >审核照片</van-button\r\n              >\r\n              <van-button\r\n                style=\"margin-left:10px\"\r\n                class=\"button\"\r\n                type=\"primary\"\r\n                size=\"small\"\r\n                @click.stop=\"previewPdf(item, 'standbyrecode')\"\r\n                >审核PDF</van-button\r\n              >\r\n            </div>\r\n            <div class=\"operate center-in-vertical\">\r\n              <img v-if=\"item.checkresult === 3\" :src=\"require(`assets/image/待审核.png`)\" />\r\n              <img v-if=\"item.checkresult === 1\" :src=\"require(`assets/image/已通过.png`)\" />\r\n              <img v-if=\"item.checkresult === 2\" :src=\"require(`assets/image/已驳回.png`)\" />\r\n            </div>\r\n          </div>\r\n        </van-list>\r\n      </van-tab>\r\n    </van-tabs>\r\n\r\n    <PdfPreview ref=\"pdfPreview\"></PdfPreview>\r\n    <van-dialog v-model=\"show\" :closeOnClickOverlay=\"true\" :showConfirmButton=\"false\">\r\n      <van-form @submit=\"onSubmit\" :v-model=\"editData\" class=\"common-card\">\r\n        <upload label=\"举牌照片\" name=\"testurl\"></upload>\r\n        <upload\r\n          diyButton=\"点击选择PDF\"\r\n          :max-count=\"1\"\r\n          accept=\"application/pdf\"\r\n          label=\"PDF\"\r\n          name=\"standbyrecode\"\r\n        ></upload>\r\n        <van-field name=\"result\" label=\"审核状态\">\r\n          <template #input>\r\n            <van-radio-group v-model=\"checked\" direction=\"horizontal\">\r\n              <van-radio name=\"1\">通过</van-radio>\r\n              <van-radio name=\"2\">驳回</van-radio>\r\n            </van-radio-group>\r\n          </template>\r\n        </van-field>\r\n        <!-- <van-field label=\"通知全资\">\r\n          <template #input>\r\n            <div class=\"people\">\r\n              <span v-for=\"item in QZ\" :key=\"item.id\">{{ item.name }}</span>\r\n            </div>\r\n          </template>\r\n        </van-field>\r\n        <van-field label=\"通知建设集团\">\r\n          <template #input>\r\n            <div class=\"people\">\r\n              <span v-for=\"item in JSDW\" :key=\"item.id\">{{ item.name }}</span>\r\n            </div>\r\n          </template>\r\n        </van-field> -->\r\n        <div style=\"margin: 16px\">\r\n          <van-button round block type=\"info\" native-type=\"submit\">提交</van-button>\r\n        </div>\r\n      </van-form>\r\n    </van-dialog>\r\n  </div>\r\n</template>\r\n<script>\r\nimport Upload from '@/components/common/Upload'\r\nimport { formatISO8601Time } from '@/utils/index'\r\nimport { getAgency, check, getAllcheckData, getConAndReferPerson } from '@/api/project.js'\r\nimport PdfPreview from '@/components/PdfPreview'\r\nimport { mapGetters } from 'vuex'\r\nexport default {\r\n  components: {\r\n    PdfPreview,\r\n    Upload\r\n  },\r\n  data() {\r\n    return {\r\n      list: [],\r\n      finished: false,\r\n      formatISO8601Time,\r\n      pdfUrl: '',\r\n      showPdf: false,\r\n      pdfHeight: 0,\r\n      recordList: [],\r\n      recordFinished: false,\r\n      show: false,\r\n      editData: { testurl: '', standbyrecode: '' },\r\n      currentItem: null,\r\n      checked: '1',\r\n      copyUsers: [],\r\n      QZ: [],\r\n      JSDW: []\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapGetters(['currentBiaoDuan']),\r\n    scrollerHeight: function() {\r\n      return window.innerHeight - 146 + 'px'\r\n    }\r\n  },\r\n  created() {},\r\n  methods: {\r\n    onLoad() {\r\n      let that = this\r\n      getAgency({ projectId: this.$store.state.currentBiaoDuan.id }).then(data => {\r\n        that.list = data\r\n        that.finished = true\r\n      })\r\n      this.getPerson()\r\n    },\r\n    itemClick(item) {\r\n      this.currentItem = item\r\n      this.show = true\r\n    },\r\n    onSubmit(values) {\r\n      let params = { recondid: this.currentItem.recodeid, result: parseInt(values.result) }\r\n      let temp = []\r\n      values.testurl.forEach(item => {\r\n        item.url && temp.push(item.url)\r\n      })\r\n      if (values.testurl.length !== temp.length) {\r\n        return this.$notify({ type: 'warning', message: '请上传举牌照片或等待照片上传完成！' })\r\n      }\r\n      params.testurl = temp.join(',')\r\n\r\n      let _temp = []\r\n      values.standbyrecode.forEach(item => {\r\n        item.url && _temp.push(item.url)\r\n      })\r\n      if (values.standbyrecode.length !== _temp.length) {\r\n        return this.$notify({ type: 'warning', message: '请等待PDF上传完成！' })\r\n      }\r\n      params.standbyrecode = _temp.join(',')\r\n      params.copyUsers = this.copyUsers.join(',')\r\n      console.log(params)\r\n      check(params).then(data => {\r\n        this.$notify({\r\n          message: '审核成功',\r\n          type: 'success'\r\n        })\r\n        this.$store.dispatch('getRealtimeMessage')\r\n        this.show = false\r\n        this.onLoad()\r\n        this.onRecordLoad()\r\n      })\r\n    },\r\n    onRecordLoad() {\r\n      let that = this\r\n      getAllcheckData({ type: 1 }).then(data => {\r\n        let temp = []\r\n        data = data || []\r\n        data.forEach(item => {\r\n          if (item.checkresult !== 3 && item.checkresult !== 0 && item.checkresult !== null) {\r\n            temp.push(item)\r\n          }\r\n        })\r\n        that.recordList = temp\r\n        that.recordFinished = true\r\n      })\r\n    },\r\n    recordItemClick(item) {\r\n      this.$refs['pdfPreview'].show(item.recodeid)\r\n    },\r\n    previewPic(item, field) {\r\n      this.$refs['pdfPreview'].showPic(item.recodeid, field)\r\n    },\r\n    previewPdf(item, field) {\r\n      this.$refs['pdfPreview'].show(item.recodeid, field)\r\n    },\r\n    getPerson() {\r\n      getConAndReferPerson({ projectId: this.currentBiaoDuan.id }).then(data => {\r\n        this.QZ = data.QZ || []\r\n        this.JSDW = data.JSDW || []\r\n        data.QZ.forEach(item => {\r\n          this.copyUsers.push(item.id)\r\n        })\r\n        data.JSDW.forEach(item => {\r\n          this.copyUsers.push(item.id)\r\n        })\r\n        console.log(this.copyUsers)\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.process-audit {\r\n  height: 100%;\r\n  overflow-y: auto;\r\n}\r\n.people {\r\n  span {\r\n    display: inline-block;\r\n    padding: 2px 6px;\r\n  }\r\n}\r\n</style>\r\n"]}]}