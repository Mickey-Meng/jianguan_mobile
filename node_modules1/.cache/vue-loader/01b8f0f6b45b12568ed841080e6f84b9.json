{"remainingRequest":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\src\\components\\ComponentSelect.vue?vue&type=style&index=0&id=8b8b7c4e&lang=scss&","dependencies":[{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\src\\components\\ComponentSelect.vue","mtime":1684246187875},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\css-loader\\dist\\cjs.js","mtime":1684411443176},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1684411446724},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\postcss-loader\\src\\index.js","mtime":1684411443221},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1684411446938},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1684411445150},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":1684411444634}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQouY29tcG9uZW50LXNlbGVjdCB7DQogIGhlaWdodDogMTAwJTsNCiAgb3ZlcmZsb3cteTogYXV0bzsNCiAgLmNvbmRpdGlvbiB7DQogICAgbWFyZ2luLXRvcDogNXB4Ow0KICB9DQogIC52YW4tZmllbGRfX2NvbnRyb2wgew0KICAgIHRleHQtYWxpZ246IHJpZ2h0ICFpbXBvcnRhbnQ7DQogIH0NCn0NCg=="},{"version":3,"sources":["ComponentSelect.vue"],"names":[],"mappings":";AAuSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ComponentSelect.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n  <div class=\"component-select\">\r\n    <van-cell-group inset class=\"common-card\" style=\"margin-bottom: 0\">\r\n      <van-field label=\"类型\" label-width=\"40px\">\r\n        <template #input>\r\n          <van-radio-group v-model=\"projectType\" direction=\"horizontal\">\r\n            <van-radio :name=\"item.value\" v-for=\"(item, index) in projectTypes\" :key=\"index\">{{ item.name }}</van-radio>\r\n          </van-radio-group>\r\n        </template>\r\n      </van-field>\r\n      <van-field\r\n        class=\"condition\"\r\n        v-model=\"gongquItem.name\"\r\n        label=\"工区名称\"\r\n        readonly\r\n        @click=\"showGongQu = true\"\r\n        right-icon=\"arrow\"\r\n      />\r\n      <van-field\r\n        class=\"condition\"\r\n        v-model=\"typeItem.name\"\r\n        label=\"项目名称\"\r\n        readonly\r\n        @click=\"show = true\"\r\n        right-icon=\"arrow\"\r\n      />\r\n      <van-field\r\n        label=\"构件选择\"\r\n        v-model=\"fieldValue\"\r\n        is-link\r\n        readonly\r\n        placeholder=\"请选择构件\"\r\n        @click=\"showLocationSelect = true\"\r\n        :rules=\"[{ required: true, message: '请选择所在地区' }]\"\r\n      />\r\n    </van-cell-group>\r\n    <van-list\r\n      :finished=\"finished\"\r\n      finished-text=\"我也是有底线的~~\"\r\n      @load=\"onLoad\"\r\n      :style=\"{ height: scrollerHeight }\"\r\n      class=\"common-list common-card\"\r\n    >\r\n      <div\r\n        v-for=\"(item, index) in list\"\r\n        :key=\"index\"\r\n        :class=\"'item ' + (index === list.length - 1 ? 'last' : '')\"\r\n        @click=\"itemClick(item, index)\"\r\n      >\r\n        <div class=\"content\">\r\n          <span class=\"name\">工序名称：</span>\r\n          <span class=\"value\">{{ item.name }}</span>\r\n        </div>\r\n        <div class=\"content\">\r\n          <span class=\"name\">完成时间：</span>\r\n          <span class=\"value\">{{ item.finish || '未录入' }}</span>\r\n        </div>\r\n        <div class=\"content\" v-if=\"item.status === 2\">\r\n          <span class=\"name\">工序状态：</span>\r\n          <span class=\"value common-state-2\">{{ ['未填报','已通过','被驳回','待审核'][item.status] }}</span>\r\n        </div>\r\n        <div class=\"operate center-in-vertical\">\r\n          <van-button v-if=\"item.finish\" class=\"button\" type=\"primary\" size=\"small\" @click.stop=\"previewPic(item)\"\r\n            >照片</van-button\r\n          >\r\n          <van-button v-if=\"item.finish\" class=\"button\" type=\"primary\" size=\"small\" @click.stop=\"previewPdf(item)\"\r\n            >PDF</van-button\r\n          >\r\n        </div>\r\n      </div>\r\n    </van-list>\r\n    <van-action-sheet v-model=\"showGongQu\" :actions=\"gongquActions\" @select=\"onGongQuSelect\" />\r\n    <van-action-sheet v-model=\"show\" :actions=\"actions\" @select=\"onSelect\" />\r\n    <van-popup v-model=\"showLocationSelect\" round position=\"bottom\">\r\n      <van-cascader\r\n        v-model=\"cascaderValue\"\r\n        title=\"请选择构件\"\r\n        :options=\"options\"\r\n        @close=\"showLocationSelect = false\"\r\n        @change=\"onChange\"\r\n        :field-names=\"fieldNames\"\r\n      />\r\n    </van-popup>\r\n    <PdfPreview ref=\"pdfPreview\"></PdfPreview>\r\n  </div>\r\n</template>\r\n<script>\r\nimport constantField from '@/api/home'\r\nimport { ImagePreview } from 'vant'\r\nimport PdfPreview from '@/components/PdfPreview'\r\nimport { formatISO8601Time } from '@/utils/index'\r\nimport { mapGetters } from 'vuex'\r\nimport { getCheckDataByConponentId, getTree } from '@/api/project.js'\r\nexport default {\r\n  components: {\r\n    PdfPreview,\r\n    [ImagePreview.Component.name]: ImagePreview.Component\r\n  },\r\n  props: {\r\n    onComponentSelect: {\r\n      type: Function\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      show: false,\r\n      showDetail: false,\r\n      typeItem: {},\r\n      showLocationSelect: false,\r\n      fieldNames: {\r\n        text: 'name',\r\n        value: 'id',\r\n        children: 'child'\r\n      },\r\n      fieldValue: '',\r\n      cascaderValue: '',\r\n      options: [],\r\n\r\n      code: '',\r\n      actions: [],\r\n      list: [],\r\n      finished: false,\r\n      refreshing: false,\r\n      map: {},\r\n      detailList: [],\r\n      detailName: '',\r\n\r\n      currentComponent: null,\r\n      formatISO8601Time,\r\n      checkData: null,\r\n      pdfUrl: '',\r\n      showPdf: false,\r\n      pdfHeight: 0,\r\n\r\n      gongquItem: {},\r\n      showGongQu: false,\r\n      gongquActions: [],\r\n\r\n      projectTypes: constantField.projectTypes,\r\n      projectType: ''\r\n    }\r\n  },\r\n  watch: {\r\n    projectType: function() {\r\n      this.init()\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapGetters(['currentProject', 'curProject']),\r\n    scrollerHeight: function() {\r\n      return window.innerHeight - 81 - 130 - 92 + 'px'\r\n    }\r\n  },\r\n  created() {\r\n    this.projectType = this.projectTypes[0].value\r\n  },\r\n  methods: {\r\n    init() {\r\n      let that = this\r\n      getTree({ type: this.projectType, projectId: this.curProject.child[0].id }).then(data => {\r\n        if (data && data.child && data.child.length > 0) {\r\n          that.gongquActions = data.child || []\r\n          that.gongquActions.length > 0 && that.onGongQuSelect(that.gongquActions[0])\r\n        } else {\r\n          that.gongquActions = []\r\n          that.actions = []\r\n          that.options = []\r\n          that.list = []\r\n\r\n          that.gongquItem = {}\r\n          that.typeItem = {}\r\n          that.fieldValue = ''\r\n          that.cascaderValue = ''\r\n          that.$toast.fail('该类型下无对应数据！')\r\n        }\r\n      })\r\n    },\r\n    onGongQuSelect(gongqu) {\r\n      this.showGongQu = false\r\n      this.gongquItem = gongqu\r\n      this.actions = gongqu.child\r\n      if (this.actions && this.actions.length > 0) {\r\n        this.typeItem = this.actions[0]\r\n        this.onSelect(this.typeItem)\r\n      } else {\r\n        this.typeItem = {}\r\n        this.$toast.fail('该工区下无项目数据！')\r\n      }\r\n    },\r\n    onSelect(item) {\r\n      this.show = false\r\n      this.typeItem = item\r\n      this.getprojectDetailInfo()\r\n    },\r\n    getprojectDetailInfo() {\r\n      this.fieldValue = ''\r\n      this.cascaderValue = ''\r\n      this.options = this.typeItem.child\r\n    },\r\n    onChange({ selectedOptions }) {\r\n      this.fieldValue = selectedOptions.map(option => option.name).join('/')\r\n      let last = selectedOptions[selectedOptions.length - 1]\r\n      if (last.conponetcode) {\r\n        this.currentComponent = last\r\n        this.onLoad()\r\n      }\r\n      if (!last.child || last.child.length === 0) {\r\n        return (this.showLocationSelect = false)\r\n      }\r\n    },\r\n    onLoad() {\r\n      this.currentComponent &&\r\n        getCheckDataByConponentId({ id: this.currentComponent.id }).then(data => {\r\n          this.list = data.check\r\n          this.checkData = data.data\r\n          this.refreshing = false\r\n          this.finished = true\r\n        })\r\n    },\r\n    previewPic(item) {\r\n      this.$refs['pdfPreview'].showPic(item.recordid)\r\n    },\r\n    previewPdf(item) {\r\n      this.$refs['pdfPreview'].show(item.recordid)\r\n    },\r\n    itemClick(item, index) {\r\n      let obj = null\r\n      if (index !== 0) {\r\n        obj = this.list[index - 1]\r\n      }\r\n      let { status } = item\r\n\r\n      if (obj && obj.status !== 1) {\r\n        this.$notify({\r\n          message: '请填报上个工序或联系监理审核上个工序',\r\n          type: 'warning'\r\n        })\r\n        return\r\n      }\r\n\r\n      if (status === 0) {\r\n        this.onComponentSelect(item, this.checkData)\r\n      } else if (status === 1) {\r\n        //状态为1，工序审核已完成\r\n        this.$notify({\r\n          message: '工序已审核完成，请填报下一道工序',\r\n          type: 'warning'\r\n        })\r\n      } else if(status === 2){\r\n        this.onComponentSelect(item, this.checkData,true)\r\n      } else if(status === 3){\r\n        this.$notify({\r\n          message: '请联系监理审核',\r\n          type: 'warning'\r\n        })\r\n      }\r\n    },\r\n    // itemClick(item, index) {\r\n    //   let obj = null\r\n    //   if (index !== 0) {\r\n    //     obj = this.list[index - 1]\r\n    //   }\r\n    //   //0 没填报 3已填报待审核 1已确认 2审核未通过\r\n    //   let { status } = item\r\n\r\n    //   if (status === 3) {\r\n    //     this.$notify({\r\n    //       message: '请联系监理审核',\r\n    //       type: 'warning'\r\n    //     })\r\n    //     return\r\n    //   } else if (status === 2) {\r\n    //     this.$notify({\r\n    //       message: '审核未通过，请联系监理',\r\n    //       type: 'warning'\r\n    //     })\r\n    //     return\r\n    //   }\r\n    //   if (obj && obj.status !== 1) {\r\n    //     this.$notify({\r\n    //       message: '请填报上个工序或联系监理审核上个工序',\r\n    //       type: 'warning'\r\n    //     })\r\n    //     return\r\n    //   }\r\n\r\n    //   //0 没填报 3已填报待审核 1已确认 2审核未通过\r\n    //   if (item.status === 0) {\r\n    //     this.onComponentSelect(item, this.checkData)\r\n    //   }\r\n    // }\r\n  }\r\n}\r\n</script>\r\n<style lang=\"scss\">\r\n.component-select {\r\n  height: 100%;\r\n  overflow-y: auto;\r\n  .condition {\r\n    margin-top: 5px;\r\n  }\r\n  .van-field__control {\r\n    text-align: right !important;\r\n  }\r\n}\r\n</style>\r\n"]}]}