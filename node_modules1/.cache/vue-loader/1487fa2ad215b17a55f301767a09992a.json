{"remainingRequest":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\src\\views\\project\\quality\\processFilling.vue?vue&type=style&index=0&id=3c1ce270&lang=scss&","dependencies":[{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\src\\views\\project\\quality\\processFilling.vue","mtime":1684246188041},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\css-loader\\dist\\cjs.js","mtime":1684411443176},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1684411446724},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\postcss-loader\\src\\index.js","mtime":1684411443221},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1684411446938},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1684411445150},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":1684411444634}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQoucHJvY2Vzcy1maWxsaW5nIHsNCiAgaGVpZ2h0OiAxMDAlOw0KICBvdmVyZmxvdy15OiBhdXRvOw0KICAvLyAuY29tbW9uLWxpc3Qgew0KICAvLyAgIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50Ow0KICAvLyAgIC5pdGVtIHsNCiAgLy8gICAgIGJhY2tncm91bmQtY29sb3I6ICNmZmY7DQogIC8vICAgICBib3JkZXItcmFkaXVzOiAzcHg7DQogIC8vICAgfQ0KICAvLyB9DQp9DQo="},{"version":3,"sources":["processFilling.vue"],"names":[],"mappings":";AAsTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"processFilling.vue","sourceRoot":"src/views/project/quality","sourcesContent":["<template>\r\n  <div class=\"process-filling\">\r\n    <van-tabs>\r\n      <van-tab title=\"工序填报\">\r\n        <component-select ref=\"componentSelect\" :onComponentSelect=\"onComponentSelect\"> </component-select>\r\n      </van-tab>\r\n      <van-tab title=\"填报记录\">\r\n        <van-list\r\n          :finished=\"finished\"\r\n          finished-text=\"我也是有底线的~~\"\r\n          @load=\"onLoad\"\r\n          class=\"common-list common-card\"\r\n          :style=\"{ height: scrollerHeight }\"\r\n        >\r\n          <div v-for=\"(item, index) in list\" :key=\"index\" :class=\"'item ' + (index === list.length - 1 ? 'last' : '')\">\r\n            <div class=\"content\">\r\n              <span class=\"name\">构件编码：</span>\r\n              <span class=\"value\">{{ item.conponentcode }}</span>\r\n            </div>\r\n            <div class=\"content\">\r\n              <span class=\"name\">构件名称：</span>\r\n              <span class=\"value\">{{ item.conponentname }}</span>\r\n            </div>\r\n            <div class=\"content\">\r\n              <span class=\"name\">工序名称：</span>\r\n              <span class=\"value\">{{ item.producename }}</span>\r\n            </div>\r\n            <div class=\"content\">\r\n              <span class=\"name\">填报时间：</span>\r\n              <span class=\"value\">{{ item.stime ? formatISO8601Time(item.stime) : '' }}</span>\r\n            </div>\r\n            <div class=\"content\" v-if=\"item.checkusername\">\r\n              <span class=\"name\">审核人：</span>\r\n              <span class=\"value\">{{ item.checkusername }}</span>\r\n            </div>\r\n            <div class=\"content\" v-if=\"item.updatetime\">\r\n              <span class=\"name\">审核时间：</span>\r\n              <span class=\"value\">{{ item.updatetime ? formatISO8601Time(item.updatetime) : '' }}</span>\r\n            </div>\r\n            <div class=\"content\">\r\n              <span class=\"name\">审核状态：</span>\r\n              <span :class=\"'value ' + ['common-state-1', 'common-state-2', 'common-state-0'][item.checkresult - 1]\">{{\r\n                ['审核通过', '监理驳回', '正在审核'][item.checkresult - 1]\r\n              }}</span>\r\n            </div>\r\n            <div class=\"content\" style=\"text-align: center;\">\r\n              <!-- <span class=\"name\">操作：</span> -->\r\n              <van-button class=\"button\" type=\"primary\" size=\"small\" @click.stop=\"previewPic(item)\"\r\n                >举牌照片</van-button\r\n              >\r\n              <van-button\r\n                style=\"margin-left:10px\"\r\n                class=\"button\"\r\n                type=\"primary\"\r\n                size=\"small\"\r\n                @click.stop=\"previewPdf(item)\"\r\n                >PDF</van-button\r\n              >\r\n              <van-button\r\n                v-if=\"item.checkresult != 3\"\r\n                style=\"margin-left:10px\"\r\n                class=\"button\"\r\n                type=\"primary\"\r\n                size=\"small\"\r\n                @click.stop=\"previewPic(item, 'testurl')\"\r\n                >审核照片</van-button\r\n              >\r\n              <van-button\r\n                v-if=\"item.checkresult != 3\"\r\n                style=\"margin-left:10px\"\r\n                class=\"button\"\r\n                type=\"primary\"\r\n                size=\"small\"\r\n                @click.stop=\"previewPdf(item, 'standbyrecode')\"\r\n                >审核PDF</van-button\r\n              >\r\n            </div>\r\n            <!-- <div class=\"operate center-in-vertical\">\r\n              <van-button class=\"button\" type=\"primary\" size=\"small\" @click.stop=\"previewPic(item)\">照片</van-button>\r\n              <van-button class=\"button\" type=\"primary\" size=\"small\" @click.stop=\"previewPdf(item)\">PDF</van-button>\r\n            </div> -->\r\n          </div>\r\n        </van-list>\r\n      </van-tab>\r\n    </van-tabs>\r\n\r\n    <van-dialog v-model=\"show\" :title=\"componentName\" :showConfirmButton=\"false\" :closeOnClickOverlay=\"true\">\r\n      <van-form @submit=\"onSubmit\" :v-model=\"editData\" class=\"common-card\">\r\n        <van-field\r\n          v-model=\"editData.uploadtime\"\r\n          is-link\r\n          readonly\r\n          name=\"uploadtime\"\r\n          label=\"完成时间\"\r\n          placeholder=\"点击选择时间\"\r\n          @click=\"showPicker = true\"\r\n          :disabled=\"!editable\"\r\n          :rules=\"[{ required: true, message: '请选择时间' }]\"\r\n        />\r\n        <van-field\r\n          readonly\r\n          clickable\r\n          name=\"checkusername\"\r\n          :value=\"editData.checkusername\"\r\n          label=\"指定监理\"\r\n          :placeholder=\"editable ? '点击选监理' : '无'\"\r\n          @click=\"editable && (showCheckMan = true)\"\r\n          :rules=\"[{ required: true, message: '请选择监理' }]\"\r\n          :disabled=\"!editable\"\r\n        />\r\n        <upload label=\"举牌照片\" name=\"accrecodeurl\" :rules=\"[{ required: true, message: '请选择照片' }]\"></upload>\r\n        <upload diyButton=\"点击选择PDF\" :max-count=\"1\" accept=\"application/pdf\" label=\"PDF\" name=\"remark\"></upload>\r\n        <div style=\"margin: 16px\" v-if=\"editable\">\r\n          <van-button round block type=\"info\" native-type=\"submit\">提交</van-button>\r\n        </div>\r\n      </van-form>\r\n    </van-dialog>\r\n    <van-popup v-model=\"showPicker\" position=\"bottom\">\r\n      <van-datetime-picker v-model=\"currentDate\" type=\"datetime\" @confirm=\"onConfirm\" @cancel=\"showPicker = false\" />\r\n    </van-popup>\r\n    <van-action-sheet v-model=\"showCheckMan\">\r\n      <van-cell-group inset>\r\n        <van-field v-model=\"searchValue\" placeholder=\"搜索\" input-align=\"center\" clearable />\r\n      </van-cell-group>\r\n      <div class=\"van-action-sheet__content\" style=\"max-height:330px;text-align: center;\">\r\n        <button\r\n          v-for=\"(item, index) in selects\"\r\n          :key=\"index\"\r\n          type=\"button\"\r\n          class=\"van-action-sheet__item\"\r\n          @click=\"onSelect(item)\"\r\n        >\r\n          <span class=\"van-action-sheet__name\">{{ item.name }}</span>\r\n        </button>\r\n        <span style=\"height:200px;line-height: 200px;font-size: 16px\" v-if=\"selects.length === 0\">没有相关数据！</span>\r\n      </div>\r\n    </van-action-sheet>\r\n    <PdfPreview ref=\"pdfPreview\"></PdfPreview>\r\n  </div>\r\n</template>\r\n<script>\r\nimport Selecter from '@/components/common/Selecter'\r\nimport PdfPreview from '@/components/PdfPreview'\r\nimport Upload from '@/components/common/Upload'\r\nimport ComponentSelect from '@/components/ComponentSelect'\r\nimport { formatISO8601Time } from '@/utils/index'\r\nimport { getChecker, addRecode, updateRecode, getAllcheckData } from '@/api/project.js'\r\nexport default {\r\n  components: {\r\n    ComponentSelect,\r\n    Upload,\r\n    PdfPreview,\r\n    Selecter\r\n  },\r\n  computed: {\r\n    scrollerHeight: function() {\r\n      return window.innerHeight - 146 + 'px'\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      show: false,\r\n      componentName: '',\r\n      urlList: [],\r\n      accrecodeurlList: [],\r\n      editable: true,\r\n      editData: {},\r\n      showCheckMan: false,\r\n      checkMans: [],\r\n      showPicker: false,\r\n      formatISO8601Time,\r\n      component: null,\r\n      checkData: null,\r\n      currentDate: new Date(),\r\n\r\n      list: [],\r\n      finished: false,\r\n      refreshing: false,\r\n\r\n      searchValue: '',\r\n      selects: [],\r\n\r\n      isUpdate: false\r\n    }\r\n  },\r\n  watch: {\r\n    searchValue: function() {\r\n      this.watchFunc(500, () => {\r\n        this.search()\r\n      })\r\n    }\r\n  },\r\n  methods: {\r\n    watchFunc(delayTime, func) {\r\n      if (!this.lastTime) {\r\n        this.lastTime = setTimeout(() => {\r\n          func()\r\n        }, delayTime)\r\n      } else {\r\n        clearTimeout(this.lastTime)\r\n        this.lastTime = setTimeout(() => {\r\n          func()\r\n        }, delayTime)\r\n      }\r\n    },\r\n    search() {\r\n      let temps = []\r\n      this.checkMans.forEach(item => {\r\n        let name = item.name\r\n        if (name.indexOf(this.searchValue) !== -1) {\r\n          temps.push(item)\r\n        }\r\n        this.selects = temps\r\n      })\r\n    },\r\n    onComponentSelect(item, checkData, isUpdate) {\r\n      this.isUpdate = isUpdate\r\n      this.show = true\r\n      this.componentName = item.name\r\n      this.component = item\r\n      this.checkData = checkData\r\n      this.getAllChecker()\r\n    },\r\n    onConfirm(time) {\r\n      this.showPicker = false\r\n      this.editData.uploadtime = this.formatISO8601Time(new Date(time).toJSON())\r\n    },\r\n    onSelect(item) {\r\n      this.showCheckMan = false\r\n      this.editData.checkusername = item.name\r\n      this.editData.checkid = item.id\r\n    },\r\n    getAllChecker() {\r\n      getChecker({ group: this.checkData.conponentcode,projectId: this.$store.state.currentBiaoDuan.id }).then(data => {\r\n        this.checkMans = []\r\n        data.forEach(item => {\r\n          this.checkMans.push(item)\r\n        })\r\n        this.selects = this.checkMans\r\n      })\r\n    },\r\n    onSubmit(values) {\r\n      let temp = []\r\n      values.accrecodeurl.forEach(item => {\r\n        item.url && temp.push(item.url)\r\n      })\r\n      if (values.accrecodeurl.length !== temp.length) {\r\n        return this.$notify({ type: 'warning', message: '请上传举牌照片或等待照片上传完成！' })\r\n      }\r\n      values.accrecodeurl = temp.join(',')\r\n\r\n      let _temp = []\r\n      values.remark.forEach(item => {\r\n        item.url && _temp.push(item.url)\r\n      })\r\n      if (values.remark.length !== _temp.length) {\r\n        return this.$notify({ type: 'warning', message: '请等待PDF上传完成！' })\r\n      }\r\n      values.remark = _temp.join(',')\r\n      values = {\r\n        ...{\r\n          projectId: this.$store.state.currentBiaoDuan.id,\r\n          conpoentid: this.checkData.conponentid,\r\n          conponentname: this.checkData.conponenttypename,\r\n          conponenttype: this.checkData.conponenttype,\r\n          projectcode: this.checkData.projectcode,\r\n          produceid: this.component.produceid,\r\n          produceidname: this.component.name,\r\n          updateusername: this.$store.state.userinfo.name\r\n        },\r\n        ...values\r\n      }\r\n      values = { ...values, ...this.editData }\r\n      if (this.isUpdate) {\r\n        values.recodeid = this.component.recordid\r\n        updateRecode(values).then(data => {\r\n          this.$refs['componentSelect'].onLoad()\r\n          this.show = false\r\n          this.$notify({ type: 'success', message: '提交成功！' })\r\n        })\r\n      } else {\r\n        addRecode(values).then(data => {\r\n          this.$refs['componentSelect'].onLoad()\r\n          this.show = false\r\n          this.$notify({ type: 'success', message: '提交成功！' })\r\n        })\r\n      }\r\n      // console.log(values)\r\n    },\r\n\r\n    onLoad() {\r\n      let that = this\r\n      getAllcheckData({ type: 2 }).then(data => {\r\n        that.list = data.sort(function(a, b) {\r\n          return Date.parse(b['uploadtime']) - Date.parse(a['uploadtime'])\r\n        })\r\n        that.refreshing = false\r\n        this.finished = true\r\n      })\r\n    },\r\n    previewPic(item, field) {\r\n      this.$refs['pdfPreview'].showPic(item.recodeid, field)\r\n    },\r\n    previewPdf(item, field) {\r\n      this.$refs['pdfPreview'].show(item.recodeid, field)\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style lang=\"scss\">\r\n.process-filling {\r\n  height: 100%;\r\n  overflow-y: auto;\r\n  // .common-list {\r\n  //   background-color: transparent;\r\n  //   .item {\r\n  //     background-color: #fff;\r\n  //     border-radius: 3px;\r\n  //   }\r\n  // }\r\n}\r\n</style>\r\n"]}]}