{"remainingRequest":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\src\\views\\common\\attachlist.vue?vue&type=style&index=0&id=4dfee8dd&lang=css&","dependencies":[{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\src\\views\\common\\attachlist.vue","mtime":1684246187911},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\css-loader\\dist\\cjs.js","mtime":1684411443176},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1684411446724},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\postcss-loader\\src\\index.js","mtime":1684411443221},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1684411445150},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":1684411444634}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQouZWwtbWVzc2FnZS1ib3h7DQoJd2lkdGg6IDEwMCUgIWltcG9ydGFudDsNCn0NCg=="},{"version":3,"sources":["attachlist.vue"],"names":[],"mappings":";AAiJA;AACA;AACA","file":"attachlist.vue","sourceRoot":"src/views/common","sourcesContent":["<template>\r\n\t<div>\r\n\t\t<div class=\"block-line\" v-if=\"editAble\">\r\n\t\t\t<el-upload class=\"upload-demo\" action=\"\" :limit=\"1\" :show-file-list=\"false\" ref=\"upload\"\r\n\t\t\t\t:accept=\"accept\"\r\n\t\t\t\t:http-request=\"importFile\">\r\n\t\t\t\t<el-button size=\"small\" type=\"primary\">点击上传</el-button>\r\n\t\t\t</el-upload>\r\n\t\t</div>\r\n\t\t<div class=\"block-table\" style=\"background:rgba(0,0,0,0);\">\r\n\t\t\t<el-table :data=\"attachTable\" style=\"width: 100%\" border class=\"have_scrolling\">\r\n\t\t\t\t<el-table-column type=\"index\" width=\"50\" align=\"center\" label=\"序号\">\r\n\t\t\t\t</el-table-column>\r\n\t\t\t\t<el-table-column prop=\"fileName\" align=\"center\" label=\"附件\" show-overflow-tooltip>\r\n\t\t\t\t</el-table-column>\r\n\t\t\t\t<el-table-column prop=\"uploadTime\" width=\"160px\" align=\"center\" label=\"上传日期\">\r\n\t\t\t\t</el-table-column>\r\n\t\t\t\t<el-table-column prop=\"creatorName\" width=\"120px\" align=\"center\" label=\"上传人\">\r\n\t\t\t\t</el-table-column>\r\n\t\t\t\t<el-table-column width=\"120\" align=\"center\" label=\"操作\">\r\n\t\t\t\t\t<template slot-scope=\"{ row, $index }\">\r\n\t\t\t\t\t\t<!-- <el-button type=\"text\" size=\"mini\" @click=\"downloadAttach(row, $index)\">下载</el-button> -->\r\n\t\t\t\t\t\t<el-button type=\"text\" size=\"mini\" @click=\"reviewAttach(row, $index)\">预览</el-button>\r\n\t\t\t\t\t\t<el-button v-if=\"editAble\" type=\"text\" size=\"mini\" @click=\"deleteAttach(row, $index)\">删除</el-button>\r\n\t\t\t\t\t</template>\r\n\t\t\t\t</el-table-column>\r\n\t\t\t</el-table>\r\n\t\t</div>\r\n\t\t\r\n    \t<PdfPreview v-show=\"viewFileType=='pdf'\" ref=\"pdfPreview\"></PdfPreview>\r\n\t\t<el-dialog title=\"预览\" :visible.sync=\"viewFileVisible\" :fullscreen=\"true\" width=\"100%\" height=\"100%\" :modal=\"false\">\r\n\t\t\t<!-- {{viewFileUrl}} -->\r\n\t\t\t<img v-show=\"viewFileType=='img'\" style=\"width: 100%; height: 100%\" :src=\"viewFileUrl\"/>\r\n\t\t\t<video v-show=\"viewFileType=='mp4'\" style=\"width: 100%; height: 100%\" :src=\"viewFileUrl\" controls></video>\r\n\t\t\t<video v-show=\"viewFileType=='mov'\" style=\"width: 100%; height: 100%\" :src=\"viewFileUrl\" controls></video>\r\n\t\t\t<!-- <el-image style=\"width: 100%; height: 100%\" :src=\"viewImgUrl\" :fit=\"fill\"></el-image> -->\r\n\t\t\t<!-- <iframe width=\"100%\" height=\"100%\" style=\"min-height:800px\" v-if=\"viewFileType=='pdf'\" :src=\"viewFileUrl\" frameborder=\"0\"></iframe> -->\r\n\t\t\t\r\n\t\t</el-dialog>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\n\timport {mapGetters} from \"vuex\";\r\n\timport * as api from \"@/api/quality\";\r\n\timport { uploadFile } from '@/api/project.js'\r\n\timport {lookUrl} from \"@/utils/index\"\r\n\timport {\r\n\t\tformatDateTime\r\n\t} from \"@/utils/format.js\";\r\n\timport {MessageBox } from 'element-ui'\r\n\t\r\n\timport PdfPreview from '@/components/PdfPreview'\r\n\texport default {\r\n\t\tprops: ['attachTable','editAble','acceptList'],\r\n\t\tcomponents: {\r\n\t\t\tPdfPreview\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tviewFileType: '',\r\n\t\t\t\tviewFileUrl: '',\r\n\t\t\t\tviewFileVisible: false,\r\n\t\t\t\taccept:this.acceptList||'image/*|video/*'\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t  ...mapGetters([\"userInfo\", \"name\", \"project\", \"roleId\", \"getUrl\"])\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tdownloadAttach(row, index) {\r\n\t\t\t\tapi.downloadFile({\r\n\t\t\t\t\tfileid:row['fileId']\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\treviewAttach(row, index) {\r\n\t\t\t\t// api.previewFile({\r\n\t\t\t\t// \tfileid:row['fileId']\r\n\t\t\t\t// }).then((res) => {\r\n\t\t\t\t\t\r\n\t\t\t\t// });\r\n\t\t\t\tconsole.log(row);\r\n\t\t\t\tlet format = '';\r\n\t\t\t\tif (row.fileName.indexOf('.png') > -1 || row.fileName.indexOf('.jpg') > -1) format = 'img';\r\n\t\t\t\tif (row.fileName.indexOf('.mp4') > -1) format = 'mp4';\r\n\t\t\t\tif (row.fileName.indexOf('.mov') > -1 || row.fileName.indexOf('.MOV') > -1) format = 'mov';\r\n\t\t\t\tif (row.fileName.indexOf('.pdf') > -1) format = 'pdf';\r\n\t\t\t\tthis.viewFileType = format;\r\n\t\t\t\tthis.viewFileUrl = lookUrl(row.fileId);\r\n\t\t\t\tif (format == 'pdf') {\r\n\t\t\t\t\tsetTimeout(() =>{\r\n\t\t\t\t\t\tthis.$refs['pdfPreview'].show_otherPDF(row.fileId)\r\n\t\t\t\t\t}, 300)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.viewFileVisible = true;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdeleteAttach(row, index) {\r\n\t\t\t\tMessageBox.confirm('确认是否删除?', '提示', {\r\n\t\t\t\t\tconfirmButtonText: '确定',\r\n\t\t\t\t\tcancelButtonText: '取消',\r\n\t\t\t\t\ttype: 'warning'\r\n\t\t\t\t}).then(() => {\r\n\t\t\t\t\tthis.attachTable.splice(index, 1);\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tafterUp(data) {\r\n\t\t\t\tthis.attachTable.push({\r\n\t\t\t\t\tuploadTime: formatDateTime(data['uploadTime']),\r\n\t\t\t\t\tfileName: data['fileName'],\r\n\t\t\t\t\tfileId: data['fileId'],\r\n\t\t\t\t\tcreatorName: this.$store.state.userinfo.name\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\timportFile(params) {\r\n\t\t\t\t// let data = new FormData();\r\n\t\t\t\t// data.append(\"file\", params.file);\r\n\t\t\t\t// newUploadFile(data).then((res) => {\r\n\t\t\t\t// \tthis.$message({\r\n\t\t\t\t// \t\ttype: 'success',\r\n\t\t\t\t// \t\tmessage: '上传成功!'\r\n\t\t\t\t// \t});\r\n\t\t\t\t// \tthis.$refs.upload.clearFiles();\r\n\t\t\t\t// \tthis.afterUp(res['data']);\r\n\t\t\t\t// });\r\n\r\n\t\t\t\t\r\n\t\t\t\tconst reader = new FileReader()\r\n\t\t\t\treader.readAsDataURL(params.file)\r\n\t\t\t\treader.onload = e => {\r\n\t\t\t\t\tlet base64 = e.target['result'].split('base64,')[1]\r\n\t\t\t\t\tuploadFile({ name: params.file.name, base64: base64 }).then(url => {\r\n\t\t\t\t\t\tthis.$refs.upload.clearFiles();\r\n\t\t\t\t\t\tconst uploadTime = formatDateTime(new Date());\r\n\t\t\t\t\t\tconst fileName = params.file.name;\r\n\t\t\t\t\t\tconst fileId = url;\r\n\t\t\t\t\t\tthis.afterUp({uploadTime, fileName, fileId});\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n.el-message-box{\r\n\twidth: 100% !important;\r\n}\r\n</style>\r\n"]}]}