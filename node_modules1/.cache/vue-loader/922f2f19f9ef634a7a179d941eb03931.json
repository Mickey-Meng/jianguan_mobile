{"remainingRequest":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\src\\views\\overViewMap\\personMap.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\src\\views\\overViewMap\\personMap.vue","mtime":1684246187992},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1684411445150},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\babel-loader\\lib\\index.js","mtime":1684411446344},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1684411445150},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":1684411444634}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgTGVhZkxldE1hcCBmcm9tICdAL2NvbXBvbmVudHMvbWFwL0xlYWZMZXRNYXAudnVlJw0KaW1wb3J0IHsgZ2V0QWxsVXNlck9ubGluZSB9IGZyb20gJ0AvYXBpL3Byb2plY3QnDQpsZXQgZmVhdHVyZUdyb3VwDQpleHBvcnQgZGVmYXVsdCB7DQogIGNvbXB1dGVkOiB7DQogICAgc2Nyb2xsZXJIZWlnaHQ6IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuIHdpbmRvdy5pbm5lckhlaWdodCArICdweCcNCiAgICB9DQogIH0sDQogIGNvbXBvbmVudHM6IHsNCiAgICBMZWFmTGV0TWFwDQogIH0sDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIGlzRmlyc3RJbjogdHJ1ZSwNCiAgICAgIGNhbkluaXQ6IHRydWUsDQogICAgICBpbnRlcnZhbDogbnVsbCwNCiAgICAgIG9ubGluZVNyYzogcmVxdWlyZSgnLi4vLi4vYXNzZXRzL2ltYWdlL21hcmtlci9vbmxpbmUucG5nJyksDQogICAgICBvZmZsaW5lU3JjOiByZXF1aXJlKCcuLi8uLi9hc3NldHMvaW1hZ2UvbWFya2VyL29mZmxpbmUucG5nJykNCiAgICB9DQogIH0sDQogIGRlc3Ryb3llZCgpIHsNCiAgICB0aGlzLmludGVydmFsICYmIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbCkNCiAgfSwNCiAgbW91bnRlZCgpIHsNCiAgICBmZWF0dXJlR3JvdXAgPSBMLm1hcmtlckNsdXN0ZXJHcm91cChbXSkuYWRkVG8obGVhZkxldE1hcCkNCiAgICB0aGlzLmluaXQoKQ0KICAgIGlmICghdGhpcy5pbnRlcnZhbCkgew0KICAgICAgdGhpcy5pbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHsNCiAgICAgICAgdGhpcy5pbml0KCkNCiAgICAgIH0sIDEwMDAgKiAxMCkNCiAgICB9DQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICBpbml0KCkgew0KICAgICAgaWYgKHRoaXMuY2FuSW5pdCkgew0KICAgICAgICB0aGlzLmNhbkluaXQgPSBmYWxzZQ0KICAgICAgICBnZXRBbGxVc2VyT25saW5lKCkudGhlbihkYXRhID0+IHsNCiAgICAgICAgICB0aGlzLmNhbkluaXQgPSB0cnVlDQogICAgICAgICAgdGhpcy5kcmF3UGVyc29uKGRhdGEpDQogICAgICAgIH0pDQogICAgICB9DQogICAgfSwNCiAgICBkcmF3UGVyc29uKGRhdGEpIHsNCiAgICAgIGRhdGEuZm9yRWFjaChpdGVtID0+IHsNCiAgICAgICAgbGV0IHsgbG9uLCBsYXQsIG5hbWUsIHVwZGF0ZXRpbWUgfSA9IGl0ZW0NCiAgICAgICAgbG9uICYmIGxhdCAmJiB1cGRhdGV0aW1lICYmIHRoaXMuZHJhdyhpdGVtKQ0KICAgICAgfSkNCiAgICAgIGlmICh0aGlzLiRzdG9yZS5zdGF0ZS5sb2NhdGVQZXJzb25OYW1lKSB7DQogICAgICAgIGxldCBtYXJrZXIgPSBmZWF0dXJlR3JvdXANCiAgICAgICAgICAuZ2V0TGF5ZXJzKCkNCiAgICAgICAgICAuZmluZChsYXllciA9PiBsYXllci5vcHRpb25zLmRhdGEubmFtZSA9PT0gdGhpcy4kc3RvcmUuc3RhdGUubG9jYXRlUGVyc29uTmFtZSkNCiAgICAgICAgaWYgKG1hcmtlcikgew0KICAgICAgICAgIGxlYWZMZXRNYXAuZmx5VG8obWFya2VyLmdldExhdExuZygpLCBsZWFmTGV0TWFwLmdldE1heFpvb20oKSkNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLiRzdG9yZS5zdGF0ZS5sb2NhdGVQZXJzb25OYW1lID0gJycNCiAgICAgICAgdGhpcy5pc0ZpcnN0SW4gPSBmYWxzZQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgaWYgKHRoaXMuaXNGaXJzdEluKSB7DQogICAgICAgICAgdGhpcy5pc0ZpcnN0SW4gPSBmYWxzZQ0KICAgICAgICAgIGxlYWZMZXRNYXAuZml0Qm91bmRzKGZlYXR1cmVHcm91cC5nZXRCb3VuZHMoKSkNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0sDQogICAgaXNUb2RheShzdHIpIHsNCiAgICAgIHZhciBkID0gbmV3IERhdGUoc3RyLnJlcGxhY2UoLy0vZywgJy8nKSkNCiAgICAgIHZhciB0b2RheXNEYXRlID0gbmV3IERhdGUoKQ0KICAgICAgaWYgKGQuc2V0SG91cnMoMCwgMCwgMCwgMCkgPT0gdG9kYXlzRGF0ZS5zZXRIb3VycygwLCAwLCAwLCAwKSkgew0KICAgICAgICByZXR1cm4gdHJ1ZQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlDQogICAgICB9DQogICAgfSwNCiAgICBpc0FjdGl2ZSh1cGRhdGV0aW1lKSB7DQogICAgICByZXR1cm4gdXBkYXRldGltZSAmJiBNYXRoLmFicyhuZXcgRGF0ZSh1cGRhdGV0aW1lLnJlcGxhY2UoLy0vZywgJy8nKSkgLSBuZXcgRGF0ZSgpKSA8IDEwMDAgKiA2MCAqIDMNCiAgICB9LA0KICAgIGRyYXcoZGF0YSkgew0KICAgICAgbGV0IHsgbG9uLCBsYXQsIG5hbWUsIHVwZGF0ZXRpbWUsIHVzZXJpZCB9ID0gZGF0YQ0KICAgICAgbGV0IHNob3dNYXJrZXIgPSB0aGlzLmlzVG9kYXkodXBkYXRldGltZSkNCiAgICAgIGxldCBleGlzdExheWVyID0gZmVhdHVyZUdyb3VwLmdldExheWVycygpLmZpbmQobGF5ZXIgPT4gbGF5ZXIub3B0aW9ucy5kYXRhLnVzZXJpZCA9PT0gdXNlcmlkKQ0KICAgICAgaWYgKHNob3dNYXJrZXIpIHsNCiAgICAgICAgbGV0IGFjdGl2ZSA9IHRoaXMuaXNBY3RpdmUodXBkYXRldGltZSkNCiAgICAgICAgbGV0IHNyYyA9IGFjdGl2ZSA/IHRoaXMub25saW5lU3JjIDogdGhpcy5vZmZsaW5lU3JjDQogICAgICAgIGxldCBsYXRMbmcgPSBMLmxhdExuZyhsYXQsIGxvbikNCiAgICAgICAgLy8gbGV0IGljb24gPSBMLmljb24oe2ljb25Vcmw6IHNyY30pDQogICAgICAgIGxldCBpY29uID0gTC5kaXZJY29uKHsNCiAgICAgICAgICBodG1sOiBgDQogICAgICAgICAgICAgIDxkaXYgY2xhc3M9J3BlcnNvbi1pY29uLWNvbnRhaW5lcic+DQogICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9J25hbWUnPiR7bmFtZX08L3NwYW4+DQogICAgICAgICAgICAgICAgPGltZyBjbGFzcz0naW1nJyBzcmM9JyR7c3JjfScgLz4NCiAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICBgLA0KICAgICAgICAgIGNsYXNzTmFtZTogJ215LWRpdi1pY29uJywNCiAgICAgICAgICBpY29uU2l6ZTogNjANCiAgICAgICAgfSkNCg0KICAgICAgICBpZiAoZXhpc3RMYXllcikgew0KICAgICAgICAgIGV4aXN0TGF5ZXIuc2V0TGF0TG5nKGxhdExuZykNCiAgICAgICAgICBleGlzdExheWVyLnNldEljb24oaWNvbikNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBmZWF0dXJlR3JvdXAuYWRkTGF5ZXIoTC5tYXJrZXIobGF0TG5nLCB7IGljb24sIGRhdGEgfSkpDQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGlmIChleGlzdExheWVyKSB7DQogICAgICAgICAgZmVhdHVyZUdyb3VwLnJlbW92ZUxheWVyKGV4aXN0TGF5ZXIpDQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9LA0KICAgIHRvQmFjaygpIHsNCiAgICAgIHRoaXMuJHJvdXRlci5nbygtMSkNCiAgICB9DQogIH0NCn0NCg=="},{"version":3,"sources":["personMap.vue"],"names":[],"mappings":";AAkBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"personMap.vue","sourceRoot":"src/views/overViewMap","sourcesContent":["<template>\r\n  <div :style=\"{ height: scrollerHeight, position: 'relative' }\">\r\n    <LeafLetMap ref=\"leafLetMapRef\"></LeafLetMap>\r\n    <div class=\"to-back\" @click=\"toBack()\"></div>\r\n    <div class=\"legend\">\r\n      <van-row class=\"item\">\r\n        <van-col class=\"img-conatiner\" span=\"12\"><img class=\"img\" :src=\"onlineSrc\"/></van-col>\r\n        <van-col span=\"12\">在线</van-col>\r\n      </van-row>\r\n      <van-row class=\"item\">\r\n        <van-col class=\"img-conatiner\" span=\"12\"><img class=\"img\" :src=\"offlineSrc\"/></van-col>\r\n        <van-col span=\"12\">离线</van-col>\r\n      </van-row>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport LeafLetMap from '@/components/map/LeafLetMap.vue'\r\nimport { getAllUserOnline } from '@/api/project'\r\nlet featureGroup\r\nexport default {\r\n  computed: {\r\n    scrollerHeight: function() {\r\n      return window.innerHeight + 'px'\r\n    }\r\n  },\r\n  components: {\r\n    LeafLetMap\r\n  },\r\n  data() {\r\n    return {\r\n      isFirstIn: true,\r\n      canInit: true,\r\n      interval: null,\r\n      onlineSrc: require('../../assets/image/marker/online.png'),\r\n      offlineSrc: require('../../assets/image/marker/offline.png')\r\n    }\r\n  },\r\n  destroyed() {\r\n    this.interval && clearInterval(this.interval)\r\n  },\r\n  mounted() {\r\n    featureGroup = L.markerClusterGroup([]).addTo(leafLetMap)\r\n    this.init()\r\n    if (!this.interval) {\r\n      this.interval = setInterval(() => {\r\n        this.init()\r\n      }, 1000 * 10)\r\n    }\r\n  },\r\n  methods: {\r\n    init() {\r\n      if (this.canInit) {\r\n        this.canInit = false\r\n        getAllUserOnline().then(data => {\r\n          this.canInit = true\r\n          this.drawPerson(data)\r\n        })\r\n      }\r\n    },\r\n    drawPerson(data) {\r\n      data.forEach(item => {\r\n        let { lon, lat, name, updatetime } = item\r\n        lon && lat && updatetime && this.draw(item)\r\n      })\r\n      if (this.$store.state.locatePersonName) {\r\n        let marker = featureGroup\r\n          .getLayers()\r\n          .find(layer => layer.options.data.name === this.$store.state.locatePersonName)\r\n        if (marker) {\r\n          leafLetMap.flyTo(marker.getLatLng(), leafLetMap.getMaxZoom())\r\n        }\r\n        this.$store.state.locatePersonName = ''\r\n        this.isFirstIn = false\r\n      } else {\r\n        if (this.isFirstIn) {\r\n          this.isFirstIn = false\r\n          leafLetMap.fitBounds(featureGroup.getBounds())\r\n        }\r\n      }\r\n    },\r\n    isToday(str) {\r\n      var d = new Date(str.replace(/-/g, '/'))\r\n      var todaysDate = new Date()\r\n      if (d.setHours(0, 0, 0, 0) == todaysDate.setHours(0, 0, 0, 0)) {\r\n        return true\r\n      } else {\r\n        return false\r\n      }\r\n    },\r\n    isActive(updatetime) {\r\n      return updatetime && Math.abs(new Date(updatetime.replace(/-/g, '/')) - new Date()) < 1000 * 60 * 3\r\n    },\r\n    draw(data) {\r\n      let { lon, lat, name, updatetime, userid } = data\r\n      let showMarker = this.isToday(updatetime)\r\n      let existLayer = featureGroup.getLayers().find(layer => layer.options.data.userid === userid)\r\n      if (showMarker) {\r\n        let active = this.isActive(updatetime)\r\n        let src = active ? this.onlineSrc : this.offlineSrc\r\n        let latLng = L.latLng(lat, lon)\r\n        // let icon = L.icon({iconUrl: src})\r\n        let icon = L.divIcon({\r\n          html: `\r\n              <div class='person-icon-container'>\r\n                <span class='name'>${name}</span>\r\n                <img class='img' src='${src}' />\r\n              </div>\r\n            `,\r\n          className: 'my-div-icon',\r\n          iconSize: 60\r\n        })\r\n\r\n        if (existLayer) {\r\n          existLayer.setLatLng(latLng)\r\n          existLayer.setIcon(icon)\r\n        } else {\r\n          featureGroup.addLayer(L.marker(latLng, { icon, data }))\r\n        }\r\n      } else {\r\n        if (existLayer) {\r\n          featureGroup.removeLayer(existLayer)\r\n        }\r\n      }\r\n    },\r\n    toBack() {\r\n      this.$router.go(-1)\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.to-back {\r\n  position: absolute;\r\n  width: 30px;\r\n  height: 30px;\r\n  border-radius: 50%;\r\n  top: 10px;\r\n  left: 10px;\r\n  // border: 1px solid #c9c9c9;\r\n  // background-color: #fff;\r\n  background: #fff url(../../assets/image/back.png) 40% 50% no-repeat;\r\n  text-align: center;\r\n  line-height: 30px;\r\n  z-index: 9999;\r\n  box-shadow: 0px 0px 5px 0px rgba(147, 160, 177, 0.4);\r\n}\r\n.legend {\r\n  background-color: #fff;\r\n  box-shadow: 0px 0px 5px 0px rgba(147, 160, 177, 0.4);\r\n  border-radius: 5px;\r\n  z-index: 9999;\r\n  position: absolute;\r\n  bottom: 10px;\r\n  left: 10px;\r\n  .item {\r\n    height: 40px;\r\n    line-height: 40px;\r\n    width: 80px;\r\n    .img-conatiner {\r\n      height: 40px;\r\n      line-height: 40px;\r\n      text-align: center;\r\n      .img {\r\n        margin-top: 8px;\r\n        height: 22px;\r\n      }\r\n    }\r\n  }\r\n}\r\n::v-deep .my-div-icon {\r\n  .person-icon-container {\r\n    text-align: center;\r\n    .name {\r\n      text-shadow: -1px 0 white, 0 1px white, 1px 0 white, 0 -1px white;\r\n    }\r\n    .img {\r\n      margin-top: 2px;\r\n      // width: 27px;\r\n    }\r\n  }\r\n}\r\n</style>\r\n"]}]}