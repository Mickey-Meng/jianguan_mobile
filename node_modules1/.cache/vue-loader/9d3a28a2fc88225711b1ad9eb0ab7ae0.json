{"remainingRequest":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\src\\views\\overViewMap\\personMap.vue?vue&type=style&index=0&id=293bc091&lang=scss&scoped=true&","dependencies":[{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\src\\views\\overViewMap\\personMap.vue","mtime":1684246187992},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\css-loader\\dist\\cjs.js","mtime":1684411443176},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1684411446724},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\postcss-loader\\src\\index.js","mtime":1684411443221},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1684411446938},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1684411445150},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":1684411444634}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQoudG8tYmFjayB7DQogIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgd2lkdGg6IDMwcHg7DQogIGhlaWdodDogMzBweDsNCiAgYm9yZGVyLXJhZGl1czogNTAlOw0KICB0b3A6IDEwcHg7DQogIGxlZnQ6IDEwcHg7DQogIC8vIGJvcmRlcjogMXB4IHNvbGlkICNjOWM5Yzk7DQogIC8vIGJhY2tncm91bmQtY29sb3I6ICNmZmY7DQogIGJhY2tncm91bmQ6ICNmZmYgdXJsKC4uLy4uL2Fzc2V0cy9pbWFnZS9iYWNrLnBuZykgNDAlIDUwJSBuby1yZXBlYXQ7DQogIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgbGluZS1oZWlnaHQ6IDMwcHg7DQogIHotaW5kZXg6IDk5OTk7DQogIGJveC1zaGFkb3c6IDBweCAwcHggNXB4IDBweCByZ2JhKDE0NywgMTYwLCAxNzcsIDAuNCk7DQp9DQoubGVnZW5kIHsNCiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsNCiAgYm94LXNoYWRvdzogMHB4IDBweCA1cHggMHB4IHJnYmEoMTQ3LCAxNjAsIDE3NywgMC40KTsNCiAgYm9yZGVyLXJhZGl1czogNXB4Ow0KICB6LWluZGV4OiA5OTk5Ow0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIGJvdHRvbTogMTBweDsNCiAgbGVmdDogMTBweDsNCiAgLml0ZW0gew0KICAgIGhlaWdodDogNDBweDsNCiAgICBsaW5lLWhlaWdodDogNDBweDsNCiAgICB3aWR0aDogODBweDsNCiAgICAuaW1nLWNvbmF0aW5lciB7DQogICAgICBoZWlnaHQ6IDQwcHg7DQogICAgICBsaW5lLWhlaWdodDogNDBweDsNCiAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICAgIC5pbWcgew0KICAgICAgICBtYXJnaW4tdG9wOiA4cHg7DQogICAgICAgIGhlaWdodDogMjJweDsNCiAgICAgIH0NCiAgICB9DQogIH0NCn0NCjo6di1kZWVwIC5teS1kaXYtaWNvbiB7DQogIC5wZXJzb24taWNvbi1jb250YWluZXIgew0KICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICAubmFtZSB7DQogICAgICB0ZXh0LXNoYWRvdzogLTFweCAwIHdoaXRlLCAwIDFweCB3aGl0ZSwgMXB4IDAgd2hpdGUsIDAgLTFweCB3aGl0ZTsNCiAgICB9DQogICAgLmltZyB7DQogICAgICBtYXJnaW4tdG9wOiAycHg7DQogICAgICAvLyB3aWR0aDogMjdweDsNCiAgICB9DQogIH0NCn0NCg=="},{"version":3,"sources":["personMap.vue"],"names":[],"mappings":";AAsIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"personMap.vue","sourceRoot":"src/views/overViewMap","sourcesContent":["<template>\r\n  <div :style=\"{ height: scrollerHeight, position: 'relative' }\">\r\n    <LeafLetMap ref=\"leafLetMapRef\"></LeafLetMap>\r\n    <div class=\"to-back\" @click=\"toBack()\"></div>\r\n    <div class=\"legend\">\r\n      <van-row class=\"item\">\r\n        <van-col class=\"img-conatiner\" span=\"12\"><img class=\"img\" :src=\"onlineSrc\"/></van-col>\r\n        <van-col span=\"12\">在线</van-col>\r\n      </van-row>\r\n      <van-row class=\"item\">\r\n        <van-col class=\"img-conatiner\" span=\"12\"><img class=\"img\" :src=\"offlineSrc\"/></van-col>\r\n        <van-col span=\"12\">离线</van-col>\r\n      </van-row>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport LeafLetMap from '@/components/map/LeafLetMap.vue'\r\nimport { getAllUserOnline } from '@/api/project'\r\nlet featureGroup\r\nexport default {\r\n  computed: {\r\n    scrollerHeight: function() {\r\n      return window.innerHeight + 'px'\r\n    }\r\n  },\r\n  components: {\r\n    LeafLetMap\r\n  },\r\n  data() {\r\n    return {\r\n      isFirstIn: true,\r\n      canInit: true,\r\n      interval: null,\r\n      onlineSrc: require('../../assets/image/marker/online.png'),\r\n      offlineSrc: require('../../assets/image/marker/offline.png')\r\n    }\r\n  },\r\n  destroyed() {\r\n    this.interval && clearInterval(this.interval)\r\n  },\r\n  mounted() {\r\n    featureGroup = L.markerClusterGroup([]).addTo(leafLetMap)\r\n    this.init()\r\n    if (!this.interval) {\r\n      this.interval = setInterval(() => {\r\n        this.init()\r\n      }, 1000 * 10)\r\n    }\r\n  },\r\n  methods: {\r\n    init() {\r\n      if (this.canInit) {\r\n        this.canInit = false\r\n        getAllUserOnline().then(data => {\r\n          this.canInit = true\r\n          this.drawPerson(data)\r\n        })\r\n      }\r\n    },\r\n    drawPerson(data) {\r\n      data.forEach(item => {\r\n        let { lon, lat, name, updatetime } = item\r\n        lon && lat && updatetime && this.draw(item)\r\n      })\r\n      if (this.$store.state.locatePersonName) {\r\n        let marker = featureGroup\r\n          .getLayers()\r\n          .find(layer => layer.options.data.name === this.$store.state.locatePersonName)\r\n        if (marker) {\r\n          leafLetMap.flyTo(marker.getLatLng(), leafLetMap.getMaxZoom())\r\n        }\r\n        this.$store.state.locatePersonName = ''\r\n        this.isFirstIn = false\r\n      } else {\r\n        if (this.isFirstIn) {\r\n          this.isFirstIn = false\r\n          leafLetMap.fitBounds(featureGroup.getBounds())\r\n        }\r\n      }\r\n    },\r\n    isToday(str) {\r\n      var d = new Date(str.replace(/-/g, '/'))\r\n      var todaysDate = new Date()\r\n      if (d.setHours(0, 0, 0, 0) == todaysDate.setHours(0, 0, 0, 0)) {\r\n        return true\r\n      } else {\r\n        return false\r\n      }\r\n    },\r\n    isActive(updatetime) {\r\n      return updatetime && Math.abs(new Date(updatetime.replace(/-/g, '/')) - new Date()) < 1000 * 60 * 3\r\n    },\r\n    draw(data) {\r\n      let { lon, lat, name, updatetime, userid } = data\r\n      let showMarker = this.isToday(updatetime)\r\n      let existLayer = featureGroup.getLayers().find(layer => layer.options.data.userid === userid)\r\n      if (showMarker) {\r\n        let active = this.isActive(updatetime)\r\n        let src = active ? this.onlineSrc : this.offlineSrc\r\n        let latLng = L.latLng(lat, lon)\r\n        // let icon = L.icon({iconUrl: src})\r\n        let icon = L.divIcon({\r\n          html: `\r\n              <div class='person-icon-container'>\r\n                <span class='name'>${name}</span>\r\n                <img class='img' src='${src}' />\r\n              </div>\r\n            `,\r\n          className: 'my-div-icon',\r\n          iconSize: 60\r\n        })\r\n\r\n        if (existLayer) {\r\n          existLayer.setLatLng(latLng)\r\n          existLayer.setIcon(icon)\r\n        } else {\r\n          featureGroup.addLayer(L.marker(latLng, { icon, data }))\r\n        }\r\n      } else {\r\n        if (existLayer) {\r\n          featureGroup.removeLayer(existLayer)\r\n        }\r\n      }\r\n    },\r\n    toBack() {\r\n      this.$router.go(-1)\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.to-back {\r\n  position: absolute;\r\n  width: 30px;\r\n  height: 30px;\r\n  border-radius: 50%;\r\n  top: 10px;\r\n  left: 10px;\r\n  // border: 1px solid #c9c9c9;\r\n  // background-color: #fff;\r\n  background: #fff url(../../assets/image/back.png) 40% 50% no-repeat;\r\n  text-align: center;\r\n  line-height: 30px;\r\n  z-index: 9999;\r\n  box-shadow: 0px 0px 5px 0px rgba(147, 160, 177, 0.4);\r\n}\r\n.legend {\r\n  background-color: #fff;\r\n  box-shadow: 0px 0px 5px 0px rgba(147, 160, 177, 0.4);\r\n  border-radius: 5px;\r\n  z-index: 9999;\r\n  position: absolute;\r\n  bottom: 10px;\r\n  left: 10px;\r\n  .item {\r\n    height: 40px;\r\n    line-height: 40px;\r\n    width: 80px;\r\n    .img-conatiner {\r\n      height: 40px;\r\n      line-height: 40px;\r\n      text-align: center;\r\n      .img {\r\n        margin-top: 8px;\r\n        height: 22px;\r\n      }\r\n    }\r\n  }\r\n}\r\n::v-deep .my-div-icon {\r\n  .person-icon-container {\r\n    text-align: center;\r\n    .name {\r\n      text-shadow: -1px 0 white, 0 1px white, 1px 0 white, 0 -1px white;\r\n    }\r\n    .img {\r\n      margin-top: 2px;\r\n      // width: 27px;\r\n    }\r\n  }\r\n}\r\n</style>\r\n"]}]}