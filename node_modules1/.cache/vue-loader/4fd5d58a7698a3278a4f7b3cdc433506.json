{"remainingRequest":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\src\\views\\project\\quality\\processFilling.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\src\\views\\project\\quality\\processFilling.vue","mtime":1684246188041},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1684411445150},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\babel-loader\\lib\\index.js","mtime":1684411446344},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1684411445150},{"path":"E:\\Workspace\\JianGuan\\jianguan_mobile\\mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":1684411444634}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgU2VsZWN0ZXIgZnJvbSAnQC9jb21wb25lbnRzL2NvbW1vbi9TZWxlY3RlcicNCmltcG9ydCBQZGZQcmV2aWV3IGZyb20gJ0AvY29tcG9uZW50cy9QZGZQcmV2aWV3Jw0KaW1wb3J0IFVwbG9hZCBmcm9tICdAL2NvbXBvbmVudHMvY29tbW9uL1VwbG9hZCcNCmltcG9ydCBDb21wb25lbnRTZWxlY3QgZnJvbSAnQC9jb21wb25lbnRzL0NvbXBvbmVudFNlbGVjdCcNCmltcG9ydCB7IGZvcm1hdElTTzg2MDFUaW1lIH0gZnJvbSAnQC91dGlscy9pbmRleCcNCmltcG9ydCB7IGdldENoZWNrZXIsIGFkZFJlY29kZSwgdXBkYXRlUmVjb2RlLCBnZXRBbGxjaGVja0RhdGEgfSBmcm9tICdAL2FwaS9wcm9qZWN0LmpzJw0KZXhwb3J0IGRlZmF1bHQgew0KICBjb21wb25lbnRzOiB7DQogICAgQ29tcG9uZW50U2VsZWN0LA0KICAgIFVwbG9hZCwNCiAgICBQZGZQcmV2aWV3LA0KICAgIFNlbGVjdGVyDQogIH0sDQogIGNvbXB1dGVkOiB7DQogICAgc2Nyb2xsZXJIZWlnaHQ6IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuIHdpbmRvdy5pbm5lckhlaWdodCAtIDE0NiArICdweCcNCiAgICB9DQogIH0sDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIHNob3c6IGZhbHNlLA0KICAgICAgY29tcG9uZW50TmFtZTogJycsDQogICAgICB1cmxMaXN0OiBbXSwNCiAgICAgIGFjY3JlY29kZXVybExpc3Q6IFtdLA0KICAgICAgZWRpdGFibGU6IHRydWUsDQogICAgICBlZGl0RGF0YToge30sDQogICAgICBzaG93Q2hlY2tNYW46IGZhbHNlLA0KICAgICAgY2hlY2tNYW5zOiBbXSwNCiAgICAgIHNob3dQaWNrZXI6IGZhbHNlLA0KICAgICAgZm9ybWF0SVNPODYwMVRpbWUsDQogICAgICBjb21wb25lbnQ6IG51bGwsDQogICAgICBjaGVja0RhdGE6IG51bGwsDQogICAgICBjdXJyZW50RGF0ZTogbmV3IERhdGUoKSwNCg0KICAgICAgbGlzdDogW10sDQogICAgICBmaW5pc2hlZDogZmFsc2UsDQogICAgICByZWZyZXNoaW5nOiBmYWxzZSwNCg0KICAgICAgc2VhcmNoVmFsdWU6ICcnLA0KICAgICAgc2VsZWN0czogW10sDQoNCiAgICAgIGlzVXBkYXRlOiBmYWxzZQ0KICAgIH0NCiAgfSwNCiAgd2F0Y2g6IHsNCiAgICBzZWFyY2hWYWx1ZTogZnVuY3Rpb24oKSB7DQogICAgICB0aGlzLndhdGNoRnVuYyg1MDAsICgpID0+IHsNCiAgICAgICAgdGhpcy5zZWFyY2goKQ0KICAgICAgfSkNCiAgICB9DQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICB3YXRjaEZ1bmMoZGVsYXlUaW1lLCBmdW5jKSB7DQogICAgICBpZiAoIXRoaXMubGFzdFRpbWUpIHsNCiAgICAgICAgdGhpcy5sYXN0VGltZSA9IHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgIGZ1bmMoKQ0KICAgICAgICB9LCBkZWxheVRpbWUpDQogICAgICB9IGVsc2Ugew0KICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5sYXN0VGltZSkNCiAgICAgICAgdGhpcy5sYXN0VGltZSA9IHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgIGZ1bmMoKQ0KICAgICAgICB9LCBkZWxheVRpbWUpDQogICAgICB9DQogICAgfSwNCiAgICBzZWFyY2goKSB7DQogICAgICBsZXQgdGVtcHMgPSBbXQ0KICAgICAgdGhpcy5jaGVja01hbnMuZm9yRWFjaChpdGVtID0+IHsNCiAgICAgICAgbGV0IG5hbWUgPSBpdGVtLm5hbWUNCiAgICAgICAgaWYgKG5hbWUuaW5kZXhPZih0aGlzLnNlYXJjaFZhbHVlKSAhPT0gLTEpIHsNCiAgICAgICAgICB0ZW1wcy5wdXNoKGl0ZW0pDQogICAgICAgIH0NCiAgICAgICAgdGhpcy5zZWxlY3RzID0gdGVtcHMNCiAgICAgIH0pDQogICAgfSwNCiAgICBvbkNvbXBvbmVudFNlbGVjdChpdGVtLCBjaGVja0RhdGEsIGlzVXBkYXRlKSB7DQogICAgICB0aGlzLmlzVXBkYXRlID0gaXNVcGRhdGUNCiAgICAgIHRoaXMuc2hvdyA9IHRydWUNCiAgICAgIHRoaXMuY29tcG9uZW50TmFtZSA9IGl0ZW0ubmFtZQ0KICAgICAgdGhpcy5jb21wb25lbnQgPSBpdGVtDQogICAgICB0aGlzLmNoZWNrRGF0YSA9IGNoZWNrRGF0YQ0KICAgICAgdGhpcy5nZXRBbGxDaGVja2VyKCkNCiAgICB9LA0KICAgIG9uQ29uZmlybSh0aW1lKSB7DQogICAgICB0aGlzLnNob3dQaWNrZXIgPSBmYWxzZQ0KICAgICAgdGhpcy5lZGl0RGF0YS51cGxvYWR0aW1lID0gdGhpcy5mb3JtYXRJU084NjAxVGltZShuZXcgRGF0ZSh0aW1lKS50b0pTT04oKSkNCiAgICB9LA0KICAgIG9uU2VsZWN0KGl0ZW0pIHsNCiAgICAgIHRoaXMuc2hvd0NoZWNrTWFuID0gZmFsc2UNCiAgICAgIHRoaXMuZWRpdERhdGEuY2hlY2t1c2VybmFtZSA9IGl0ZW0ubmFtZQ0KICAgICAgdGhpcy5lZGl0RGF0YS5jaGVja2lkID0gaXRlbS5pZA0KICAgIH0sDQogICAgZ2V0QWxsQ2hlY2tlcigpIHsNCiAgICAgIGdldENoZWNrZXIoeyBncm91cDogdGhpcy5jaGVja0RhdGEuY29ucG9uZW50Y29kZSxwcm9qZWN0SWQ6IHRoaXMuJHN0b3JlLnN0YXRlLmN1cnJlbnRCaWFvRHVhbi5pZCB9KS50aGVuKGRhdGEgPT4gew0KICAgICAgICB0aGlzLmNoZWNrTWFucyA9IFtdDQogICAgICAgIGRhdGEuZm9yRWFjaChpdGVtID0+IHsNCiAgICAgICAgICB0aGlzLmNoZWNrTWFucy5wdXNoKGl0ZW0pDQogICAgICAgIH0pDQogICAgICAgIHRoaXMuc2VsZWN0cyA9IHRoaXMuY2hlY2tNYW5zDQogICAgICB9KQ0KICAgIH0sDQogICAgb25TdWJtaXQodmFsdWVzKSB7DQogICAgICBsZXQgdGVtcCA9IFtdDQogICAgICB2YWx1ZXMuYWNjcmVjb2RldXJsLmZvckVhY2goaXRlbSA9PiB7DQogICAgICAgIGl0ZW0udXJsICYmIHRlbXAucHVzaChpdGVtLnVybCkNCiAgICAgIH0pDQogICAgICBpZiAodmFsdWVzLmFjY3JlY29kZXVybC5sZW5ndGggIT09IHRlbXAubGVuZ3RoKSB7DQogICAgICAgIHJldHVybiB0aGlzLiRub3RpZnkoeyB0eXBlOiAnd2FybmluZycsIG1lc3NhZ2U6ICfor7fkuIrkvKDkuL7niYznhafniYfmiJbnrYnlvoXnhafniYfkuIrkvKDlrozmiJDvvIEnIH0pDQogICAgICB9DQogICAgICB2YWx1ZXMuYWNjcmVjb2RldXJsID0gdGVtcC5qb2luKCcsJykNCg0KICAgICAgbGV0IF90ZW1wID0gW10NCiAgICAgIHZhbHVlcy5yZW1hcmsuZm9yRWFjaChpdGVtID0+IHsNCiAgICAgICAgaXRlbS51cmwgJiYgX3RlbXAucHVzaChpdGVtLnVybCkNCiAgICAgIH0pDQogICAgICBpZiAodmFsdWVzLnJlbWFyay5sZW5ndGggIT09IF90ZW1wLmxlbmd0aCkgew0KICAgICAgICByZXR1cm4gdGhpcy4kbm90aWZ5KHsgdHlwZTogJ3dhcm5pbmcnLCBtZXNzYWdlOiAn6K+3562J5b6FUERG5LiK5Lyg5a6M5oiQ77yBJyB9KQ0KICAgICAgfQ0KICAgICAgdmFsdWVzLnJlbWFyayA9IF90ZW1wLmpvaW4oJywnKQ0KICAgICAgdmFsdWVzID0gew0KICAgICAgICAuLi57DQogICAgICAgICAgcHJvamVjdElkOiB0aGlzLiRzdG9yZS5zdGF0ZS5jdXJyZW50Qmlhb0R1YW4uaWQsDQogICAgICAgICAgY29ucG9lbnRpZDogdGhpcy5jaGVja0RhdGEuY29ucG9uZW50aWQsDQogICAgICAgICAgY29ucG9uZW50bmFtZTogdGhpcy5jaGVja0RhdGEuY29ucG9uZW50dHlwZW5hbWUsDQogICAgICAgICAgY29ucG9uZW50dHlwZTogdGhpcy5jaGVja0RhdGEuY29ucG9uZW50dHlwZSwNCiAgICAgICAgICBwcm9qZWN0Y29kZTogdGhpcy5jaGVja0RhdGEucHJvamVjdGNvZGUsDQogICAgICAgICAgcHJvZHVjZWlkOiB0aGlzLmNvbXBvbmVudC5wcm9kdWNlaWQsDQogICAgICAgICAgcHJvZHVjZWlkbmFtZTogdGhpcy5jb21wb25lbnQubmFtZSwNCiAgICAgICAgICB1cGRhdGV1c2VybmFtZTogdGhpcy4kc3RvcmUuc3RhdGUudXNlcmluZm8ubmFtZQ0KICAgICAgICB9LA0KICAgICAgICAuLi52YWx1ZXMNCiAgICAgIH0NCiAgICAgIHZhbHVlcyA9IHsgLi4udmFsdWVzLCAuLi50aGlzLmVkaXREYXRhIH0NCiAgICAgIGlmICh0aGlzLmlzVXBkYXRlKSB7DQogICAgICAgIHZhbHVlcy5yZWNvZGVpZCA9IHRoaXMuY29tcG9uZW50LnJlY29yZGlkDQogICAgICAgIHVwZGF0ZVJlY29kZSh2YWx1ZXMpLnRoZW4oZGF0YSA9PiB7DQogICAgICAgICAgdGhpcy4kcmVmc1snY29tcG9uZW50U2VsZWN0J10ub25Mb2FkKCkNCiAgICAgICAgICB0aGlzLnNob3cgPSBmYWxzZQ0KICAgICAgICAgIHRoaXMuJG5vdGlmeSh7IHR5cGU6ICdzdWNjZXNzJywgbWVzc2FnZTogJ+aPkOS6pOaIkOWKn++8gScgfSkNCiAgICAgICAgfSkNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGFkZFJlY29kZSh2YWx1ZXMpLnRoZW4oZGF0YSA9PiB7DQogICAgICAgICAgdGhpcy4kcmVmc1snY29tcG9uZW50U2VsZWN0J10ub25Mb2FkKCkNCiAgICAgICAgICB0aGlzLnNob3cgPSBmYWxzZQ0KICAgICAgICAgIHRoaXMuJG5vdGlmeSh7IHR5cGU6ICdzdWNjZXNzJywgbWVzc2FnZTogJ+aPkOS6pOaIkOWKn++8gScgfSkNCiAgICAgICAgfSkNCiAgICAgIH0NCiAgICAgIC8vIGNvbnNvbGUubG9nKHZhbHVlcykNCiAgICB9LA0KDQogICAgb25Mb2FkKCkgew0KICAgICAgbGV0IHRoYXQgPSB0aGlzDQogICAgICBnZXRBbGxjaGVja0RhdGEoeyB0eXBlOiAyIH0pLnRoZW4oZGF0YSA9PiB7DQogICAgICAgIHRoYXQubGlzdCA9IGRhdGEuc29ydChmdW5jdGlvbihhLCBiKSB7DQogICAgICAgICAgcmV0dXJuIERhdGUucGFyc2UoYlsndXBsb2FkdGltZSddKSAtIERhdGUucGFyc2UoYVsndXBsb2FkdGltZSddKQ0KICAgICAgICB9KQ0KICAgICAgICB0aGF0LnJlZnJlc2hpbmcgPSBmYWxzZQ0KICAgICAgICB0aGlzLmZpbmlzaGVkID0gdHJ1ZQ0KICAgICAgfSkNCiAgICB9LA0KICAgIHByZXZpZXdQaWMoaXRlbSwgZmllbGQpIHsNCiAgICAgIHRoaXMuJHJlZnNbJ3BkZlByZXZpZXcnXS5zaG93UGljKGl0ZW0ucmVjb2RlaWQsIGZpZWxkKQ0KICAgIH0sDQogICAgcHJldmlld1BkZihpdGVtLCBmaWVsZCkgew0KICAgICAgdGhpcy4kcmVmc1sncGRmUHJldmlldyddLnNob3coaXRlbS5yZWNvZGVpZCwgZmllbGQpDQogICAgfQ0KICB9DQp9DQo="},{"version":3,"sources":["processFilling.vue"],"names":[],"mappings":";AA6IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"processFilling.vue","sourceRoot":"src/views/project/quality","sourcesContent":["<template>\r\n  <div class=\"process-filling\">\r\n    <van-tabs>\r\n      <van-tab title=\"工序填报\">\r\n        <component-select ref=\"componentSelect\" :onComponentSelect=\"onComponentSelect\"> </component-select>\r\n      </van-tab>\r\n      <van-tab title=\"填报记录\">\r\n        <van-list\r\n          :finished=\"finished\"\r\n          finished-text=\"我也是有底线的~~\"\r\n          @load=\"onLoad\"\r\n          class=\"common-list common-card\"\r\n          :style=\"{ height: scrollerHeight }\"\r\n        >\r\n          <div v-for=\"(item, index) in list\" :key=\"index\" :class=\"'item ' + (index === list.length - 1 ? 'last' : '')\">\r\n            <div class=\"content\">\r\n              <span class=\"name\">构件编码：</span>\r\n              <span class=\"value\">{{ item.conponentcode }}</span>\r\n            </div>\r\n            <div class=\"content\">\r\n              <span class=\"name\">构件名称：</span>\r\n              <span class=\"value\">{{ item.conponentname }}</span>\r\n            </div>\r\n            <div class=\"content\">\r\n              <span class=\"name\">工序名称：</span>\r\n              <span class=\"value\">{{ item.producename }}</span>\r\n            </div>\r\n            <div class=\"content\">\r\n              <span class=\"name\">填报时间：</span>\r\n              <span class=\"value\">{{ item.stime ? formatISO8601Time(item.stime) : '' }}</span>\r\n            </div>\r\n            <div class=\"content\" v-if=\"item.checkusername\">\r\n              <span class=\"name\">审核人：</span>\r\n              <span class=\"value\">{{ item.checkusername }}</span>\r\n            </div>\r\n            <div class=\"content\" v-if=\"item.updatetime\">\r\n              <span class=\"name\">审核时间：</span>\r\n              <span class=\"value\">{{ item.updatetime ? formatISO8601Time(item.updatetime) : '' }}</span>\r\n            </div>\r\n            <div class=\"content\">\r\n              <span class=\"name\">审核状态：</span>\r\n              <span :class=\"'value ' + ['common-state-1', 'common-state-2', 'common-state-0'][item.checkresult - 1]\">{{\r\n                ['审核通过', '监理驳回', '正在审核'][item.checkresult - 1]\r\n              }}</span>\r\n            </div>\r\n            <div class=\"content\" style=\"text-align: center;\">\r\n              <!-- <span class=\"name\">操作：</span> -->\r\n              <van-button class=\"button\" type=\"primary\" size=\"small\" @click.stop=\"previewPic(item)\"\r\n                >举牌照片</van-button\r\n              >\r\n              <van-button\r\n                style=\"margin-left:10px\"\r\n                class=\"button\"\r\n                type=\"primary\"\r\n                size=\"small\"\r\n                @click.stop=\"previewPdf(item)\"\r\n                >PDF</van-button\r\n              >\r\n              <van-button\r\n                v-if=\"item.checkresult != 3\"\r\n                style=\"margin-left:10px\"\r\n                class=\"button\"\r\n                type=\"primary\"\r\n                size=\"small\"\r\n                @click.stop=\"previewPic(item, 'testurl')\"\r\n                >审核照片</van-button\r\n              >\r\n              <van-button\r\n                v-if=\"item.checkresult != 3\"\r\n                style=\"margin-left:10px\"\r\n                class=\"button\"\r\n                type=\"primary\"\r\n                size=\"small\"\r\n                @click.stop=\"previewPdf(item, 'standbyrecode')\"\r\n                >审核PDF</van-button\r\n              >\r\n            </div>\r\n            <!-- <div class=\"operate center-in-vertical\">\r\n              <van-button class=\"button\" type=\"primary\" size=\"small\" @click.stop=\"previewPic(item)\">照片</van-button>\r\n              <van-button class=\"button\" type=\"primary\" size=\"small\" @click.stop=\"previewPdf(item)\">PDF</van-button>\r\n            </div> -->\r\n          </div>\r\n        </van-list>\r\n      </van-tab>\r\n    </van-tabs>\r\n\r\n    <van-dialog v-model=\"show\" :title=\"componentName\" :showConfirmButton=\"false\" :closeOnClickOverlay=\"true\">\r\n      <van-form @submit=\"onSubmit\" :v-model=\"editData\" class=\"common-card\">\r\n        <van-field\r\n          v-model=\"editData.uploadtime\"\r\n          is-link\r\n          readonly\r\n          name=\"uploadtime\"\r\n          label=\"完成时间\"\r\n          placeholder=\"点击选择时间\"\r\n          @click=\"showPicker = true\"\r\n          :disabled=\"!editable\"\r\n          :rules=\"[{ required: true, message: '请选择时间' }]\"\r\n        />\r\n        <van-field\r\n          readonly\r\n          clickable\r\n          name=\"checkusername\"\r\n          :value=\"editData.checkusername\"\r\n          label=\"指定监理\"\r\n          :placeholder=\"editable ? '点击选监理' : '无'\"\r\n          @click=\"editable && (showCheckMan = true)\"\r\n          :rules=\"[{ required: true, message: '请选择监理' }]\"\r\n          :disabled=\"!editable\"\r\n        />\r\n        <upload label=\"举牌照片\" name=\"accrecodeurl\" :rules=\"[{ required: true, message: '请选择照片' }]\"></upload>\r\n        <upload diyButton=\"点击选择PDF\" :max-count=\"1\" accept=\"application/pdf\" label=\"PDF\" name=\"remark\"></upload>\r\n        <div style=\"margin: 16px\" v-if=\"editable\">\r\n          <van-button round block type=\"info\" native-type=\"submit\">提交</van-button>\r\n        </div>\r\n      </van-form>\r\n    </van-dialog>\r\n    <van-popup v-model=\"showPicker\" position=\"bottom\">\r\n      <van-datetime-picker v-model=\"currentDate\" type=\"datetime\" @confirm=\"onConfirm\" @cancel=\"showPicker = false\" />\r\n    </van-popup>\r\n    <van-action-sheet v-model=\"showCheckMan\">\r\n      <van-cell-group inset>\r\n        <van-field v-model=\"searchValue\" placeholder=\"搜索\" input-align=\"center\" clearable />\r\n      </van-cell-group>\r\n      <div class=\"van-action-sheet__content\" style=\"max-height:330px;text-align: center;\">\r\n        <button\r\n          v-for=\"(item, index) in selects\"\r\n          :key=\"index\"\r\n          type=\"button\"\r\n          class=\"van-action-sheet__item\"\r\n          @click=\"onSelect(item)\"\r\n        >\r\n          <span class=\"van-action-sheet__name\">{{ item.name }}</span>\r\n        </button>\r\n        <span style=\"height:200px;line-height: 200px;font-size: 16px\" v-if=\"selects.length === 0\">没有相关数据！</span>\r\n      </div>\r\n    </van-action-sheet>\r\n    <PdfPreview ref=\"pdfPreview\"></PdfPreview>\r\n  </div>\r\n</template>\r\n<script>\r\nimport Selecter from '@/components/common/Selecter'\r\nimport PdfPreview from '@/components/PdfPreview'\r\nimport Upload from '@/components/common/Upload'\r\nimport ComponentSelect from '@/components/ComponentSelect'\r\nimport { formatISO8601Time } from '@/utils/index'\r\nimport { getChecker, addRecode, updateRecode, getAllcheckData } from '@/api/project.js'\r\nexport default {\r\n  components: {\r\n    ComponentSelect,\r\n    Upload,\r\n    PdfPreview,\r\n    Selecter\r\n  },\r\n  computed: {\r\n    scrollerHeight: function() {\r\n      return window.innerHeight - 146 + 'px'\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      show: false,\r\n      componentName: '',\r\n      urlList: [],\r\n      accrecodeurlList: [],\r\n      editable: true,\r\n      editData: {},\r\n      showCheckMan: false,\r\n      checkMans: [],\r\n      showPicker: false,\r\n      formatISO8601Time,\r\n      component: null,\r\n      checkData: null,\r\n      currentDate: new Date(),\r\n\r\n      list: [],\r\n      finished: false,\r\n      refreshing: false,\r\n\r\n      searchValue: '',\r\n      selects: [],\r\n\r\n      isUpdate: false\r\n    }\r\n  },\r\n  watch: {\r\n    searchValue: function() {\r\n      this.watchFunc(500, () => {\r\n        this.search()\r\n      })\r\n    }\r\n  },\r\n  methods: {\r\n    watchFunc(delayTime, func) {\r\n      if (!this.lastTime) {\r\n        this.lastTime = setTimeout(() => {\r\n          func()\r\n        }, delayTime)\r\n      } else {\r\n        clearTimeout(this.lastTime)\r\n        this.lastTime = setTimeout(() => {\r\n          func()\r\n        }, delayTime)\r\n      }\r\n    },\r\n    search() {\r\n      let temps = []\r\n      this.checkMans.forEach(item => {\r\n        let name = item.name\r\n        if (name.indexOf(this.searchValue) !== -1) {\r\n          temps.push(item)\r\n        }\r\n        this.selects = temps\r\n      })\r\n    },\r\n    onComponentSelect(item, checkData, isUpdate) {\r\n      this.isUpdate = isUpdate\r\n      this.show = true\r\n      this.componentName = item.name\r\n      this.component = item\r\n      this.checkData = checkData\r\n      this.getAllChecker()\r\n    },\r\n    onConfirm(time) {\r\n      this.showPicker = false\r\n      this.editData.uploadtime = this.formatISO8601Time(new Date(time).toJSON())\r\n    },\r\n    onSelect(item) {\r\n      this.showCheckMan = false\r\n      this.editData.checkusername = item.name\r\n      this.editData.checkid = item.id\r\n    },\r\n    getAllChecker() {\r\n      getChecker({ group: this.checkData.conponentcode,projectId: this.$store.state.currentBiaoDuan.id }).then(data => {\r\n        this.checkMans = []\r\n        data.forEach(item => {\r\n          this.checkMans.push(item)\r\n        })\r\n        this.selects = this.checkMans\r\n      })\r\n    },\r\n    onSubmit(values) {\r\n      let temp = []\r\n      values.accrecodeurl.forEach(item => {\r\n        item.url && temp.push(item.url)\r\n      })\r\n      if (values.accrecodeurl.length !== temp.length) {\r\n        return this.$notify({ type: 'warning', message: '请上传举牌照片或等待照片上传完成！' })\r\n      }\r\n      values.accrecodeurl = temp.join(',')\r\n\r\n      let _temp = []\r\n      values.remark.forEach(item => {\r\n        item.url && _temp.push(item.url)\r\n      })\r\n      if (values.remark.length !== _temp.length) {\r\n        return this.$notify({ type: 'warning', message: '请等待PDF上传完成！' })\r\n      }\r\n      values.remark = _temp.join(',')\r\n      values = {\r\n        ...{\r\n          projectId: this.$store.state.currentBiaoDuan.id,\r\n          conpoentid: this.checkData.conponentid,\r\n          conponentname: this.checkData.conponenttypename,\r\n          conponenttype: this.checkData.conponenttype,\r\n          projectcode: this.checkData.projectcode,\r\n          produceid: this.component.produceid,\r\n          produceidname: this.component.name,\r\n          updateusername: this.$store.state.userinfo.name\r\n        },\r\n        ...values\r\n      }\r\n      values = { ...values, ...this.editData }\r\n      if (this.isUpdate) {\r\n        values.recodeid = this.component.recordid\r\n        updateRecode(values).then(data => {\r\n          this.$refs['componentSelect'].onLoad()\r\n          this.show = false\r\n          this.$notify({ type: 'success', message: '提交成功！' })\r\n        })\r\n      } else {\r\n        addRecode(values).then(data => {\r\n          this.$refs['componentSelect'].onLoad()\r\n          this.show = false\r\n          this.$notify({ type: 'success', message: '提交成功！' })\r\n        })\r\n      }\r\n      // console.log(values)\r\n    },\r\n\r\n    onLoad() {\r\n      let that = this\r\n      getAllcheckData({ type: 2 }).then(data => {\r\n        that.list = data.sort(function(a, b) {\r\n          return Date.parse(b['uploadtime']) - Date.parse(a['uploadtime'])\r\n        })\r\n        that.refreshing = false\r\n        this.finished = true\r\n      })\r\n    },\r\n    previewPic(item, field) {\r\n      this.$refs['pdfPreview'].showPic(item.recodeid, field)\r\n    },\r\n    previewPdf(item, field) {\r\n      this.$refs['pdfPreview'].show(item.recodeid, field)\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style lang=\"scss\">\r\n.process-filling {\r\n  height: 100%;\r\n  overflow-y: auto;\r\n  // .common-list {\r\n  //   background-color: transparent;\r\n  //   .item {\r\n  //     background-color: #fff;\r\n  //     border-radius: 3px;\r\n  //   }\r\n  // }\r\n}\r\n</style>\r\n"]}]}