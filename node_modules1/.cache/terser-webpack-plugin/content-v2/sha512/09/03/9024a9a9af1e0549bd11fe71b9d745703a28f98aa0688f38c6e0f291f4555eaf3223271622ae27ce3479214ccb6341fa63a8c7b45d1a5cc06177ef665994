{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"chunk-04cdee96\"],{\"3dda\":function(e,t,a){\"use strict\";a(\"b0c0\");var i=function(){var e=this,t=e._self._c;return t(\"van-field\",{attrs:{label:e.label,name:e.name,rules:e.rules},scopedSlots:e._u([{key:\"input\",fn:function(){return[t(\"van-uploader\",{class:e.editable?\"\":\"no-select\",attrs:{\"preview-full-image\":!1,\"max-count\":e.maxCount,accept:e.accept,deletable:e.editable,\"after-read\":e.afterReadUrl},on:{\"click-preview\":e.clickPreview},scopedSlots:e._u([e.showFileName?{key:\"preview-cover\",fn:function(a){var i=a.file;return[t(\"div\",{staticClass:\"preview-cover van-ellipsis\"},[e._v(e._s(i.name))])]}}:null],null,!0),model:{value:e.list,callback:function(t){e.list=t},expression:\"list\"}},[e.diyButton?t(\"van-button\",{attrs:{icon:\"plus\",type:\"primary\"}},[e._v(e._s(e.diyButton))]):e._e()],1)]},proxy:!0}])})},n=[],o=a(\"ade3\"),r=(a(\"4662\"),a(\"28a2\")),s=(a(\"a9e3\"),a(\"24d2\")),c=a(\"ed08\"),l={components:Object(o[\"a\"])({},r[\"a\"].Component.name,r[\"a\"].Component),props:{diyButton:{type:String,default:\"\"},accept:{type:String,default:\"image/*\"},maxCount:{type:Number,default:9},label:{type:String},name:{type:String},fileList:{type:Array},rules:{type:Array,default:null},editable:{type:Boolean,default:!0},showFileName:{type:Boolean,default:!1}},data:function(){return{list:this.fileList,lookUrl:c[\"g\"]}},methods:{validator:function(){return!0},afterReadUrl:function(e){e.status=\"uploading\",e.message=\"上传中...\";var t=new FileReader;t.readAsDataURL(e.file),t.onload=function(t){var a=t.target[\"result\"].split(\"base64,\")[1];Object(s[\"tb\"])({name:e.file.name,base64:a}).then((function(t){e.url=t,e.status=\"done\",e.message=\"上传成功\"}))}},clickPreview:function(e){var t=this.lookUrl(e.url);Object(r[\"a\"])({images:[t],closeable:!0})}}},u=l,d=(a(\"8fa7\"),a(\"2877\")),f=Object(d[\"a\"])(u,i,n,!1,null,null,null);t[\"a\"]=f.exports},\"3fd5\":function(e,t,a){\"use strict\";a.d(t,\"a\",(function(){return r})),a.d(t,\"b\",(function(){return s}));var i=\"73c8cafe0bf281cfc6685ffed36baf6e\",n=[\"0\",\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\"],o=\"https://t{s}.tianditu.gov.cn/\",r={init:{lon:117.48387645025284,lat:30.66751823064398,height:5e3,heading:0,pitch:-90,roll:0,duration:3},viewerOptions:{orderIndependentTranslucency:!1,contextOptions:{webgl:{alpha:!0}},geocoder:!1,sceneModePicker:!1,baseLayerPicker:!1,terrainProviderViewModels:[],imageryProviderViewModels:[],fullscreenButton:!1},baseLayers:[{name:\"天地图影像\",type:\"URL\",url:o+\"DataServer?T=img_w&x={x}&y={y}&l={z}&tk=\"+i,subdomains:n,minimumLevel:1,maximumLevel:18,image:\"./image/mapSwitch/tdt_img.png\",visible:!1,stGroup:\"天地图影像\"}],layers:[{name:\"影像\",type:\"URL\",clampToGround:!0,url:\"http://101.200.223.171/mapData/zhujishi/DOM_18/{z}/{x}/{y}.png\",visible:!0},{name:\"地形\",type:\"CESIUM_TERRAIN\",clampToGround:!0,url:\"http://101.200.223.171/mapData/zhujishi/DEM\",visible:!0},{name:\"桥\",type:\"C3DTILES\",clampToGround:!0,url:\"http://101.200.223.171/mapData/zhujishi/model/tileset.json\",visible:!0},{name:\"桩\",type:\"C3DTILES\",clampToGround:!0,url:\"http://101.200.223.171/mapData/zhujishi/model1/tileset.json\",visible:!0,switchNone:!0}]},s={init:{zoom:13,center:{x:120.109532,y:29.706018},minZoom:3,maxZoom:17,centerAutoLevel:15,controls:[],crs:\"EPSG:4326\",basemaps:[],operationallayers:[]},baseLayers:[{name:\"标准地图\",type:\"www_tdt\",layer:\"vec\",visible:!0,img:\"tdt_vec.png\",key:[i],crs:\"EPSG4326\"},{name:\"卫星地图\",type:\"www_tdt\",layer:\"img\",visible:!1,img:\"tdt_img.png\",key:[i],crs:\"EPSG4326\"}],layers:[]}},\"4bd3\":function(e,t,a){},\"838e\":function(e,t,a){\"use strict\";a(\"f4b5\")},\"8a8f\":function(e,t,a){\"use strict\";a(\"4bd3\")},\"8fa7\":function(e,t,a){\"use strict\";a(\"c4b6\")},b24d:function(e,t,a){\"use strict\";var i=function(){var e=this;e._self._c;return e._m(0)},n=[function(){var e=this,t=e._self._c;return t(\"div\",{staticClass:\"container\"},[t(\"div\",{staticClass:\"map\",attrs:{id:\"map\"}}),e._v(\" > \")])}],o=(a(\"d3b7\"),a(\"159b\"),a(\"b0c0\"),a(\"14d9\"),a(\"3fd5\")),r={data:function(){return{baseLayers:[],layers:[]}},mounted:function(){this.initMap()},methods:{initMap:function(){var e=this;L.zlskmap.createMap({id:\"map\",data:o[\"b\"].init,success:function(t,a){e.onMapSuccess(t)}})},onMapSuccess:function(e){var t=this;window.leafLetMap=e,o[\"b\"].baseLayers.forEach((function(a){t.getLayer(e,a,!0)})),o[\"b\"].layers.forEach((function(a){t.getLayer(e,a,!1)})),e.on(\"click\",(function(e){}))},getLayer:function(e,t,a){var i=this,n=t.type,o=(t.name,t.visible),r=null;switch(n){case\"tile\":case\"www_tdt\":r=L.zlskmap.layer.createLayer(t);break;case\"wms\":t.crs=t.crs||L.CRS.EPSG4326,r=L.tileLayer.wms(t.url,t);break;case\"wfs\":r=L.wfsLayer(t),r.on(\"click\",(function(e,t){var a=e.layer.feature.id,n=e.layer.feature.properties.name;i.$router.push({path:\"/panorama\",query:{name:n,id:a}})}));break}return r.setZIndex&&(this.layerIndex++,r.setZIndex(this.layerIndex)),a?this.baseLayers.push({params:t,layer:r}):this.layers.push({params:t,layer:r}),o&&r.addTo(e),r},gotoPoint:function(e,t,a,i){leafLetMap.flyTo({lng:e,lat:t},a||17,{duration:i||1.5})}}},s=r,c=(a(\"838e\"),a(\"2877\")),l=Object(c[\"a\"])(s,i,n,!1,null,null,null);t[\"a\"]=l.exports},c4b6:function(e,t,a){},f4b5:function(e,t,a){},fc7a:function(e,t,a){\"use strict\";a.r(t);var i=function(){var e=this,t=e._self._c;return t(\"div\",{style:{height:e.scrollerHeight}},[t(\"div\",{staticClass:\"map\"},[t(\"leaf-let-map\",{ref:\"leafLetMapRef\"})],1),t(\"div\",{staticClass:\"info\"},[t(\"van-form\",{attrs:{\"v-model\":e.clockData},on:{submit:e.onSubmit}},[t(\"p\",{staticClass:\"title\"},[e._v(\"人员信息\")]),t(\"van-cell-group\",{attrs:{inset:\"\"}},[t(\"van-field\",{attrs:{label:\"标段\",readonly:\"\"},model:{value:e.clockData.projectName,callback:function(t){e.$set(e.clockData,\"projectName\",t)},expression:\"clockData.projectName\"}}),t(\"van-field\",{attrs:{label:\"考勤人员\",readonly:\"\"},model:{value:e.clockData.attendancePersonName,callback:function(t){e.$set(e.clockData,\"attendancePersonName\",t)},expression:\"clockData.attendancePersonName\"}}),t(\"van-field\",{attrs:{label:\"所在部门\",readonly:\"\"},model:{value:e.clockData.groupName,callback:function(t){e.$set(e.clockData,\"groupName\",t)},expression:\"clockData.groupName\"}}),e.add?t(\"div\",[t(\"van-field\",{attrs:{label:\"日期时间\",readonly:\"\"},model:{value:e.showTime,callback:function(t){e.showTime=t},expression:\"showTime\"}}),t(\"van-field\",{attrs:{label:\"打卡位置\",readonly:\"\",rows:\"2\",type:\"textarea\"},scopedSlots:e._u([{key:\"right-icon\",fn:function(){return[t(\"van-icon\",{attrs:{name:\"location-o\"},on:{click:e.getLocation}})]},proxy:!0}],null,!1,1986195883),model:{value:e.clockData.clockAddr,callback:function(t){e.$set(e.clockData,\"clockAddr\",t)},expression:\"clockData.clockAddr\"}})],1):t(\"div\",[t(\"van-field\",{attrs:{label:\"打卡时间\",readonly:\"\"},model:{value:e.showTime,callback:function(t){e.showTime=t},expression:\"showTime\"}}),t(\"van-field\",{attrs:{label:\"打卡位置\",readonly:\"\",rows:\"2\",type:\"textarea\"},model:{value:e.clockData.clockAddr,callback:function(t){e.$set(e.clockData,\"clockAddr\",t)},expression:\"clockData.clockAddr\"}})],1)],1),t(\"p\",{staticClass:\"title\"},[e._v(\"签到拍照\")]),e.add?t(\"van-cell-group\",{attrs:{inset:\"\"}},[t(\"upload\",{attrs:{label:\"上传照片\",name:e.picFiled,rules:[{required:!0,message:\"请选择照片\"}],fileList:e.fList,editable:e.add}})],1):t(\"van-cell-group\",{attrs:{inset:\"\"}},[t(\"upload\",{attrs:{label:\"打卡照片\",name:e.picFiled,rules:[{required:!0,message:\"请选择照片\"}],fileList:e.fList,editable:!1}})],1),t(\"div\",{staticClass:\"btn-con\"},[e.add?t(\"van-button\",{attrs:{type:\"primary\"}},[e._v(\"提交\")]):e._e()],1)],1)],1)])},n=[],o=a(\"53ca\"),r=a(\"5530\"),s=(a(\"e9c4\"),a(\"ac1f\"),a(\"5319\"),a(\"b0c0\"),a(\"99af\"),a(\"d3b7\"),a(\"159b\"),a(\"14d9\"),a(\"a15b\"),a(\"2f62\")),c=a(\"c466\"),l=a(\"32d7\"),u=a(\"3dda\"),d=a(\"b24d\"),f=a(\"24d2\"),p=a(\"ed08\"),m=a(\"595b\"),h=(a(\"f1cf\"),{components:{Upload:u[\"a\"],LeafLetMap:d[\"a\"]},computed:Object(r[\"a\"])(Object(r[\"a\"])({},Object(s[\"b\"])([\"userinfo\",\"currentBiaoDuan\"])),{},{scrollerHeight:function(){return window.innerHeight-85+\"px\"}}),data:function(){return{picFiled:\"clockPic\",clockData:{},showTime:\"\",showEndTime:\"\",curLocation:[],curPolygonCoor:[],fences:[],add:!0,fList:[],formatImgUrl:p[\"c\"],lastLocationMarker:null}},created:function(){\"{}\"!=JSON.stringify(this.$route.params)&&(this.fList=this.formatImgUrl(this.$route.params.clockPic))},mounted:function(){if(\"{}\"!=JSON.stringify(this.$route.params))this.add=!1,this.clockData=Object.assign({},this.$route.params),this.showTime=this.$route.params.clockTime?this.$route.params.clockTime.substring(0,19).replace(\"T\",\" \"):\"\",this.mapEcho();else{this.add=!0,this.showTime=Object(c[\"d\"])();var e=this.moment().utc().toISOString();this.$set(this.clockData,\"clockTime\",e),this.$set(this.clockData,\"attendancePersonId\",this.userinfo.id),this.$set(this.clockData,\"attendancePersonName\",this.userinfo.name),this.$set(this.clockData,\"groupId\",this.userinfo.groupid),this.$set(this.clockData,\"groupName\",this.userinfo.groupname),this.$set(this.clockData,\"projectId\",this.currentBiaoDuan.id),this.$set(this.clockData,\"projectName\",this.currentBiaoDuan.name),this.getLocation(),this.getFence()}},methods:{getLocation:function(){var e=this;l[\"a\"].getCurrentLocation().then((function(t){t&&(e.$set(e.clockData,\"clockAddr\",null===t||void 0===t?void 0:t.address),e.$set(e.clockData,\"clockCoordinate\",\"\".concat(null===t||void 0===t?void 0:t.lon,\",\").concat(null===t||void 0===t?void 0:t.lat)),e.lastLocationMarker&&leafLetMap.removeLayer(e.lastLocationMarker),e.lastLocationMarker=L.marker([null===t||void 0===t?void 0:t.lat,null===t||void 0===t?void 0:t.lon]),leafLetMap.addLayer(e.lastLocationMarker),e.$refs.leafLetMapRef.gotoPoint(null===t||void 0===t?void 0:t.lon,null===t||void 0===t?void 0:t.lat),e.curLocation=[null===t||void 0===t?void 0:t.lon,null===t||void 0===t?void 0:t.lat])}))},onSubmit:function(e){var t=this,a=this.getClockFence();if(!a)return this.$notify({type:\"warning\",message:\"您的当前位置不在打卡区域内，无法打卡！\"});var i=[];if(e[this.picFiled].forEach((function(e){e.url&&i.push(e.url)})),e[this.picFiled].length!==i.length)return this.$notify({type:\"warning\",message:\"请上传照片或等待照片上传完成！\"});var n=JSON.parse(JSON.stringify(this.clockData));n[this.picFiled]=i.join(\",\"),n.gid=a.id,Object(f[\"lb\"])(n).then((function(e){t.$router.go(-1)}))},getClockFence:function(){for(var e=this,t=m[\"point\"](this.curLocation),a=function(){var a=[],n=JSON.parse(e.fences[i].coordinate);n.forEach((function(e){a.push([e[1],e[0]])}));var o=m[\"polygon\"]([a]),r=m[\"booleanPointInPolygon\"](t,o);if(r)return{v:e.fences[i]}},i=0;i<this.fences.length;i++){var n=a();if(\"object\"===Object(o[\"a\"])(n))return n.v}return null},cancel:function(){this.$router.go(-1)},getFence:function(e,t){var a=this,i={projectId:this.currentBiaoDuan.id};this.add||(i={projectId:e},t&&(i.fenceId=t)),Object(f[\"z\"])(i).then((function(e){e.forEach((function(e){a.createFence(JSON.parse(e.coordinate))})),a.fences=e||[]}))},createFence:function(e){L.polygon(e,{color:\"green\"}).addTo(leafLetMap)},mapEcho:function(){var e=this.$route.params.clockCoordinate.split(\",\");L.marker([e[1],e[0]]).addTo(leafLetMap),this.$refs.leafLetMapRef.gotoPoint(e[0],e[1]),this.getFence(this.$route.params.projectId,this.$route.params.gid)}}}),v=h,b=(a(\"8a8f\"),a(\"2877\")),y=Object(b[\"a\"])(v,i,n,!1,null,\"cf113abc\",null);t[\"default\"]=y.exports}}]);","extractedComments":[]}