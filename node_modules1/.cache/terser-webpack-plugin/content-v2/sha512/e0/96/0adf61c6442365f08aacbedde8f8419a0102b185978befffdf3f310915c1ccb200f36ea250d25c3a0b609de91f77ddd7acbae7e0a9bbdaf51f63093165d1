{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"chunk-60bb3eb8\"],{\"1a03\":function(e,t,n){\"use strict\";n.d(t,\"a\",(function(){return g}));n(\"e7e5\");var o=n(\"d399\"),a=(n(\"e17f\"),n(\"2241\")),r=(n(\"d3b7\"),n(\"e9c4\"),n(\"4e82\"),n(\"b0c0\"),n(\"99af\"),n(\"f121\")),i=n(\"3191\"),s=n(\"f6d5\"),c=function(e){return new Promise((function(t){Object(s[\"a\"])({table:\"ss_f_app_update\",mapStr:JSON.stringify({os:e,type:\"project\"})}).then((function(n){if(n&&0!==n.length){var o=[];o=n.sort((function(e,t){return Date.parse(t[\"time\"])-Date.parse(e[\"time\"])}));var a=o[0],r=a.name,s=a.code,c=a.remark;t({version:{name:r,code:s},remark:JSON.parse(c)})}else t(i[\"a\"].versionInfo[e][\"project\"])}))}))},u=function(e){var t=i[\"a\"].versionInfo[e][\"project\"];return new Promise((function(n){c(e).then((function(e){e.version.code>t.version.code?n(e):n()}))}))},l=function(e){return new Promise((function(t){Object(a[\"a\"])({title:\"【\".concat(e.version.name,\"】版本更新\"),message:e.remark,confirmButtonText:\"更新\",confirmButtonColor:\"green\",closeOnClickOverlay:!0}).then((function(e){\"confirm\"===e&&t()})).catch((function(e){}))}))},d=function(){u(\"ios\").then((function(e){e&&l(e).then((function(){var e=encodeURI(\"https://apps.apple.com/cn/app/\".concat(i[\"a\"].name,\"/\").concat(i[\"a\"].iosAppId));plus.runtime.openURL(e,(function(e){alert(JSON.stringify(e))}))}))}))},p=function(){u(\"android\").then((function(e){if(e){var t=\"\".concat(\"project\").concat(e.version.name,\".apk\");l(e).then((function(){f(t)}))}}))},f=function(e){o[\"a\"].loading({message:\"安装包下载中，请等到1-2两分钟！\",forbidClick:!0});var t=\"_downloads/\"+e,n=plus.downloader.createDownload(r[\"data_zlsk\"]+\"/bim/\"+e,{filename:t},(function(e,n){o[\"a\"].clear(),200==n?plus.runtime.install(t,{},(function(){o[\"a\"].success(\"安装成功\")}),(function(){o[\"a\"].fail(\"安装失败\")})):o[\"a\"].fail(\"下载失败\")}));n.start()},m=function(){return new Promise((function(e){window.plus?e():document.addEventListener(\"plusready\",(function(){e()}))}))},h=function(){m().then((function(){var e=plus.os.name.toLowerCase();\"ios\"===e?d():p()}))},v=function(){m().then((function(){var e=plus.os.name.toLowerCase(),t=\"ios\"===e?\"ios\":\"android\";u(t).then((function(e){e?h():o[\"a\"].success(\"当版本为最新版本！\")}))}))},w=function(){var e=window.plus?window.plus.os.name.toLowerCase():\"android\";return i[\"a\"].versionInfo[\"ios\"===e?\"ios\":\"android\"][\"project\"]},g={checkUpdate:v,update:h,getCurrentVersionInfo:w}},3191:function(e,t,n){\"use strict\";var o={project:\"诸暨建设集团项目管理\",center:\"项目数据中心\"},a={project:\"1613264195\",center:\"1594315244\"},r={projectTypes:[{name:\"房建\",value:\"LM\"},{name:\"桥梁\",value:\"QL\"},{name:\"隧道\",value:\"SD\"},{name:\"其他\",value:\"other\"}],wholeName:\"全生命周期智慧建设管理平台\",name:o[\"project\"],iosAppId:a[\"project\"],versionInfo:{ios:{project:{version:{name:\"3.2\",code:3200},remark:[\"新增人员位置\"]},center:{version:{name:\"1.7\",code:1700},remark:[\"首页区分工程类型\"]}},android:{project:{version:{name:\"5.3\",code:5300},remark:[\"新增人员位置\"]},center:{version:{name:\"2.8\",code:2800},remark:[\"首页区分工程类型\"]}}}};t[\"a\"]=r},\"96b8\":function(e,t,n){\"use strict\";n(\"e6c1\")},\"9ed6\":function(e,t,n){\"use strict\";n.r(t);var o=function(){var e=this,t=e._self._c;return t(\"div\",{staticClass:\"login-container\"},[t(\"div\",{staticClass:\"bg\"},[t(\"div\",{staticClass:\"title\"},[e._v(e._s(e.constantField.wholeName))]),t(\"div\",{staticClass:\"card\"},[t(\"div\",{staticClass:\"title\"},[e._v(\"登录\")]),t(\"van-field\",{attrs:{name:\"username\",placeholder:\"用户名\",rules:[{required:!0,message:\"请填写用户名\"}],size:\"large\"},model:{value:e.loginForm.username,callback:function(t){e.$set(e.loginForm,\"username\",t)},expression:\"loginForm.username\"}}),t(\"van-field\",{attrs:{type:e.passwordType,name:\"password\",placeholder:\"密码\",rules:[{required:!0,message:\"请填写密码\"}],autocomplete:\"off\"},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,\"password\",t)},expression:\"loginForm.password\"}},[t(\"template\",{slot:\"right-icon\"},[t(\"van-switch\",{on:{change:e.switchPasswordType},model:{value:e.showPwd,callback:function(t){e.showPwd=t},expression:\"showPwd\"}})],1)],2),t(\"el-button\",{staticStyle:{width:\"100%\",\"margin-top\":\"26px\",\"font-size\":\"18px\",\"font-weight\":\"400\"},attrs:{type:\"primary\"},nativeOn:{click:function(t){return t.preventDefault(),e.handleLogin.apply(null,arguments)}}},[e._v(\"登录 \")])],1)])])},a=[],r=(n(\"b0c0\"),n(\"e9c4\"),n(\"14d9\"),n(\"d3b7\"),n(\"3191\")),i=n(\"24d2\"),s=n(\"f6d5\"),c=n(\"1a03\"),u=n(\"f121\"),l={data:function(){return{constantField:r[\"a\"],loginForm:{username:\"\",password:\"\",code:\"\",uuid:\"\"},bottomTitle:r[\"a\"].wholeName+\"-\"+r[\"a\"].name,appUpdate:c[\"a\"],appType:\"project\",passwordType:\"password\",showPwd:!1}},mounted:function(){this.appUpdate.update()},methods:{handleLogin:function(){var e=this;return this.loginForm.username?this.loginForm.password?void Object(i[\"ib\"])({username:this.loginForm.username,password:this.loginForm.password}).then((function(t){var n=t.userInfo;if(n){if(!n.deptId)return e.$toast.fail(\"账户[\"+loginData.username+\"]未配置组织信息,请联系管理员\"),!1;localStorage.setItem(\"userinfo\",JSON.stringify(n)),e.$store.dispatch(\"uploadOnlineState\").then((function(){e.$store.dispatch(\"getRealtimeOnline\")})),u[\"overviewGroups\"].indexOf(n.GROUPID)>=0?(localStorage.setItem(\"overviewAuth\",!0),e.$router.push({path:\"/projectOverview\"})):(localStorage.setItem(\"overviewAuth\",!1),e.$router.push({path:\"/\"}))}else e.$toast.fail(\"登录失败\")})):Toast.fail(\"请输入密码\"):this.$toast.fail(\"请输入用户名\")},onSubmit_old:function(e){var t=this;Object(i[\"ib\"])(e).then((function(e){if(e&&e.groupid){var n=e.groupid;e=e.loginData,e.groupid=n;var o=e,a=o.id,r=o.name,i=o.token;a&&r&&i?t.userauth(a).then((function(n){var o=n.userAuth,a=n.roles,r=n.userInfo;e.userAuth=o,e.roles=a,e.groupname=r.GROUPNAME,e.userinfo=r,t.$store.state.userinfo=e,t.$store.state.loginCount++,localStorage.setItem(\"userinfo\",JSON.stringify(e)),t.$store.dispatch(\"uploadOnlineState\").then((function(){t.$store.dispatch(\"getRealtimeOnline\")})),u[\"overviewGroups\"].indexOf(r.GROUPID)>=0?(localStorage.setItem(\"overviewAuth\",!0),t.$router.push({path:\"/projectOverview\"})):(localStorage.setItem(\"overviewAuth\",!1),t.$router.push({path:\"/\"}))})):t.$toast.fail(i||\"登录失败\")}else t.$toast.fail(e?\"该角色没有配置角色权限,请到运维系统进行配置！\":\"账号或密码错误！\")}))},userauth:function(e){return new Promise((function(t){Object(s[\"d\"])({id:e,type:\"app\",systemName:\"project\"}).then((function(e){t(e)}))}))},switchPasswordType:function(){this.passwordType=\"password\"===this.passwordType?\"text\":\"password\"}}},d=l,p=(n(\"96b8\"),n(\"2877\")),f=Object(p[\"a\"])(d,o,a,!1,null,\"f97a8010\",null);t[\"default\"]=f.exports},e6c1:function(e,t,n){},f6d5:function(e,t,n){\"use strict\";n.d(t,\"d\",(function(){return s})),n.d(t,\"c\",(function(){return c})),n.d(t,\"a\",(function(){return u})),n.d(t,\"b\",(function(){return l}));n(\"e7e5\");var o=n(\"d399\"),a=(n(\"d3b7\"),n(\"e9c4\"),n(\"14d9\"),n(\"99af\"),n(\"a15b\"),n(\"159b\"),n(\"bc3a\"),n(\"f121\")),r=function(){return new Promise((function(e){window.plus?e():document.addEventListener(\"plusready\",(function(){e()}))}))},i=function(e){return mui.init(),new Promise((function(t){r().then((function(){mui.init();var n=e.url,r=e.method,i=e.params,s=e.data,c=e.isUploadFile,u=e.loading,l=n;if(i&&\"{}\"!==JSON.stringify(i)){var d=[];for(var p in i)d.push(\"\".concat(p,\"=\").concat(i[p]));n+=\"?\".concat(d.join(\"&\"))}var f={url:a[\"STSfmzj\"]+encodeURI(n),type:r.toUpperCase(),headers:{\"Content-Type\":\"application/json\"},success:function(e){o[\"a\"].clear(),200===e.status||0===e.meow?t(e.data):300===e.status?(t(e.data||[]),o[\"a\"].fail(e.message||\"无数据！\")):o[\"a\"].fail(\"\".concat(l,\": \").concat(e.message||\"接口访问出错！\"))},error:function(e,t,n){o[\"a\"].clear(),o[\"a\"].fail(\"\".concat(l,\": 请检查您的网络，或联系管理员！\"))}};if(s&&(f.data=s),!c&&(null===i||void 0===i||!i.noToken)){var m=localStorage.getItem(\"userinfo\");if(m){var h=JSON.parse(m);f.headers[\"token\"]=h.token}}mui.ajax(f),u&&o[\"a\"].loading({message:\"加载中...\",forbidClick:!0})}))}))};function s(e){return i({url:\"/userauth/getUserInfo\",method:\"get\",params:e})}function c(e,t,n){var o=[];return n&&n.forEach((function(e){o.push(e.ID)})),i({url:\"/mapConfig/getMyMap?type=2,3&userid=\".concat(e,\"&groupId=\").concat(t,\"&rolesId=\").concat(o.join(\",\")),method:\"get\"})}function u(e){return i({url:\"/assets/easySelect\",method:\"get\",params:e})}var l=function(e){return i({url:\"/userauth/selectDicByParentKey?keyStr=\".concat(e),method:\"get\"})}}}]);","extractedComments":[]}